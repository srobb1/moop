TOOLS CONVERSION ANALYSIS - SUMMARY
====================================

CURRENT STATE:
- 3 tools NOT using new layout infrastructure: blast.php, retrieve_sequences.php, retrieve_selected_sequences.php
- All have manual HTML/head/body/navbar/footer inclusion
- No separation of concerns (controller/view split)
- These are the LAST pages needing conversion

KEY FINDINGS:

1. CAN THEY USE THE TEMPLATE?
   YES - All three tools CAN use display-template.php
   
   Why it works:
   - Template already handles form-based pages (registry has filters)
   - Template supports inline_scripts for JS initialization
   - Template handles page_script for external JS files
   - Layout.php renders complete page wrapper
   - Content file (pages/) renders form/output

2. WHAT'S SPECIAL ABOUT THESE TOOLS?
   - Multi-step form processing (POST handling)
   - File downloads (BLAST results, FASTA sequences)
   - Complex state management (form pre-population)
   - Heavy JavaScript (especially blast.php ~500 lines)
   
   BUT all are solvable:
   - Process forms in controller BEFORE template
   - Check download flag BEFORE template (exit early)
   - Pass all state via $data array
   - Extract JS to separate file, reference in config

3. CONVERSION PATTERN:

   Current (monolithic):
   ```
   blast.php (710 lines)
   ├─ Load config
   ├─ Process form/download
   ├─ Build HTML/form/JS
   └─ Include footer
   ```
   
   Converted (MVC-style):
   ```
   blast.php (controller ~200 lines)
   ├─ Load config
   ├─ Process form/download (exit if download)
   ├─ Build $data array
   ├─ Set $display_config
   └─ Include display-template.php
   
   pages/blast.php (view ~350 lines)
   └─ Render form/output using $data
   
   js/blast-tool.js (logic ~400 lines)
   └─ Client-side functionality
   ```

4. KEY DIFFERENCES FROM OTHER PAGES:
   
   Display Pages (organism, assembly, groups):
   - Read-only data display
   - Simple page load (no form processing)
   - Static content
   
   Tool Pages (blast, retrieve):
   - Form-based workflows
   - Multi-step processing
   - Dynamic state management
   - File generation/download
   
   SOLUTION: Template doesn't care about these differences - it just:
   - Includes content file with $data
   - Renders complete page wrapper
   - Leaves content file to handle forms/complexity

5. FEASIBILITY ASSESSMENT:

   retrieve_selected_sequences.php: ★★★★★ EASIEST (209 lines)
   - Simple form (organism, uniquenames, sequence_type)
   - Basic HTML output
   - One file download scenario
   - Minimal inline JS
   
   retrieve_sequences.php: ★★★★☆ MEDIUM (463 lines)
   - Organism/assembly search
   - Feature list display
   - Download scenario
   - Some form state management
   
   blast.php: ★★★☆☆ HARDEST (710 lines)
   - Complex form with many options
   - Source selector with filtering
   - Database selection logic
   - Heavy inline JavaScript (~500 lines)
   - Sequence detection/type filtering
   - BLAST result visualization

6. RISKS IDENTIFIED:

   ✓ Form state preservation - LOW RISK (pass in $data)
   ✓ File downloads - LOW RISK (exit before template)
   ✓ JavaScript functionality - MEDIUM RISK (extract carefully)
   ✓ Access control - LOW RISK (already in controller)
   ✓ Complex logic - LOW RISK (stays in controller)

7. BENEFITS OF CONVERSION:

   ✓ Consistency - All pages use same infrastructure
   ✓ Reduced duplication - navbar/footer/styles once
   ✓ Maintainability - Changes affect all pages
   ✓ Separation of concerns - Controller/View split
   ✓ Cleaner code - Smaller, more focused files
   ✓ Testability - Logic/View separated

8. ESTIMATED TIMELINE:

   Phase 1: retrieve_selected_sequences.php
   - Extract content to pages/
   - Refactor controller
   - Test form/download
   Effort: 0.5-1 hour

   Phase 2: retrieve_sequences.php
   - More complex state management
   - More form fields
   Effort: 1-2 hours

   Phase 3: blast.php
   - Extract JavaScript
   - Complex form logic
   - Result visualization
   Effort: 2-3 hours

   Testing (all tools):
   - Form submissions
   - File downloads
   - State preservation
   - Access control
   Effort: 1-2 hours

   TOTAL: 5-8 hours for all three tools

9. IMPLEMENTATION ORDER (RECOMMENDED):

   1. Start with retrieve_selected_sequences.php (lowest risk)
   2. Verify template approach works with forms
   3. Move to retrieve_sequences.php (build confidence)
   4. Finally tackle blast.php (most complex)
   5. Comprehensive testing of all scenarios

10. CONCLUSION:

    YES - These tools can definitely use the display-template.php pattern.
    NO special template modifications needed.
    The template is FLEXIBLE ENOUGH to handle form-based tools.
    
    Converting these 3 tools will COMPLETE the layout infrastructure migration.
    After this, 100% of user-facing pages use the new system.

