{
    "metadata": {
        "generated": "2026-01-20 20:22:22",
        "totalFunctions": 115,
        "totalFiles": 21,
        "duplicates": 0
    },
    "files": [
        {
            "name": "js/blast-manager.js",
            "count": 8,
            "functions": [
                {
                    "name": "downloadResultsHTML",
                    "line": 9,
                    "comment": "/**\n * BLAST Search Tool Manager\n * Handles UI logic for BLAST search form, source selection, database filtering,\n * and results management. Works in conjunction with PHP-provided variables:\n * - previouslySelectedDb\n * - previouslySelectedSource  \n * - databasesByAssembly\n */\n",
                    "code": "{\n    const resultsCard = document.querySelector('.card');\n    if (!resultsCard) return;\n    \n    const content = resultsCard.innerHTML;\n    const blob = new Blob([content], { type: 'text/html' });\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = 'blast_results_' + new Date().toISOString().slice(0, 10) + '.html';\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    URL.revokeObjectURL(url);\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "export",
                    "tags": [
                        "dom-manipulation",
                        "event-listener",
                        "state-modifying"
                    ],
                    "usageCount": 0,
                    "usages": [],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "tools/blast.php"
                    ]
                },
                {
                    "name": "downloadResultsText",
                    "line": 25,
                    "comment": "",
                    "code": "{\n    const pairwiseDiv = document.getElementById('pairwiseOutput');\n    if (!pairwiseDiv) {\n        alert('No BLAST results to download');\n        return;\n    }\n    \n    const textContent = pairwiseDiv.textContent || pairwiseDiv.innerText;\n    const blob = new Blob([textContent], { type: 'text/plain' });\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = 'blast_results_' + new Date().toISOString().slice(0, 10) + '.txt';\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    URL.revokeObjectURL(url);\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "export",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "event-listener",
                        "state-modifying"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "tools/pages/blast.php",
                            "line": 286,
                            "context": "<button type=\"button\" class=\"btn btn-sm btn-outline-secondary\" onclick=\"downloadResultsText();\">"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "tools/blast.php"
                    ]
                },
                {
                    "name": "clearResults",
                    "line": 44,
                    "comment": "",
                    "code": "{\n    const resultsCard = document.querySelector('.mt-4.card');\n    if (resultsCard) {\n        resultsCard.remove();\n    }\n    document.getElementById('query').focus();\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "state-modifying"
                    ],
                    "usageCount": 0,
                    "usages": [],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "tools/blast.php"
                    ]
                },
                {
                    "name": "clearBlastSourceFilters",
                    "line": 52,
                    "comment": "",
                    "code": "{\n    window.clearSourceFilters('sourceFilter', 'selected_source', 'fasta-source-line', null, 'blastForm');\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "clearSourceFilters"
                    ],
                    "category": "data-processing",
                    "tags": [],
                    "usageCount": 0,
                    "usages": [],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "tools/blast.php"
                    ]
                },
                {
                    "name": "initializeBlastManager",
                    "line": 56,
                    "comment": "",
                    "code": "{\n    const form = document.getElementById('blastForm');\n\n    function updateCurrentSelectionDisplay() {\n        window.updateCurrentSelectionDisplay();\n        const selectionDiv = document.getElementById('currentSelection');\n        const checked = document.querySelector('input[name=\"selected_source\"]:checked');\n        if (!checked) {\n            selectionDiv.innerHTML = '<span style=\"color: #999;\">None selected</span>';\n        }\n    }\n\n    // Use centralized source selector initialization\n    initializeSourceSelector({\n        formId: 'blastForm',\n        filterId: 'sourceFilter',\n        radioName: 'selected_source',\n        sourceListClass: 'fasta-source-line',\n        onSelectionChange: function(radio) {\n            updateDatabaseList();\n            updateCurrentSelectionDisplay();\n        },\n        onFilterChange: function() {\n            updateCurrentSelectionDisplay();\n            updateDatabaseList();\n        }\n    });\n    \n    // Update display on page load\n    updateCurrentSelectionDisplay();\n    \n    // Update database list based on selected source\n    updateDatabaseList();\n    \n    // Restore previously selected database (after updateDatabaseList renders the radio buttons)\n    if (previouslySelectedDb) {\n        const prevDbRadio = document.querySelector(`input[name=\"blast_db\"][value=\"${previouslySelectedDb}\"]`);\n        if (prevDbRadio) {\n            prevDbRadio.checked = true;\n        }\n    }\n    \n    // Handle form submission\n    if (form) {\n        form.addEventListener('submit', function(e) {\n            const selectedSource = document.querySelector('input[name=\"selected_source\"]:checked');\n            const selectedDb = document.querySelector('input[name=\"blast_db\"]:checked');\n            \n            if (!selectedSource || !selectedDb) {\n                e.preventDefault();\n                alert('Please select both an assembly and a database.');\n                return false;\n            }\n            \n            // Update hidden organism/asse",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "updateCurrentSelectionDisplay",
                        "initializeSourceSelector",
                        "updateDatabaseList"
                    ],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "event-listener",
                        "state-modifying",
                        "validation"
                    ],
                    "usageCount": 2,
                    "usages": [
                        {
                            "file": "js/blast-manager.js",
                            "line": 190,
                            "context": "initializeBlastManager();"
                        },
                        {
                            "file": "js/blast-manager.js",
                            "line": 195,
                            "context": "initializeBlastManager();"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "tools/blast.php"
                    ]
                },
                {
                    "name": "updateCurrentSelectionDisplay",
                    "line": 60,
                    "comment": "",
                    "code": "{\n        window.updateCurrentSelectionDisplay();\n        const selectionDiv = document.getElementById('currentSelection');\n        const checked = document.querySelector('input[name=\"selected_source\"]:checked');\n        if (!checked) {\n            selectionDiv.innerHTML = '<span style=\"color: #999;\">None selected</span>';\n        }\n    }",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "updateCurrentSelectionDisplay"
                    ],
                    "category": "ui-dom",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "event-listener",
                        "state-modifying",
                        "validation"
                    ],
                    "usageCount": 8,
                    "usages": [
                        {
                            "file": "js/blast-manager.js",
                            "line": 61,
                            "context": "window.updateCurrentSelectionDisplay();"
                        },
                        {
                            "file": "js/blast-manager.js",
                            "line": 77,
                            "context": "updateCurrentSelectionDisplay();"
                        },
                        {
                            "file": "js/blast-manager.js",
                            "line": 80,
                            "context": "updateCurrentSelectionDisplay();"
                        },
                        {
                            "file": "js/blast-manager.js",
                            "line": 86,
                            "context": "updateCurrentSelectionDisplay();"
                        },
                        {
                            "file": "js/sequence-retrieval.js",
                            "line": 25,
                            "context": "window.updateCurrentSelectionDisplay('currentSelection', 'fasta-source-line', true);"
                        },
                        {
                            "file": "js/sequence-retrieval.js",
                            "line": 47,
                            "context": "updateCurrentSelectionDisplay();"
                        },
                        {
                            "file": "js/sequence-retrieval.js",
                            "line": 50,
                            "context": "updateCurrentSelectionDisplay();"
                        },
                        {
                            "file": "js/sequence-retrieval.js",
                            "line": 55,
                            "context": "updateCurrentSelectionDisplay();"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "tools/blast.php"
                    ]
                },
                {
                    "name": "autoScrollToResults",
                    "line": 177,
                    "comment": "",
                    "code": "{\n    document.addEventListener('DOMContentLoaded', function() {\n        const resultsSection = document.getElementById('blast-results-section');\n        if (resultsSection) {\n            resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });\n        }\n    });\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "event-listener",
                        "state-modifying"
                    ],
                    "usageCount": 2,
                    "usages": [
                        {
                            "file": "js/blast-manager.js",
                            "line": 191,
                            "context": "autoScrollToResults();"
                        },
                        {
                            "file": "js/blast-manager.js",
                            "line": 196,
                            "context": "autoScrollToResults();"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "tools/blast.php"
                    ]
                },
                {
                    "name": "loadSampleSequence",
                    "line": 199,
                    "comment": "",
                    "code": "{\n    const queryField = document.getElementById('query');\n    const programField = document.getElementById('blast_program');\n    \n    if (!queryField) {\n        console.error('query field not found');\n        return;\n    }\n    \n    if (type === 'protein' && sampleSequences['protein']) {\n        queryField.value = sampleSequences['protein'];\n        if (programField) {\n            programField.value = 'blastx';\n        }\n    } else if (type === 'nucleotide' && sampleSequences['nucleotide']) {\n        queryField.value = sampleSequences['nucleotide'];\n        if (programField) {\n            programField.value = 'blastn';\n        }\n    } else {\n        console.error('Sample not found for type:', type);\n        return;\n    }\n    \n    // Detect sequence type and update UI if function exists\n    if (typeof detectSequenceType === 'function') {\n        const result = detectSequenceType(queryField.value);\n        \n        // Update sequence type message if function exists\n        if (typeof updateSequenceTypeInfo === 'function') {\n            updateSequenceTypeInfo(result.message, 'sequenceTypeInfo', 'sequenceTypeMessage');\n        }\n        \n        // Filter BLAST programs based on detected type\n        if (typeof filterBlastPrograms === 'function' && result.type !== 'unknown') {\n            filterBlastPrograms(result.type, 'blast_program');\n        }\n    }\n    \n    // Update database list\n    if (typeof updateDatabaseList === 'function') {\n        updateDatabaseList();\n    }\n    \n    // Scroll to top so user can see the loaded sequence\n    queryField.scrollIntoView({ behavior: 'smooth', block: 'center' });\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "detectSequenceType",
                        "updateSequenceTypeInfo",
                        "filterBlastPrograms",
                        "updateDatabaseList"
                    ],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "state-modifying",
                        "error-handling"
                    ],
                    "usageCount": 2,
                    "usages": [
                        {
                            "file": "tools/pages/blast.php",
                            "line": 72,
                            "context": "<button type=\"button\" class=\"btn btn-sm btn-outline-info\" onclick=\"loadSampleSequence('protein')\">"
                        },
                        {
                            "file": "tools/pages/blast.php",
                            "line": 75,
                            "context": "<button type=\"button\" class=\"btn btn-sm btn-outline-info\" onclick=\"loadSampleSequence('nucleotide')\">"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "tools/blast.php"
                    ]
                }
            ]
        },
        {
            "name": "js/index.js",
            "count": 4,
            "functions": [
                {
                    "name": "handleToolClick",
                    "line": 2,
                    "comment": "",
                    "code": "{\n  if (!phyloTree || phyloTree.selectedOrganisms.size === 0) {\n    alert('Please select at least one organism');\n    return;\n  }\n  \n  // Get tool button and its configuration\n  const toolBtn = document.getElementById(`tool-btn-${toolId}`);\n  if (!toolBtn) {\n    console.error(`Tool button not found: tool-btn-${toolId}`);\n    return;\n  }\n  \n  const toolPath = toolBtn.getAttribute('data-tool-path');\n  const contextParamsJson = toolBtn.getAttribute('data-context-params');\n  \n  if (!toolPath || !contextParamsJson) {\n    console.error('Tool configuration missing from button');\n    return;\n  }\n  \n  const contextParams = JSON.parse(contextParamsJson);\n  const organisms = Array.from(phyloTree.selectedOrganisms);\n  \n  // Get site name from global scope (set in index.php via PHP variable)\n  // Fallback to 'moop' if not available\n  const siteName = typeof sitePath !== 'undefined' ? sitePath.replace(/^\\//,'').split('/')[0] : 'moop';\n  \n  // Build query parameters based on tool's context_params\n  const params = new URLSearchParams();\n  \n  // Always add organisms if the tool supports them\n  if (contextParams.includes('organisms')) {\n    organisms.forEach(org => {\n      params.append('organisms[]', org);\n    });\n  }\n  \n  // Add display_name\n  if (contextParams.includes('display_name')) {\n    params.append('display_name', 'Multi-Organism Search');\n  }\n  \n  // Build URL: /{site}{toolPath}?params\n  const url = `/${siteName}${toolPath}${params.toString() ? '?' + params.toString() : ''}`;\n  window.open(url, '_blank');\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "event-handling",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "event-listener",
                        "state-modifying",
                        "loops",
                        "error-handling"
                    ],
                    "usageCount": 0,
                    "usages": [],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "tools/pages/index.php"
                    ]
                },
                {
                    "name": "switchView",
                    "line": 50,
                    "comment": "",
                    "code": "{\n  const cardView = document.getElementById('card-view');\n  const treeView = document.getElementById('tree-view');\n  const cardBtn = document.getElementById('card-view-btn');\n  const treeBtn = document.getElementById('tree-view-btn');\n  \n  if (view === 'card') {\n    cardView.style.display = 'block';\n    treeView.style.display = 'none';\n    cardBtn.classList.add('active');\n    treeBtn.classList.remove('active');\n  } else {\n    cardView.style.display = 'none';\n    treeView.style.display = 'block';\n    cardBtn.classList.remove('active');\n    treeBtn.classList.add('active');\n    \n    // Initialize tree on first view\n    if (!phyloTree) {\n      initPhyloTree(treeData, userAccess);\n      // Setup filter listener after tree is initialized\n      setupTaxonomyFilter();\n    }\n  }\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "initPhyloTree",
                        "setupTaxonomyFilter"
                    ],
                    "category": "general",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "state-modifying"
                    ],
                    "usageCount": 2,
                    "usages": [
                        {
                            "file": "tools/pages/index.php",
                            "line": 36,
                            "context": "<button type=\"button\" class=\"btn btn-outline-primary active\" id=\"card-view-btn\" onclick=\"switchView('card')\">"
                        },
                        {
                            "file": "tools/pages/index.php",
                            "line": 39,
                            "context": "<button type=\"button\" class=\"btn btn-outline-primary\" id=\"tree-view-btn\" onclick=\"switchView('tree')\">"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "tools/pages/index.php"
                    ]
                },
                {
                    "name": "setupTaxonomyFilter",
                    "line": 76,
                    "comment": "",
                    "code": "{\n  const filterInput = document.getElementById('taxonomy-filter');\n  if (!filterInput) return;\n  \n  filterInput.addEventListener('keyup', function() {\n    filterTaxonomyTree(this.value.toLowerCase());\n  });\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "filterTaxonomyTree"
                    ],
                    "category": "data-processing",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "event-listener",
                        "state-modifying"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "js/index.js",
                            "line": 72,
                            "context": "setupTaxonomyFilter();"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "tools/pages/index.php"
                    ]
                },
                {
                    "name": "filterTaxonomyTree",
                    "line": 85,
                    "comment": "",
                    "code": "{\n  const nodes = document.querySelectorAll('.phylo-node');\n  \n  nodes.forEach(node => {\n    const nodeLabel = node.textContent.toLowerCase();\n    const matches = filterText === '' || nodeLabel.includes(filterText);\n    \n    if (matches) {\n      node.style.display = '';\n      // Show parent nodes if this node is visible\n      let parent = node.closest('.phylo-children')?.parentElement;\n      while (parent && parent.classList.contains('phylo-node')) {\n        parent.style.display = '';\n        parent = parent.closest('.phylo-children')?.parentElement;\n      }\n    } else {\n      node.style.display = 'none';\n    }\n  });\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "data-processing",
                    "tags": [
                        "dom-manipulation",
                        "state-modifying",
                        "loops"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "js/index.js",
                            "line": 82,
                            "context": "filterTaxonomyTree(this.value.toLowerCase());"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "tools/pages/index.php"
                    ]
                }
            ]
        },
        {
            "name": "js/manage-registry.js",
            "count": 13,
            "functions": [
                {
                    "name": "renderRegistry",
                    "line": 32,
                    "comment": "/**\n * Render registry from JSON data\n */",
                    "code": "{\n    if (!registryData || !registryData.files) {\n        return;\n    }\n    \n    const container = document.getElementById('filesContainer');\n    if (!container) {\n        return;\n    }\n    \n    container.innerHTML = '';\n    \n    let fileCount = 0;\n    registryData.files.forEach(fileData => {\n        fileCount++;\n        const fileSection = document.createElement('div');\n        fileSection.className = 'file-section';\n        fileSection.style.overflow = 'visible';\n        fileSection.setAttribute('data-file', fileData.name);\n        \n        const header = document.createElement('div');\n        header.className = 'file-header';\n        header.style.cssText = 'display: flex; justify-content: space-between; align-items: center; cursor: pointer;';\n        header.innerHTML = `\n            <span style=\"display: flex; align-items: center; gap: 8px;\">\n                \ud83d\udcc4 ${htmlEscape(fileData.name)} <span class=\"badge bg-secondary\" title=\"Number of functions in this file\">[ contain ${fileData.count} function${fileData.count !== 1 ? 's' : ''} ]</span>\n            </span>\n            <span class=\"expand-arrow\">\u25b6</span>\n        `;\n        \n        const listContainer = document.createElement('div');\n        listContainer.className = 'functions-list';\n        listContainer.style.cssText = 'max-height: 0; overflow: hidden; transition: max-height 0.3s ease; padding: 0;';\n        \n        fileData.functions.forEach(func => {\n            const item = document.createElement('div');\n            item.className = 'function-item';\n            item.setAttribute('data-func', func.name);\n            \n            // Function header with toggle\n            const funcHeader = document.createElement('div');\n            funcHeader.className = 'function-header';\n            funcHeader.onclick = function() { toggleFunctionCode(this); };\n            \n            // Build badges for category and tags\n            let categoryBadge = '';\n            if (func.category) {\n                const cat",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "toggleFunctionCode"
                    ],
                    "category": "ui-dom",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "event-listener",
                        "state-modifying",
                        "loops"
                    ],
                    "usageCount": 4,
                    "usages": [
                        {
                            "file": "js/manage-registry.js",
                            "line": 13,
                            "context": "renderRegistry();"
                        },
                        {
                            "file": "js/manage-registry.js",
                            "line": 663,
                            "context": "renderRegistry();"
                        },
                        {
                            "file": "js/manage-registry.js",
                            "line": 674,
                            "context": "renderRegistry();"
                        },
                        {
                            "file": "tools/pages/registry.php",
                            "line": 56,
                            "context": "<!-- Populated by renderRegistry() JavaScript function -->"
                        }
                    ],
                    "phpFilesCount": 2,
                    "phpFiles": [
                        "admin/manage_js_registry.php",
                        "admin/manage_registry.php"
                    ]
                },
                {
                    "name": "toggleFile",
                    "line": 287,
                    "comment": "/**\n * Toggle file section\n */",
                    "code": "{\n    // Make sure we're working with the actual file-header element\n    const fileHeader = header.closest('.file-header') || header;\n    const list = fileHeader.nextElementSibling;\n    if (list && list.classList.contains('functions-list')) {\n        const isOpen = list.classList.contains('open');\n        list.classList.toggle('open');\n        \n        // Force inline styles to ensure visibility\n        if (list.classList.contains('open')) {\n            list.style.maxHeight = '10000px';\n            list.style.overflow = 'visible';\n        } else {\n            list.style.maxHeight = '0';\n            list.style.overflow = 'hidden';\n        }\n        \n        const arrow = fileHeader.querySelector('.expand-arrow');\n        if (arrow) {\n            arrow.textContent = !isOpen ? '\u25bc' : '\u25b6';\n        }\n    }\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "event-listener",
                        "state-modifying"
                    ],
                    "usageCount": 2,
                    "usages": [
                        {
                            "file": "js/manage-registry.js",
                            "line": 278,
                            "context": "toggleFile(this);"
                        },
                        {
                            "file": "js/registry.js",
                            "line": 356,
                            "context": "toggleFile(this);"
                        }
                    ],
                    "phpFilesCount": 2,
                    "phpFiles": [
                        "admin/manage_js_registry.php",
                        "admin/manage_registry.php"
                    ]
                },
                {
                    "name": "toggleFunctionCode",
                    "line": 314,
                    "comment": "/**\n * Toggle function code visibility\n */",
                    "code": "{\n    const item = header.closest('.function-item');\n    if (!item) return;\n    \n    const code = item.querySelector('.function-code');\n    if (code) {\n        code.classList.toggle('open');\n        const arrow = header.querySelector('.expand-arrow');\n        if (arrow) {\n            arrow.textContent = code.classList.contains('open') ? '\u25bc' : '\u25b6';\n        }\n    }\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "event-listener",
                        "state-modifying"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "js/manage-registry.js",
                            "line": 75,
                            "context": "funcHeader.onclick = function() { toggleFunctionCode(this); };"
                        }
                    ],
                    "phpFilesCount": 2,
                    "phpFiles": [
                        "admin/manage_js_registry.php",
                        "admin/manage_registry.php"
                    ]
                },
                {
                    "name": "toggleUnusedSection",
                    "line": 331,
                    "comment": "/**\n * Toggle unused section\n */",
                    "code": "{\n    const content = header.nextElementSibling;\n    if (content && content.classList.contains('unused-content')) {\n        content.classList.toggle('hidden');\n        const arrow = header.querySelector('.unused-arrow');\n        if (arrow) {\n            arrow.textContent = content.classList.contains('hidden') ? '\u25b6' : '\u25bc';\n        }\n    }\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "event-listener",
                        "state-modifying"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "js/manage-registry.js",
                            "line": 25,
                            "context": "toggleUnusedSection(this);"
                        }
                    ],
                    "phpFilesCount": 2,
                    "phpFiles": [
                        "admin/manage_js_registry.php",
                        "admin/manage_registry.php"
                    ]
                },
                {
                    "name": "toggleAll",
                    "line": 345,
                    "comment": "/**\n * Toggle all file sections (toggleAll and toggleAllFiles are aliases)\n */",
                    "code": "{\n    const lists = document.querySelectorAll('.functions-list');\n    const hiddenCount = document.querySelectorAll('.functions-list:not(.open)').length;\n    \n    lists.forEach(list => {\n        if (hiddenCount > 0) {\n            list.classList.add('open');\n            // Apply inline styles for open state\n            list.style.maxHeight = '10000px';\n            list.style.overflow = 'visible';\n        } else {\n            list.classList.remove('open');\n            // Apply inline styles for closed state\n            list.style.maxHeight = '0';\n            list.style.overflow = 'hidden';\n        }\n    });\n    \n    // Update all arrows\n    document.querySelectorAll('.file-header .expand-arrow').forEach(arrow => {\n        const list = arrow.closest('.file-header').nextElementSibling;\n        if (list && list.classList.contains('functions-list')) {\n            arrow.textContent = list.classList.contains('open') ? '\u25bc' : '\u25b6';\n        }\n    });\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "event-listener",
                        "state-modifying",
                        "loops"
                    ],
                    "usageCount": 2,
                    "usages": [
                        {
                            "file": "js/manage-registry.js",
                            "line": 374,
                            "context": "toggleAll();"
                        },
                        {
                            "file": "js/registry.js",
                            "line": 226,
                            "context": "toggleAll();"
                        }
                    ],
                    "phpFilesCount": 2,
                    "phpFiles": [
                        "admin/manage_js_registry.php",
                        "admin/manage_registry.php"
                    ]
                },
                {
                    "name": "toggleAllFiles",
                    "line": 372,
                    "comment": "",
                    "code": "{\n    toggleAll();\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "toggleAll"
                    ],
                    "category": "admin",
                    "tags": [],
                    "usageCount": 0,
                    "usages": [],
                    "phpFilesCount": 2,
                    "phpFiles": [
                        "admin/manage_js_registry.php",
                        "admin/manage_registry.php"
                    ]
                },
                {
                    "name": "expandAllFiles",
                    "line": 379,
                    "comment": "/**\n * Expand all files\n */",
                    "code": "{\n    document.querySelectorAll('.functions-list').forEach(list => {\n        list.classList.add('open');\n        list.style.maxHeight = '10000px';\n        list.style.overflow = 'visible';\n        const header = list.previousElementSibling;\n        if (header) {\n            const arrow = header.querySelector('.expand-arrow');\n            if (arrow) arrow.textContent = '\u25bc';\n        }\n    });\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "event-listener",
                        "state-modifying",
                        "loops"
                    ],
                    "usageCount": 2,
                    "usages": [
                        {
                            "file": "tools/pages/js_registry.php",
                            "line": 96,
                            "context": "<button class=\"btn btn-sm btn-secondary\" onclick=\"expandAllFiles()\">"
                        },
                        {
                            "file": "tools/pages/registry.php",
                            "line": 36,
                            "context": "<button class=\"btn btn-primary btn-sm\" onclick=\"expandAllFiles()\"><i class=\"fa fa-expand\"></i> Expand All</button>"
                        }
                    ],
                    "phpFilesCount": 2,
                    "phpFiles": [
                        "admin/manage_js_registry.php",
                        "admin/manage_registry.php"
                    ]
                },
                {
                    "name": "collapseAllFiles",
                    "line": 395,
                    "comment": "/**\n * Collapse all files\n */",
                    "code": "{\n    document.querySelectorAll('.functions-list').forEach(list => {\n        list.classList.remove('open');\n        list.style.maxHeight = '0';\n        list.style.overflow = 'hidden';\n        const header = list.previousElementSibling;\n        if (header) {\n            const arrow = header.querySelector('.expand-arrow');\n            if (arrow) arrow.textContent = '\u25b6';\n        }\n    });\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "event-listener",
                        "state-modifying",
                        "loops"
                    ],
                    "usageCount": 2,
                    "usages": [
                        {
                            "file": "tools/pages/js_registry.php",
                            "line": 99,
                            "context": "<button class=\"btn btn-sm btn-secondary\" onclick=\"collapseAllFiles()\">"
                        },
                        {
                            "file": "tools/pages/registry.php",
                            "line": 37,
                            "context": "<button class=\"btn btn-primary btn-sm\" onclick=\"collapseAllFiles()\"><i class=\"fa fa-compress\"></i> Collapse All</button>"
                        }
                    ],
                    "phpFilesCount": 2,
                    "phpFiles": [
                        "admin/manage_js_registry.php",
                        "admin/manage_registry.php"
                    ]
                },
                {
                    "name": "filterRegistry",
                    "line": 411,
                    "comment": "/**\n * Filter/search registry\n */",
                    "code": "{\n    const searchInput = document.getElementById('searchInput');\n    const categoryFilter = document.getElementById('categoryFilter');\n    const typeFilter = document.getElementById('typeFilter');\n    const searchMode = document.querySelector('input[name=\"searchMode\"]:checked');\n    \n    if (!searchInput || !searchMode) return;\n    \n    const term = searchInput.value.toLowerCase();\n    const categoryTerm = categoryFilter ? categoryFilter.value : '';\n    const typeTerm = typeFilter ? typeFilter.value : '';\n    const mode = searchMode.value;\n    \n    let visibleCount = 0;\n    \n    document.querySelectorAll('.file-section').forEach(section => {\n        const fileName = section.getAttribute('data-file').toLowerCase();\n        let hasVisibleFunc = false;\n        \n        section.querySelectorAll('.function-item').forEach(item => {\n            const funcName = item.getAttribute('data-func').toLowerCase();\n            const code = item.querySelector('.function-code') ? item.querySelector('.function-code').textContent.toLowerCase() : '';\n            const comment = item.querySelector('.function-comment') ? item.querySelector('.function-comment').textContent.toLowerCase() : '';\n            \n            // Get category and tags from the function object in registry data\n            let funcCategory = '';\n            let funcTags = [];\n            \n            if (registryData && registryData.files) {\n                for (let file of registryData.files) {\n                    const func = file.functions.find(f => f.name.toLowerCase() === funcName);\n                    if (func) {\n                        funcCategory = func.category || '';\n                        funcTags = func.tags || [];\n                        break;\n                    }\n                }\n            }\n            \n            let match = true;\n            \n            // Text search\n            if (term) {\n                let textMatch = false;\n                if (mode === 'all') {\n                    text",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "data-processing",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "state-modifying",
                        "loops",
                        "validation"
                    ],
                    "usageCount": 18,
                    "usages": [
                        {
                            "file": "js/manage-registry.js",
                            "line": 564,
                            "context": "filterRegistry();"
                        },
                        {
                            "file": "admin/pages/manage_js_registry.php",
                            "line": 133,
                            "context": "onkeyup=\"filterRegistry()\""
                        },
                        {
                            "file": "admin/pages/manage_js_registry.php",
                            "line": 140,
                            "context": "<select id=\"categoryFilter\" class=\"form-select form-select-sm\" onchange=\"filterRegistry()\">"
                        },
                        {
                            "file": "admin/pages/manage_js_registry.php",
                            "line": 156,
                            "context": "<select id=\"typeFilter\" class=\"form-select form-select-sm\" onchange=\"filterRegistry()\">"
                        },
                        {
                            "file": "admin/pages/manage_js_registry.php",
                            "line": 174,
                            "context": "<input class=\"form-check-input\" type=\"radio\" name=\"searchMode\" id=\"searchAll\" value=\"all\" checked onchange=\"filterRegistry()\">"
                        },
                        {
                            "file": "admin/pages/manage_js_registry.php",
                            "line": 178,
                            "context": "<input class=\"form-check-input\" type=\"radio\" name=\"searchMode\" id=\"searchName\" value=\"name\" onchange=\"filterRegistry()\">"
                        },
                        {
                            "file": "admin/pages/manage_js_registry.php",
                            "line": 182,
                            "context": "<input class=\"form-check-input\" type=\"radio\" name=\"searchMode\" id=\"searchCode\" value=\"code\" onchange=\"filterRegistry()\">"
                        },
                        {
                            "file": "admin/pages/manage_js_registry.php",
                            "line": 186,
                            "context": "<input class=\"form-check-input\" type=\"radio\" name=\"searchMode\" id=\"searchComment\" value=\"comment\" onchange=\"filterRegistry()\">"
                        },
                        {
                            "file": "admin/pages/manage_registry.php",
                            "line": 112,
                            "context": "onkeyup=\"filterRegistry()\""
                        },
                        {
                            "file": "admin/pages/manage_registry.php",
                            "line": 119,
                            "context": "<select id=\"categoryFilter\" class=\"form-select form-select-sm\" onchange=\"filterRegistry()\">"
                        },
                        {
                            "file": "admin/pages/manage_registry.php",
                            "line": 136,
                            "context": "<select id=\"typeFilter\" class=\"form-select form-select-sm\" onchange=\"filterRegistry()\">"
                        },
                        {
                            "file": "admin/pages/manage_registry.php",
                            "line": 153,
                            "context": "<input class=\"form-check-input\" type=\"radio\" name=\"searchMode\" id=\"searchAll\" value=\"all\" checked onchange=\"filterRegistry()\">"
                        },
                        {
                            "file": "admin/pages/manage_registry.php",
                            "line": 157,
                            "context": "<input class=\"form-check-input\" type=\"radio\" name=\"searchMode\" id=\"searchName\" value=\"name\" onchange=\"filterRegistry()\">"
                        },
                        {
                            "file": "admin/pages/manage_registry.php",
                            "line": 161,
                            "context": "<input class=\"form-check-input\" type=\"radio\" name=\"searchMode\" id=\"searchCode\" value=\"code\" onchange=\"filterRegistry()\">"
                        },
                        {
                            "file": "admin/pages/manage_registry.php",
                            "line": 165,
                            "context": "<input class=\"form-check-input\" type=\"radio\" name=\"searchMode\" id=\"searchComment\" value=\"comment\" onchange=\"filterRegistry()\">"
                        },
                        {
                            "file": "admin/pages/manage_registry.php",
                            "line": 169,
                            "context": "<input class=\"form-check-input\" type=\"radio\" name=\"searchMode\" id=\"searchParameters\" value=\"parameters\" onchange=\"filterRegistry()\">"
                        },
                        {
                            "file": "admin/pages/manage_registry.php",
                            "line": 173,
                            "context": "<input class=\"form-check-input\" type=\"radio\" name=\"searchMode\" id=\"searchReturns\" value=\"returns\" onchange=\"filterRegistry()\">"
                        },
                        {
                            "file": "tools/pages/registry.php",
                            "line": 35,
                            "context": "<input type=\"text\" id=\"searchInput\" class=\"form-control\" placeholder=\"Search functions...\" onkeyup=\"filterRegistry()\">"
                        }
                    ],
                    "phpFilesCount": 2,
                    "phpFiles": [
                        "admin/manage_js_registry.php",
                        "admin/manage_registry.php"
                    ]
                },
                {
                    "name": "clearSearch",
                    "line": 544,
                    "comment": "/**\n * Clear search\n */",
                    "code": "{\n    const searchInput = document.getElementById('searchInput');\n    const categoryFilter = document.getElementById('categoryFilter');\n    const typeFilter = document.getElementById('typeFilter');\n    const searchModeAll = document.getElementById('searchAll');\n    \n    if (searchInput) {\n        searchInput.value = '';\n    }\n    if (categoryFilter) {\n        categoryFilter.value = '';\n    }\n    if (typeFilter) {\n        typeFilter.value = '';\n    }\n    if (searchModeAll) {\n        searchModeAll.checked = true;\n    }\n    \n    filterRegistry();\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "filterRegistry"
                    ],
                    "category": "data-processing",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "state-modifying",
                        "validation"
                    ],
                    "usageCount": 4,
                    "usages": [
                        {
                            "file": "admin/pages/manage_js_registry.php",
                            "line": 193,
                            "context": "<button class=\"btn btn-sm btn-secondary\" onclick=\"clearSearch()\">"
                        },
                        {
                            "file": "admin/pages/manage_registry.php",
                            "line": 179,
                            "context": "<button class=\"btn btn-sm btn-secondary\" onclick=\"clearSearch()\">"
                        },
                        {
                            "file": "tools/pages/js_registry.php",
                            "line": 102,
                            "context": "<button class=\"btn btn-sm btn-secondary\" onclick=\"clearSearch()\">"
                        },
                        {
                            "file": "tools/pages/registry.php",
                            "line": 38,
                            "context": "<button class=\"btn btn-secondary btn-sm\" onclick=\"clearSearch()\"><i class=\"fa fa-times\"></i> Clear</button>"
                        }
                    ],
                    "phpFilesCount": 2,
                    "phpFiles": [
                        "admin/manage_js_registry.php",
                        "admin/manage_registry.php"
                    ]
                },
                {
                    "name": "downloadRegistry",
                    "line": 569,
                    "comment": "/**\n * Download registry as JSON\n */",
                    "code": "{\n    if (!registryData) return;\n    \n    const dataStr = JSON.stringify(registryData, null, 2);\n    const blob = new Blob([dataStr], {type: 'application/json'});\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = 'function_registry_' + new Date().toISOString().slice(0, 10) + '.json';\n    link.click();\n    URL.revokeObjectURL(url);\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "export",
                    "tags": [
                        "state-modifying"
                    ],
                    "usageCount": 4,
                    "usages": [
                        {
                            "file": "admin/pages/manage_js_registry.php",
                            "line": 63,
                            "context": "<button class=\"btn btn-info w-100\" onclick=\"downloadRegistry()\" title=\"Download as JSON\">"
                        },
                        {
                            "file": "admin/pages/manage_registry.php",
                            "line": 42,
                            "context": "<button class=\"btn btn-info w-100\" onclick=\"downloadRegistry()\" title=\"Download as JSON\">"
                        },
                        {
                            "file": "tools/pages/js_registry.php",
                            "line": 46,
                            "context": "<button class=\"btn btn-info w-100\" onclick=\"downloadRegistry()\" title=\"Download as JSON\">"
                        },
                        {
                            "file": "tools/pages/registry.php",
                            "line": 39,
                            "context": "<button class=\"btn btn-info btn-sm\" onclick=\"downloadRegistry()\"><i class=\"fa fa-download\"></i> Download JSON</button>"
                        }
                    ],
                    "phpFilesCount": 2,
                    "phpFiles": [
                        "admin/manage_js_registry.php",
                        "admin/manage_registry.php"
                    ]
                },
                {
                    "name": "generateRegistry",
                    "line": 585,
                    "comment": "/**\n * Generate registry by calling backend API\n */",
                    "code": "{\n    const btn = document.getElementById('generateBtn');\n    const msg = document.getElementById('registryMessage');\n    \n    if (!btn) return;\n    \n    // Get registry type from button data attribute (default to 'php')\n    const registryType = btn.getAttribute('data-registry-type') || 'php';\n    \n    btn.disabled = true;\n    btn.innerHTML = '<i class=\"fa fa-spinner fa-spin\"></i> Generating...';\n    \n    // Call the backend API to generate registry\n    fetch('/moop/admin/api/generate_registry.php', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({ type: registryType })\n    })\n    .then(response => response.json())\n    .then(data => {\n        btn.disabled = false;\n        btn.innerHTML = '<i class=\"fa fa-refresh\"></i> Generate/Update Registry';\n        \n        if (data.success) {\n            // Show success message\n            if (msg) {\n                msg.innerHTML = '<div class=\"alert alert-success alert-dismissible fade show\" role=\"alert\">' +\n                    '<i class=\"fa fa-check-circle\"></i> ' + data.message +\n                    '<button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\"></button>' +\n                    '</div>';\n            }\n            \n            // Reload page after 2 seconds to show updated status\n            setTimeout(() => {\n                location.reload();\n            }, 2000);\n        } else {\n            // Show error message\n            if (msg) {\n                msg.innerHTML = '<div class=\"alert alert-danger alert-dismissible fade show\" role=\"alert\">' +\n                    '<i class=\"fa fa-exclamation-circle\"></i> ' + data.message +\n                    '<button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\"></button>' +\n                    '</div>';\n            }\n        }\n    })\n    .catch(error => {\n        btn.disabled = false;\n        btn.innerHTML = '<i class=\"fa fa-refresh\"></i> Generate/Update Registry';",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "asynchronous",
                        "ajax",
                        "event-listener",
                        "state-modifying",
                        "error-handling",
                        "validation"
                    ],
                    "usageCount": 4,
                    "usages": [
                        {
                            "file": "admin/pages/manage_js_registry.php",
                            "line": 58,
                            "context": "<button class=\"btn btn-primary w-100\" onclick=\"generateRegistry()\" id=\"generateBtn\" data-registry-type=\"js\">"
                        },
                        {
                            "file": "admin/pages/manage_registry.php",
                            "line": 37,
                            "context": "<button class=\"btn btn-primary w-100\" onclick=\"generateRegistry()\" id=\"generateBtn\" data-registry-type=\"php\">"
                        },
                        {
                            "file": "tools/pages/js_registry.php",
                            "line": 41,
                            "context": "<button class=\"btn btn-primary w-100\" onclick=\"generateRegistry()\" id=\"generateBtn\" data-registry-type=\"js\">"
                        },
                        {
                            "file": "tools/pages/registry.php",
                            "line": 40,
                            "context": "<button class=\"btn btn-warning btn-sm\" onclick=\"generateRegistry()\"><i class=\"fa fa-refresh\"></i> Regenerate</button>"
                        }
                    ],
                    "phpFilesCount": 2,
                    "phpFiles": [
                        "admin/manage_js_registry.php",
                        "admin/manage_registry.php"
                    ]
                },
                {
                    "name": "htmlEscape",
                    "line": 649,
                    "comment": "/**\n * HTML escape utility\n */",
                    "code": "{\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "event-listener",
                        "state-modifying"
                    ],
                    "usageCount": 12,
                    "usages": [
                        {
                            "file": "js/manage-registry.js",
                            "line": 58,
                            "context": "\ud83d\udcc4 ${htmlEscape(fileData.name)} <span class=\"badge bg-secondary\" title=\"Number of functions in this file\">[ contain ${fileData.count} function${fileData.count !== 1 ? 's' : ''} ]</span>"
                        },
                        {
                            "file": "js/manage-registry.js",
                            "line": 94,
                            "context": "categoryBadge = `<span class=\"badge\" style=\"background-color: ${bgColor}; color: #333; font-size: 11px; margin-left: 8px;\">${htmlEscape(func.category)}</span>`;"
                        },
                        {
                            "file": "js/manage-registry.js",
                            "line": 119,
                            "context": "return `<span class=\"badge\" style=\"background-color: ${bgColor}; color: #333; font-size: 10px; margin-left: 4px;\">${htmlEscape(tag)}</span>`;"
                        },
                        {
                            "file": "js/manage-registry.js",
                            "line": 125,
                            "context": "<span class=\"function-name\">${htmlEscape(func.name)}()</span>"
                        },
                        {
                            "file": "js/manage-registry.js",
                            "line": 162,
                            "context": "metadataHTML += `<li style=\"font-size: 12px; color: #333;\"><code>${htmlEscape(param.name)}</code> <span style=\"color: #999;\">({${htmlEscape(param.type)}})</span> - ${htmlEscape(param.description || 'no description')}</li>`;"
                        },
                        {
                            "file": "js/manage-registry.js",
                            "line": 170,
                            "context": "metadataHTML += `<span style=\"color: #666; font-size: 12px;\"><strong>Returns:</strong> <code>${htmlEscape(func.returnType)}</code></span>`;"
                        },
                        {
                            "file": "js/manage-registry.js",
                            "line": 172,
                            "context": "metadataHTML += ` - ${htmlEscape(func.returnDescription)}`;"
                        },
                        {
                            "file": "js/manage-registry.js",
                            "line": 190,
                            "context": "depsHTML += func.internalCalls.map(call => `<code style=\"background: #c8e6c9; padding: 2px 6px; border-radius: 3px; margin: 2px 2px 2px 0; display: inline-block; font-size: 11px;\">${htmlEscape(call)}()</code>`).join('');"
                        },
                        {
                            "file": "js/manage-registry.js",
                            "line": 207,
                            "context": "html += `<li><code>${htmlEscape(phpFile)}</code></li>`;"
                        },
                        {
                            "file": "js/manage-registry.js",
                            "line": 232,
                            "context": "html += `<li><strong>${htmlEscape(file)}</strong> (${usages.length}x)"
                        },
                        {
                            "file": "js/manage-registry.js",
                            "line": 236,
                            "context": "html += `<li><code>line ${usage.line}</code>: <small>${htmlEscape(usage.context.substring(0, 80))}</small></li>`;"
                        },
                        {
                            "file": "js/manage-registry.js",
                            "line": 251,
                            "context": "code.innerHTML = `<pre>${htmlEscape(func.code)}</pre>`;"
                        }
                    ],
                    "phpFilesCount": 2,
                    "phpFiles": [
                        "admin/manage_js_registry.php",
                        "admin/manage_registry.php"
                    ]
                }
            ]
        },
        {
            "name": "js/modules/blast-canvas-graph.js",
            "count": 5,
            "functions": [
                {
                    "name": "draw_blast_graph",
                    "line": 2,
                    "comment": "",
                    "code": "{\n\n    var img_height = 2000;\n    var img_width = 920;\n    var canvas_width = 1000;\n\n    var xscale = +(img_width/seq_length); // to transform sequence length to pixels\n\n    //Create canvas stage\n    var kjs_canvas = new Kinetic.Stage({\n      container: \"myCanvas\",\n      width: canvas_width,\n      height: 700\n    });\n\n    var ksj_layer = new Kinetic.Layer();\n\n    var query_length_text = new Kinetic.Text({\n      x: 0,\n      y: 35,\n      text: \"Query length (\"+seq_length+\")\",\n      fill: \"#333\",\n      fontSize: 20,\n      width: canvas_width,\n      align: \"center\",\n      fontFamily: 'Helvetica'\n    });\n\n    ksj_layer.add(query_length_text);\n\n    // print score legend on top_line\n    var score_legend_0 = new Kinetic.Rect({\n      x: 0,\n      y: 0,\n      width: canvas_width/5 +5,\n      height: 30,\n      fill: \"#000\",\n    })\n\n    var score_legend_40 = new Kinetic.Rect({\n      x: canvas_width/5 +1,\n      y: 0,\n      width: canvas_width/5 +5,\n      height: 30,\n      fill: \"#0047c8\",\n    })\n\n    var score_legend_50 = new Kinetic.Rect({\n      x: 2*canvas_width/5 +1,\n      y: 0,\n      width: canvas_width/5 +5,\n      height: 30,\n      fill: \"#77de75\",\n    })\n\n    var score_legend_80 = new Kinetic.Rect({\n      x: 3*canvas_width/5 +1,\n      y: 0,\n      width: canvas_width/5 +5,\n      height: 30,\n      fill: \"#e967f5\",\n    })\n\n    var score_legend_200 = new Kinetic.Rect({\n      x: 4*canvas_width/5 +1,\n      y: 0,\n      width: canvas_width/5 +5,\n      height: 30,\n      fill: \"#e83a2d\",\n    })\n\n    ksj_layer.add(score_legend_0);\n    ksj_layer.add(score_legend_40);\n    ksj_layer.add(score_legend_50);\n    ksj_layer.add(score_legend_80);\n    ksj_layer.add(score_legend_200);\n\n    var score_text_0 = new Kinetic.Text({\n      x: 0,\n      y: 10,\n      text: \"<40\",\n      fill: \"#fff\",\n      fontSize: 16,\n      width: (canvas_width/5),\n      align: \"center\",\n      fontFamily: 'Helvetica'\n    });\n\n    var score_text_40 = new Kinetic.Text({\n      x: canvas_width/5,\n      y: 10,\n      text: \"40-5",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "blast",
                    "tags": [
                        "state-modifying"
                    ],
                    "usageCount": 0,
                    "usages": [],
                    "phpFilesCount": 0,
                    "phpFiles": []
                },
                {
                    "name": "printRectangles",
                    "line": 205,
                    "comment": "",
                    "code": "{\n\n    var xscale = +(img_width/seq_length); // to transform sequence length to pixels\n    var off_set = 80; //just under the horizontal line\n    var coord_y = 0;\n    var sqr_height = 16;\n    var before_block = 20;\n\n    var description;\n    var canvas_width = kjs_canvas.width();\n    var prev_subject = \"grjhg\";\n\n    var rectangle_layer = new Kinetic.Layer();\n    kjs_canvas.add(rectangle_layer);\n\n    var popup_layer = new Kinetic.Layer();\n    kjs_canvas.add(popup_layer);\n\n    var row = 1;\n\n    // each track\n    for (var t=0; t<sgn_graph_array.length; t++) {\n\n      var subject_name = sgn_graph_array[t][\"name\"];\n      var subject_desc = sgn_graph_array[t][\"description\"];\n      var subject_start = sgn_graph_array[t][\"qstart\"];\n      var subject_end = sgn_graph_array[t][\"qend\"];\n      var subject_score = sgn_graph_array[t][\"score\"];\n      var subject_id_percent = sgn_graph_array[t][\"id_percent\"];\n      var s_description = subject_name+\" \"+subject_start+\"-\"+subject_end+\" \"+subject_desc\n      var next_subject = \"null\"\n\n      // alert(\"subject_name: \"+subject_name);\n      // alert(\"subject_desc: \"+subject_desc);\n      // alert(\"subject_start: \"+subject_start);\n      // alert(\"subject_end: \"+subject_end);\n      // alert(\"subject_score: \"+subject_score);\n      // alert(\"subject_id_percent: \"+subject_id_percent);\n\n      if (sgn_graph_array[t+1]) {\n        next_subject = sgn_graph_array[t+1][\"name\"]\n      } else {\n        next_subject = \"null\"\n      }\n\n      if (prev_subject != subject_name) {\n        row = 1;\n      }\n\n\n      m_width = +((+subject_end - +subject_start +1)*xscale); //rectangle width in pixels\n      m_start = +(+subject_start*xscale); //rectangle start in pixels\n      score = +subject_score;\n\n      // var strokeColor = \"#dfdfdf\";\n      var fillColor = \"rgba(255, 50, 40, 0.8)\";\n\n      //set color\n      if (score >= 200) {\n        fillColor = \"rgba(255, 50, 40, 0.8)\";\n      } else if (score < 200 && score >= 80) {\n        fillColor ='rgba(235,96,247, 0.8)';\n      }",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "blast",
                    "tags": [
                        "state-modifying",
                        "loops"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "js/modules/blast-canvas-graph.js",
                            "line": 198,
                            "context": "off_set = printRectangles(kjs_canvas,sgn_graph_array,seq_length,img_width);"
                        }
                    ],
                    "phpFilesCount": 0,
                    "phpFiles": []
                },
                {
                    "name": "move_bg_rect",
                    "line": 437,
                    "comment": "",
                    "code": "{\n\n    pos += 1;\n\n    return pos;\n  }",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "blast",
                    "tags": [],
                    "usageCount": 0,
                    "usages": [],
                    "phpFilesCount": 0,
                    "phpFiles": []
                },
                {
                    "name": "draw_popup",
                    "line": 445,
                    "comment": "",
                    "code": "{\n\n    blastHit.on('mouseover', function() {\n\n\n       var desc_group = new Kinetic.Group();\n\n      document.body.style.cursor = 'pointer';\n      var hit_x = this.getAbsolutePosition().x + this.width()/2;\n      var hit_y = this.getAbsolutePosition().y-26;\n\n      //print subject descriptions\n      var subject_desc = new Kinetic.Text({\n        x: hit_x,\n        y: hit_y-5,\n        text: desc,\n        fill: \"black\",\n        fontSize: 16,\n        fontFamily: 'Helvetica'\n      });\n\n       subject_desc.x(hit_x - subject_desc.width()/2);\n\n      var desc_width = subject_desc.width();\n\n      var hit_popup = new Kinetic.Rect({\n         x: subject_desc.x()-5,\n         y: subject_desc.y()-5,\n         fill: '#fff',\n         stroke: \"#aaa\",\n         opacity: 1,\n         width: subject_desc.width()+10,\n         height: 30,\n         cornerRadius: 2,\n         strokeWidth: 1\n       });\n\n       var x_arrow = hit_popup.x() + hit_popup.width()/2;\n       var y_arrow = hit_popup.y()+12;\n\n\n       var down_arrow = new Kinetic.Line({\n         points: [x_arrow-15,y_arrow,    x_arrow+15,y_arrow,    x_arrow,y_arrow+30,    x_arrow-15,y_arrow],\n         stroke: \"#aaa\",\n         strokeWidth: 1,\n         closed: true,\n         fill: '#fff',\n         lineCap: 'round',\n         cornerRadius: 2,\n         tension: 0\n      });\n\n       var arrow_junction = new Kinetic.Line({\n         points: [x_arrow-13,y_arrow,    x_arrow+13,y_arrow,    x_arrow,y_arrow+28,    x_arrow-13,y_arrow],\n         stroke: \"#fff\",\n         strokeWidth: 1,\n         closed: true,\n         fill: '#fff',\n         lineCap: 'round',\n         cornerRadius: 2,\n         tension: 0\n      });\n\n       if (desc_width + hit_x > canvas_width) {\n         subject_desc.x(canvas_width - desc_width -10);\n         hit_popup.x(subject_desc.x()-5);\n\n         if (desc_width > canvas_width) {\n           subject_desc.x(10);\n           subject_desc.y(hit_y-15);\n           subject_desc.width(canvas_width-20);\n\n           hit_popup.x(subject_desc.x()-5);",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "blast",
                    "tags": [
                        "ajax",
                        "event-listener",
                        "state-modifying"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "js/modules/blast-canvas-graph.js",
                            "line": 381,
                            "context": "draw_popup(canvas_width,blastHit,popup_layer,s_description);"
                        }
                    ],
                    "phpFilesCount": 0,
                    "phpFiles": []
                },
                {
                    "name": "track_height",
                    "line": 413,
                    "comment": "",
                    "code": "{\n          points: [0, off_set,canvas_width, off_set],\n          stroke: \"#ccc\",\n          strokeWidth: 1,\n        }",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "blast",
                    "tags": [],
                    "usageCount": 0,
                    "usages": [],
                    "phpFilesCount": 0,
                    "phpFiles": []
                }
            ]
        },
        {
            "name": "js/modules/copy-to-clipboard.js",
            "count": 3,
            "functions": [
                {
                    "name": "initializeCopyToClipboard",
                    "line": 6,
                    "comment": "/**\n * Copy to Clipboard Utility Module\n * Handles copy-to-clipboard functionality for sequence displays with custom tooltips\n * Can be used by any page that has elements with class \"copyable\"\n */\n",
                    "code": "{\n    // Handle copy to clipboard for sequences\n    const copyables = document.querySelectorAll(\".copyable\");\n    copyables.forEach(el => {\n        let resetColorTimeout;\n        el.addEventListener(\"click\", function () {\n            const text = el.innerText.trim();\n            navigator.clipboard.writeText(text).then(() => {\n                el.classList.add(\"bg-success\", \"text-white\");\n                if (resetColorTimeout) clearTimeout(resetColorTimeout);\n                resetColorTimeout = setTimeout(() => {\n                    el.classList.remove(\"bg-success\", \"text-white\");\n                }, 1500);\n            }).catch(err => console.error(\"Copy failed:\", err));\n        });\n    });\n\n    // Initialize tooltips after a small delay to ensure Bootstrap is fully loaded\n    setTimeout(() => {\n        initializeCopyTooltips();\n    }, 500);\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "initializeCopyTooltips"
                    ],
                    "category": "general",
                    "tags": [
                        "dom-manipulation",
                        "asynchronous",
                        "event-listener",
                        "state-modifying",
                        "loops",
                        "error-handling"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "js/modules/copy-to-clipboard.js",
                            "line": 81,
                            "context": "initializeCopyToClipboard();"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "tools/sequences_display.php"
                    ]
                },
                {
                    "name": "initializeCopyTooltips",
                    "line": 29,
                    "comment": "",
                    "code": "{\n    const copyables = document.querySelectorAll(\".copyable\");\n    copyables.forEach(el => {\n        // Custom simple tooltip that follows cursor\n        el.addEventListener(\"mouseenter\", function() {\n            // Remove any existing tooltip\n            const existing = document.getElementById(\"custom-copy-tooltip\");\n            if (existing) existing.remove();\n            \n            // Create simple tooltip\n            const tooltip = document.createElement(\"div\");\n            tooltip.id = \"custom-copy-tooltip\";\n            tooltip.textContent = \"Click to copy\";\n            tooltip.style.cssText = `\n                position: fixed;\n                background-color: #000;\n                color: #fff;\n                padding: 5px 10px;\n                border-radius: 4px;\n                font-size: 12px;\n                white-space: nowrap;\n                pointer-events: none;\n                z-index: 9999;\n            `;\n            document.body.appendChild(tooltip);\n            \n            // Update position on mousemove\n            const updatePosition = (e) => {\n                tooltip.style.left = (e.clientX + 10) + \"px\";\n                tooltip.style.top = (e.clientY - 30) + \"px\";\n            };\n            \n            el.addEventListener(\"mousemove\", updatePosition);\n            \n            // Initial position\n            updatePosition(event);\n            \n            el.addEventListener(\"mouseleave\", function() {\n                const existing = document.getElementById(\"custom-copy-tooltip\");\n                if (existing) existing.remove();\n                el.removeEventListener(\"mousemove\", updatePosition);\n            }, { once: true });\n        });\n    });\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "updatePosition"
                    ],
                    "category": "general",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "event-listener",
                        "state-modifying",
                        "loops"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "js/modules/copy-to-clipboard.js",
                            "line": 26,
                            "context": "initializeCopyTooltips();"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "tools/sequences_display.php"
                    ]
                },
                {
                    "name": "updatePosition",
                    "line": 57,
                    "comment": "",
                    "code": "{\n                tooltip.style.left = (e.clientX + 10) + \"px\";\n                tooltip.style.top = (e.clientY - 30) + \"px\";\n            }",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "general",
                    "tags": [
                        "state-modifying"
                    ],
                    "usageCount": 2,
                    "usages": [
                        {
                            "file": "js/sequence-retrieval.js",
                            "line": 276,
                            "context": "updatePosition(event);"
                        },
                        {
                            "file": "js/modules/copy-to-clipboard.js",
                            "line": 65,
                            "context": "updatePosition(event);"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "tools/sequences_display.php"
                    ]
                }
            ]
        },
        {
            "name": "js/modules/datatable-config.js",
            "count": 1,
            "functions": [
                {
                    "name": "text",
                    "line": 61,
                    "comment": "",
                    "code": "{\n        if (!DataTableExportConfig.validateSelectedRows()) {\n            return;\n        }\n        \n        const featureIds = DataTableExportConfig.extractFeatureIds(dt);\n        if (!featureIds || featureIds.length === 0) {\n            alert('No valid Feature IDs found.');\n            return;\n        }\n        \n        // Get organism from the table element's closest ancestor with class \"organism-results\"\n        const tableElement = dt.table().node();\n        const organismDiv = $(tableElement).closest('.organism-results');\n        const anchorId = organismDiv.attr('id'); // Format: \"results-Organism_name\"\n        \n        let organism = window.currentOrganism;\n        \n        if (!organism && anchorId) {\n            // Extract organism from anchor ID (format: results-Organism_name)\n            organism = anchorId.replace('results-', '');\n        }\n        \n        if (!organism) {\n            alert('Organism information not available.');\n            return;\n        }\n        \n        // Get assembly from first selected row\n        const checkedRows = $('input.row-select:checked');\n        let assembly = '';\n        if (checkedRows.length > 0) {\n            const firstSelectedRow = $(checkedRows[0]).closest('tr');\n            // The data-genome-accession is URL-encoded when stored, so decode it\n            const encodedAssembly = firstSelectedRow.attr('data-genome-accession') || '';\n            assembly = encodedAssembly ? decodeURIComponent(encodedAssembly) : '';\n        }\n        \n        if (!assembly) {\n            alert('Assembly information not available for selected rows.');\n            return;\n        }\n        \n        const form = document.createElement('form');\n        form.method = 'POST';\n        \n        // Build URL with selected source and context parameters\n        let formUrl = sitePath + '/tools/retrieve_selected_sequences.php?organism=' + encodeURIComponent(organism) + '&assembly=' + encodeURIComponent(assembly);\n        \n        // Add con",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "datatable",
                    "tags": [
                        "state-modifying",
                        "validation"
                    ],
                    "usageCount": 10,
                    "usages": [
                        {
                            "file": "js/modules/annotation-search.js",
                            "line": 274,
                            "context": "$('#progressFill').css('width', progress + '%').text(progress + '%');"
                        },
                        {
                            "file": "js/modules/blast-canvas-graph.js",
                            "line": 320,
                            "context": "var gene_name = this.text();"
                        },
                        {
                            "file": "js/modules/blast-canvas-graph.js",
                            "line": 335,
                            "context": "var gene_name = this.text();"
                        },
                        {
                            "file": "js/modules/blast-canvas-graph.js",
                            "line": 358,
                            "context": "var gene_name = this.text();"
                        },
                        {
                            "file": "js/modules/datatable-config.js",
                            "line": 45,
                            "context": "if ($(dt.column(idx).header()).text().trim().toLowerCase() === 'feature id') {"
                        },
                        {
                            "file": "js/modules/manage-annotations.js",
                            "line": 74,
                            "context": "$('#editTypeDescName').text(typeName);"
                        },
                        {
                            "file": "js/modules/shared-results-table.js",
                            "line": 240,
                            "context": "$btn.find('span').text('Select All');"
                        },
                        {
                            "file": "js/modules/shared-results-table.js",
                            "line": 243,
                            "context": "$btn.find('span').text('Deselect All');"
                        },
                        {
                            "file": "js/modules/shared-results-table.js",
                            "line": 255,
                            "context": "$btn.find('span').text('Deselect All');"
                        },
                        {
                            "file": "js/modules/shared-results-table.js",
                            "line": 257,
                            "context": "$btn.find('span').text('Select All');"
                        }
                    ],
                    "phpFilesCount": 0,
                    "phpFiles": []
                }
            ]
        },
        {
            "name": "js/modules/download-handler.js",
            "count": 3,
            "functions": [
                {
                    "name": "download",
                    "line": 10,
                    "comment": "",
                    "code": "{\r\n\t\r\n\tvar self = window, // this script is only for browsers anyway...\r\n\t\tu = \"application/octet-stream\", // this default mime also triggers iframe downloads\r\n\t\tm = strMimeType || u, \r\n\t\tx = data,\r\n\t\tD = document,\r\n\t\ta = D.createElement(\"a\"),\r\n\t\tz = function(a){return String(a);},\r\n\t\t\r\n\t\t\r\n\t\tB = self.Blob || self.MozBlob || self.WebKitBlob || z,\r\n\t\tBB = self.MSBlobBuilder || self.WebKitBlobBuilder || self.BlobBuilder,\r\n\t\tfn = strFileName || \"download\",\r\n\t\tblob, \r\n\t\tb,\r\n\t\tua,\r\n\t\tfr;\r\n\r\n\t//if(typeof B.bind === 'function' ){ B=B.bind(self); }\r\n\t\r\n\tif(String(this)===\"true\"){ //reverse arguments, allowing download.bind(true, \"text/xml\", \"export.xml\") to act as a callback\r\n\t\tx=[x, m];\r\n\t\tm=x[0];\r\n\t\tx=x[1]; \r\n\t}\r\n\t\r\n\t\r\n\t\r\n\t//go ahead and download dataURLs right away\r\n\tif(String(x).match(/^data\\:[\\w+\\-]+\\/[\\w+\\-]+[,;]/)){\r\n\t\treturn navigator.msSaveBlob ?  // IE10 can't do a[download], only Blobs:\r\n\t\t\tnavigator.msSaveBlob(d2b(x), fn) : \r\n\t\t\tsaver(x) ; // everyone else can save dataURLs un-processed\r\n\t}//end if dataURL passed?\r\n\t\r\n\ttry{\r\n\t\r\n\t\tblob = x instanceof B ? \r\n\t\t\tx : \r\n\t\t\tnew B([x], {type: m}) ;\r\n\t}catch(y){\r\n\t\tif(BB){\r\n\t\t\tb = new BB();\r\n\t\t\tb.append([x]);\r\n\t\t\tblob = b.getBlob(m); // the blob\r\n\t\t}\r\n\t\t\r\n\t}\r\n\t\r\n\t\r\n\t\r\n\tfunction d2b(u) {\r\n\t\tvar p= u.split(/[:;,]/),\r\n\t\tt= p[1],\r\n\t\tdec= p[2] == \"base64\" ? atob : decodeURIComponent,\r\n\t\tbin= dec(p.pop()),\r\n\t\tmx= bin.length,\r\n\t\ti= 0,\r\n\t\tuia= new Uint8Array(mx);\r\n\r\n\t\tfor(i;i<mx;++i) uia[i]= bin.charCodeAt(i);\r\n\r\n\t\treturn new B([uia], {type: t});\r\n\t }\r\n\t  \r\n\tfunction saver(url, winMode){\r\n\t\t\r\n\t\t\r\n\t\tif ('download' in a) { //html5 A[download] \t\t\t\r\n\t\t\ta.href = url;\r\n\t\t\ta.setAttribute(\"download\", fn);\r\n\t\t\ta.innerHTML = \"downloading...\";\r\n\t\t\tD.body.appendChild(a);\r\n\t\t\tsetTimeout(function() {\r\n\t\t\t\ta.click();\r\n\t\t\t\tD.body.removeChild(a);\r\n\t\t\t\tif(winMode===true){setTimeout(function(){ self.URL.revokeObjectURL(a.href);}, 250 );}\r\n\t\t\t}, 66);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t\t//do iframe dataURL download (old ch+FF):\r\n\t\tvar f = D.createElement(\"",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "saver",
                        "d2b",
                        "download"
                    ],
                    "category": "export",
                    "tags": [
                        "dom-manipulation",
                        "asynchronous",
                        "ajax",
                        "state-modifying",
                        "loops",
                        "error-handling"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "js/modules/download-handler.js",
                            "line": 131,
                            "context": "} /* end download() */"
                        }
                    ],
                    "phpFilesCount": 0,
                    "phpFiles": []
                },
                {
                    "name": "d2b",
                    "line": 63,
                    "comment": "",
                    "code": "{\r\n\t\tvar p= u.split(/[:;,]/),\r\n\t\tt= p[1],\r\n\t\tdec= p[2] == \"base64\" ? atob : decodeURIComponent,\r\n\t\tbin= dec(p.pop()),\r\n\t\tmx= bin.length,\r\n\t\ti= 0,\r\n\t\tuia= new Uint8Array(mx);\r\n\r\n\t\tfor(i;i<mx;++i) uia[i]= bin.charCodeAt(i);\r\n\r\n\t\treturn new B([uia], {type: t});\r\n\t }",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "general",
                    "tags": [
                        "state-modifying",
                        "loops"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "js/modules/download-handler.js",
                            "line": 43,
                            "context": "navigator.msSaveBlob(d2b(x), fn) :"
                        }
                    ],
                    "phpFilesCount": 0,
                    "phpFiles": []
                },
                {
                    "name": "saver",
                    "line": 77,
                    "comment": "",
                    "code": "{\r\n\t\t\r\n\t\t\r\n\t\tif ('download' in a) { //html5 A[download] \t\t\t\r\n\t\t\ta.href = url;\r\n\t\t\ta.setAttribute(\"download\", fn);\r\n\t\t\ta.innerHTML = \"downloading...\";\r\n\t\t\tD.body.appendChild(a);\r\n\t\t\tsetTimeout(function() {\r\n\t\t\t\ta.click();\r\n\t\t\t\tD.body.removeChild(a);\r\n\t\t\t\tif(winMode===true){setTimeout(function(){ self.URL.revokeObjectURL(a.href);}, 250 );}\r\n\t\t\t}, 66);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t\t//do iframe dataURL download (old ch+FF):\r\n\t\tvar f = D.createElement(\"iframe\");\r\n\t\tD.body.appendChild(f);\r\n\t\tif(!winMode){ // force a mime that will download:\r\n\t\t\turl=\"data:\"+url.replace(/^data:([\\w\\/\\-\\+]+)/, u);\r\n\t\t}\r\n\t\t \r\n\t\r\n\t\tf.src = url;\r\n\t\tsetTimeout(function(){ D.body.removeChild(f); }, 333);\r\n\t\t\r\n\t}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "download"
                    ],
                    "category": "general",
                    "tags": [
                        "dom-manipulation",
                        "asynchronous",
                        "state-modifying"
                    ],
                    "usageCount": 5,
                    "usages": [
                        {
                            "file": "js/modules/download-handler.js",
                            "line": 44,
                            "context": "saver(x) ; // everyone else can save dataURLs un-processed"
                        },
                        {
                            "file": "js/modules/download-handler.js",
                            "line": 112,
                            "context": "saver(self.URL.createObjectURL(blob), true);"
                        },
                        {
                            "file": "js/modules/download-handler.js",
                            "line": 117,
                            "context": "return saver( \"data:\" +  m   + \";base64,\"  +  self.btoa(blob)  );"
                        },
                        {
                            "file": "js/modules/download-handler.js",
                            "line": 119,
                            "context": "return saver( \"data:\" +  m   + \",\" + encodeURIComponent(blob)  );"
                        },
                        {
                            "file": "js/modules/download-handler.js",
                            "line": 126,
                            "context": "saver(this.result);"
                        }
                    ],
                    "phpFilesCount": 0,
                    "phpFiles": []
                }
            ]
        },
        {
            "name": "js/modules/manage-annotations.js",
            "count": 4,
            "functions": [
                {
                    "name": "saveTypeOrder",
                    "line": 98,
                    "comment": "",
                    "code": "{\n    const newOrder = [];\n    $('#sortable-annotation-types .card').each(function() {\n        const type = $(this).data('type');\n        if (type) {\n            newOrder.push(type);\n        }\n    });\n    \n    console.log('saveTypeOrder called');\n    console.log('Saving annotation type order:', newOrder);\n    console.log('Order array length:', newOrder.length);\n    \n    if (newOrder.length === 0) {\n        console.error('No types found to save!');\n        return;\n    }\n    \n    // Use fetch API for more reliable form submission\n    fetch('manage_annotations.php', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/x-www-form-urlencoded',\n        },\n        body: new URLSearchParams({\n            'update_type_order': '1',\n            'type_order_data': JSON.stringify(newOrder)\n        })\n    })\n    .then(response => {\n        console.log('Response received:', response.status);\n        if (response.ok) {\n            console.log('Order saved successfully');\n            // Show brief success message\n            showSaveNotification('Order saved successfully');\n        } else {\n            console.error('Server error:', response.status);\n            showSaveNotification('Error saving order. Please try again.', 'danger');\n        }\n    })\n    .catch(error => {\n        console.error('Error submitting form:', error);\n        showSaveNotification('Error saving order: ' + error.message, 'danger');\n    });\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "showSaveNotification"
                    ],
                    "category": "admin",
                    "tags": [
                        "asynchronous",
                        "ajax",
                        "event-listener",
                        "state-modifying",
                        "error-handling"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "js/modules/manage-annotations.js",
                            "line": 30,
                            "context": "saveTypeOrder();"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_annotations.php"
                    ]
                },
                {
                    "name": "showSaveNotification",
                    "line": 145,
                    "comment": "",
                    "code": "{\n    const alertDiv = $('<div>')\n        .addClass('alert alert-' + type + ' alert-dismissible fade show')\n        .attr('role', 'alert')\n        .html(message + '<button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\"></button>');\n    \n    // Insert at top of page and auto-dismiss after 3 seconds\n    $('main, .container, body').first().prepend(alertDiv);\n    setTimeout(() => {\n        alertDiv.fadeOut(300, function() { $(this).remove(); });\n    }, 3000);\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "ui-dom",
                    "tags": [
                        "asynchronous",
                        "state-modifying"
                    ],
                    "usageCount": 3,
                    "usages": [
                        {
                            "file": "js/modules/manage-annotations.js",
                            "line": 133,
                            "context": "showSaveNotification('Order saved successfully');"
                        },
                        {
                            "file": "js/modules/manage-annotations.js",
                            "line": 136,
                            "context": "showSaveNotification('Error saving order. Please try again.', 'danger');"
                        },
                        {
                            "file": "js/modules/manage-annotations.js",
                            "line": 141,
                            "context": "showSaveNotification('Error saving order: ' + error.message, 'danger');"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_annotations.php"
                    ]
                },
                {
                    "name": "toggleTypeDetails",
                    "line": 159,
                    "comment": "",
                    "code": "{\n  const details = document.getElementById('details-' + typeName);\n  const button = document.querySelector(`[data-type=\"${typeName}\"].expand-type-btn`);\n  if (details) {\n    if (details.style.display === 'none') {\n      details.style.display = 'block';\n      button.querySelector('i').className = 'fa fa-chevron-up';\n    } else {\n      details.style.display = 'none';\n      button.querySelector('i').className = 'fa fa-chevron-down';\n    }\n  }\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "state-modifying"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "js/modules/manage-annotations.js",
                            "line": 202,
                            "context": "toggleTypeDetails(typeName);"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_annotations.php"
                    ]
                },
                {
                    "name": "deleteType",
                    "line": 174,
                    "comment": "",
                    "code": "{\n  if (confirm('Delete annotation type \"' + typeName + '\"? This cannot be undone.')) {\n    const form = document.createElement('form');\n    form.method = 'POST';\n    \n    const typeInput = document.createElement('input');\n    typeInput.type = 'hidden';\n    typeInput.name = 'type_name';\n    typeInput.value = typeName;\n    form.appendChild(typeInput);\n    \n    const deleteInput = document.createElement('input');\n    deleteInput.type = 'hidden';\n    deleteInput.name = 'delete_annotation_type';\n    deleteInput.value = '1';\n    form.appendChild(deleteInput);\n    \n    document.body.appendChild(form);\n    form.submit();\n  }\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "state-modifying"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "admin/pages/manage_annotations.php",
                            "line": 185,
                            "context": "<button type=\"button\" class=\"btn btn-sm btn-danger mt-2\" onclick=\"deleteType('<?= htmlspecialchars($type_name) ?>')\">"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_annotations.php"
                    ]
                }
            ]
        },
        {
            "name": "js/modules/manage-groups.js",
            "count": 8,
            "functions": [
                {
                    "name": "toggleGroup",
                    "line": 7,
                    "comment": "",
                    "code": "{\n  const content = document.getElementById('content-' + groupName);\n  const header = event.target.closest('.group-header');\n  const arrow = header.querySelector('span:last-child');\n  \n  if (content.style.display === 'none') {\n    content.style.display = 'block';\n    arrow.textContent = '\u25b2';\n  } else {\n    content.style.display = 'none';\n    arrow.textContent = '\u25bc';\n  }\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "event-listener",
                        "state-modifying"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "admin/pages/manage_groups.php",
                            "line": 305,
                            "context": "<div class=\"group-header\" onclick=\"toggleGroup('<?= htmlspecialchars($desc['group_name']) ?>')\" style=\"cursor: pointer; padding: 10px; background: #f8f9fa; border-radius: 3px; display: flex; justify-content: space-between; align-items: center;\">"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_groups.php"
                    ]
                },
                {
                    "name": "addImage",
                    "line": 21,
                    "comment": "",
                    "code": "{\n  const container = document.getElementById('images-container-' + groupName);\n  const newIndex = container.children.length;\n  \n  const html = `\n    <div class=\"image-item\" data-index=\"${newIndex}\" style=\"border: 1px solid #dee2e6; padding: 15px; margin-bottom: 10px; border-radius: 5px; background: #f8f9fa;\">\n      <button type=\"button\" class=\"btn btn-sm btn-danger remove-btn\" onclick=\"removeImage('${groupName}', ${newIndex})\" style=\"float: right;\" ${isDescFileWriteError ? 'disabled data-bs-toggle=\"modal\" data-bs-target=\"#permissionModal\"' : ''}>Remove</button>\n      <div class=\"form-group\">\n        <label>Image File</label>\n        <input type=\"text\" class=\"form-control image-file\" value=\"\" placeholder=\"e.g., Reef0607_0.jpg\">\n      </div>\n      <div class=\"form-group\">\n        <label>Caption (HTML allowed)</label>\n        <textarea class=\"form-control image-caption\" rows=\"2\"></textarea>\n      </div>\n    </div>\n  `;\n  \n  container.insertAdjacentHTML('beforeend', html);\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "event-listener",
                        "state-modifying",
                        "error-handling"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "admin/pages/manage_groups.php",
                            "line": 342,
                            "context": "<button type=\"button\" class=\"btn btn-sm btn-primary mb-3\" onclick=\"addImage('<?= htmlspecialchars($desc['group_name']) ?>')\" <?= $desc_file_write_error ? 'disabled data-bs-toggle=\"modal\" data-bs-target=\"#permissionModal\"' : '' ?>>+ Add Image</button>"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_groups.php"
                    ]
                },
                {
                    "name": "removeImage",
                    "line": 42,
                    "comment": "",
                    "code": "{\n  const container = document.getElementById('images-container-' + groupName);\n  const items = container.querySelectorAll('.image-item');\n  if (items.length > 1) {\n    items[index].remove();\n  } else {\n    alert('At least one image entry must remain (it can be empty).');\n  }\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "event-listener",
                        "state-modifying"
                    ],
                    "usageCount": 2,
                    "usages": [
                        {
                            "file": "js/modules/manage-groups.js",
                            "line": 28,
                            "context": "<button type=\"button\" class=\"btn btn-sm btn-danger remove-btn\" onclick=\"removeImage('${groupName}', ${newIndex})\" style=\"float: right;\" ${isDescFileWriteError ? 'disabled data-bs-toggle=\"modal\" data-bs-target=\"#permissionModal\"' : ''}>Remove</button>"
                        },
                        {
                            "file": "admin/pages/manage_groups.php",
                            "line": 330,
                            "context": "<button type=\"button\" class=\"btn btn-sm btn-danger remove-btn\" onclick=\"removeImage('<?= htmlspecialchars($desc['group_name']) ?>', <?= $idx ?>)\" style=\"float: right;\" <?= $desc_file_write_error ? 'disabled data-bs-toggle=\"modal\" data-bs-target=\"#permissionModal\"' : '' ?>>Remove</button>"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_groups.php"
                    ]
                },
                {
                    "name": "addParagraph",
                    "line": 52,
                    "comment": "",
                    "code": "{\n  const container = document.getElementById('paragraphs-container-' + groupName);\n  const newIndex = container.children.length;\n  \n  const html = `\n    <div class=\"paragraph-item\" data-index=\"${newIndex}\" style=\"border: 1px solid #dee2e6; padding: 15px; margin-bottom: 10px; border-radius: 5px; background: #f8f9fa;\">\n      <button type=\"button\" class=\"btn btn-sm btn-danger remove-btn\" onclick=\"removeParagraph('${groupName}', ${newIndex})\" style=\"float: right;\" ${isDescFileWriteError ? 'disabled data-bs-toggle=\"modal\" data-bs-target=\"#permissionModal\"' : ''}>Remove</button>\n      <div class=\"form-group\">\n        <label>Text (HTML allowed)</label>\n        <textarea class=\"form-control para-text\" rows=\"4\"></textarea>\n      </div>\n      <div class=\"form-row\">\n        <div class=\"form-group col-md-6\">\n          <label>CSS Style</label>\n          <input type=\"text\" class=\"form-control para-style\" value=\"\" placeholder=\"e.g., color: red;\">\n        </div>\n        <div class=\"form-group col-md-6\">\n          <label>CSS Class</label>\n          <input type=\"text\" class=\"form-control para-class\" value=\"\" placeholder=\"e.g., lead\">\n        </div>\n      </div>\n    </div>\n  `;\n  \n  container.insertAdjacentHTML('beforeend', html);\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "event-listener",
                        "state-modifying",
                        "error-handling"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "admin/pages/manage_groups.php",
                            "line": 366,
                            "context": "<button type=\"button\" class=\"btn btn-sm btn-primary mb-3\" onclick=\"addParagraph('<?= htmlspecialchars($desc['group_name']) ?>')\" <?= $desc_file_write_error ? 'disabled data-bs-toggle=\"modal\" data-bs-target=\"#permissionModal\"' : '' ?>>+ Add Paragraph</button>"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_groups.php"
                    ]
                },
                {
                    "name": "removeParagraph",
                    "line": 79,
                    "comment": "",
                    "code": "{\n  const container = document.getElementById('paragraphs-container-' + groupName);\n  const items = container.querySelectorAll('.paragraph-item');\n  if (items.length > 1) {\n    items[index].remove();\n  } else {\n    alert('At least one paragraph entry must remain (it can be empty).');\n  }\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "event-listener",
                        "state-modifying"
                    ],
                    "usageCount": 2,
                    "usages": [
                        {
                            "file": "js/modules/manage-groups.js",
                            "line": 59,
                            "context": "<button type=\"button\" class=\"btn btn-sm btn-danger remove-btn\" onclick=\"removeParagraph('${groupName}', ${newIndex})\" style=\"float: right;\" ${isDescFileWriteError ? 'disabled data-bs-toggle=\"modal\" data-bs-target=\"#permissionModal\"' : ''}>Remove</button>"
                        },
                        {
                            "file": "admin/pages/manage_groups.php",
                            "line": 348,
                            "context": "<button type=\"button\" class=\"btn btn-sm btn-danger remove-btn\" onclick=\"removeParagraph('<?= htmlspecialchars($desc['group_name']) ?>', <?= $idx ?>)\" style=\"float: right;\" <?= $desc_file_write_error ? 'disabled data-bs-toggle=\"modal\" data-bs-target=\"#permissionModal\"' : '' ?>>Remove</button>"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_groups.php"
                    ]
                },
                {
                    "name": "getColorForTag",
                    "line": 104,
                    "comment": "",
                    "code": "{\n    // If we've already assigned a color to this tag, use it\n    if (tagColorMap[tag]) {\n      return tagColorMap[tag];\n    }\n    \n    // Assign the next available color\n    tagColorMap[tag] = colors[nextColorIndex % colors.length];\n    nextColorIndex++;\n    \n    return tagColorMap[tag];\n  }",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [],
                    "usageCount": 11,
                    "usages": [
                        {
                            "file": "js/modules/manage-groups.js",
                            "line": 119,
                            "context": "getColorForTag(tag);"
                        },
                        {
                            "file": "js/modules/manage-groups.js",
                            "line": 125,
                            "context": "chip.style.background = getColorForTag(tag);"
                        },
                        {
                            "file": "js/modules/manage-groups.js",
                            "line": 126,
                            "context": "chip.style.borderColor = getColorForTag(tag);"
                        },
                        {
                            "file": "js/modules/manage-groups.js",
                            "line": 132,
                            "context": "chip.style.background = getColorForTag(groupName);"
                        },
                        {
                            "file": "js/modules/manage-groups.js",
                            "line": 133,
                            "context": "chip.style.borderColor = getColorForTag(groupName);"
                        },
                        {
                            "file": "js/modules/manage-groups.js",
                            "line": 181,
                            "context": "chip.style.background = getColorForTag(tag);"
                        },
                        {
                            "file": "js/modules/manage-groups.js",
                            "line": 182,
                            "context": "chip.style.borderColor = getColorForTag(tag);"
                        },
                        {
                            "file": "js/modules/manage-groups.js",
                            "line": 371,
                            "context": "chip.style.background = getColorForTag(selectedTags[index]);"
                        },
                        {
                            "file": "js/modules/manage-groups.js",
                            "line": 372,
                            "context": "chip.style.borderColor = getColorForTag(selectedTags[index]);"
                        },
                        {
                            "file": "js/modules/manage-groups.js",
                            "line": 409,
                            "context": "chip.style.background = getColorForTag(tag);"
                        },
                        {
                            "file": "js/modules/manage-groups.js",
                            "line": 410,
                            "context": "chip.style.borderColor = getColorForTag(tag);"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_groups.php"
                    ]
                },
                {
                    "name": "renderTags",
                    "line": 175,
                    "comment": "",
                    "code": "{\n      // Render selected tags\n      selectedDisplay.innerHTML = '<small class=\"text-muted\">Selected tags:</small><br>';\n      selectedTags.forEach(tag => {\n        const chip = document.createElement('span');\n        chip.className = 'tag-chip selected';\n        chip.style.background = getColorForTag(tag);\n        chip.style.borderColor = getColorForTag(tag);\n        chip.innerHTML = `${tag} <span class=\"remove\">\u00d7</span>`;\n        chip.onclick = function() {\n          selectedTags = selectedTags.filter(t => t !== tag);\n          renderTags();\n        };\n        selectedDisplay.appendChild(chip);\n      });\n      \n      // Render available tags\n      availableSection.innerHTML = '<small class=\"text-muted\">Available tags (click to add):</small><br>';\n      existingGroups.forEach(tag => {\n        if (!selectedTags.includes(tag)) {\n          const chip = document.createElement('span');\n          chip.className = 'tag-chip available';\n          chip.textContent = tag;\n          chip.onclick = function() {\n            selectedTags.push(tag);\n            renderTags();\n          };\n          availableSection.appendChild(chip);\n        }\n      });\n    }",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "getColorForTag",
                        "renderTags"
                    ],
                    "category": "ui-dom",
                    "tags": [
                        "dom-manipulation",
                        "event-listener",
                        "state-modifying",
                        "loops"
                    ],
                    "usageCount": 8,
                    "usages": [
                        {
                            "file": "js/modules/manage-groups.js",
                            "line": 186,
                            "context": "renderTags();"
                        },
                        {
                            "file": "js/modules/manage-groups.js",
                            "line": 200,
                            "context": "renderTags();"
                        },
                        {
                            "file": "js/modules/manage-groups.js",
                            "line": 219,
                            "context": "renderTags();"
                        },
                        {
                            "file": "js/modules/manage-groups.js",
                            "line": 235,
                            "context": "renderTags();"
                        },
                        {
                            "file": "js/modules/manage-groups.js",
                            "line": 414,
                            "context": "renderTags();"
                        },
                        {
                            "file": "js/modules/manage-groups.js",
                            "line": 428,
                            "context": "renderTags();"
                        },
                        {
                            "file": "js/modules/manage-groups.js",
                            "line": 447,
                            "context": "renderTags();"
                        },
                        {
                            "file": "js/modules/manage-groups.js",
                            "line": 463,
                            "context": "renderTags();"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_groups.php"
                    ]
                },
                {
                    "name": "renderTags",
                    "line": 403,
                    "comment": "",
                    "code": "{\n      // Render selected tags\n      selectedDisplay.innerHTML = '<small class=\"text-muted\">Selected tags:</small><br>';\n      selectedTags.forEach(tag => {\n        const chip = document.createElement('span');\n        chip.className = 'tag-chip selected';\n        chip.style.background = getColorForTag(tag);\n        chip.style.borderColor = getColorForTag(tag);\n        chip.innerHTML = `${tag} <span class=\"remove\">\u00d7</span>`;\n        chip.onclick = function() {\n          selectedTags = selectedTags.filter(t => t !== tag);\n          renderTags();\n        };\n        selectedDisplay.appendChild(chip);\n      });\n      \n      // Render available tags\n      availableSection.innerHTML = '<small class=\"text-muted\">Available tags (click to add):</small><br>';\n      existingGroups.forEach(tag => {\n        if (!selectedTags.includes(tag)) {\n          const chip = document.createElement('span');\n          chip.className = 'tag-chip available';\n          chip.textContent = tag;\n          chip.onclick = function() {\n            selectedTags.push(tag);\n            renderTags();\n          };\n          availableSection.appendChild(chip);\n        }\n      });\n    }",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "getColorForTag",
                        "renderTags"
                    ],
                    "category": "ui-dom",
                    "tags": [
                        "dom-manipulation",
                        "event-listener",
                        "state-modifying",
                        "loops"
                    ],
                    "usageCount": 8,
                    "usages": [
                        {
                            "file": "js/modules/manage-groups.js",
                            "line": 186,
                            "context": "renderTags();"
                        },
                        {
                            "file": "js/modules/manage-groups.js",
                            "line": 200,
                            "context": "renderTags();"
                        },
                        {
                            "file": "js/modules/manage-groups.js",
                            "line": 219,
                            "context": "renderTags();"
                        },
                        {
                            "file": "js/modules/manage-groups.js",
                            "line": 235,
                            "context": "renderTags();"
                        },
                        {
                            "file": "js/modules/manage-groups.js",
                            "line": 414,
                            "context": "renderTags();"
                        },
                        {
                            "file": "js/modules/manage-groups.js",
                            "line": 428,
                            "context": "renderTags();"
                        },
                        {
                            "file": "js/modules/manage-groups.js",
                            "line": 447,
                            "context": "renderTags();"
                        },
                        {
                            "file": "js/modules/manage-groups.js",
                            "line": 463,
                            "context": "renderTags();"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_groups.php"
                    ]
                }
            ]
        },
        {
            "name": "js/modules/manage-registry.js",
            "count": 1,
            "functions": [
                {
                    "name": "updateRegistry",
                    "line": 9,
                    "comment": "/**\n * Update registry (PHP or JS)\n */",
                    "code": "{\n    const typeLabel = type === 'php' ? 'PHP' : 'JavaScript';\n    const btn = event.target.closest('button');\n    const originalText = btn.textContent;\n    const resultDiv = document.getElementById(type + 'Result');\n    \n    btn.disabled = true;\n    btn.innerHTML = '<i class=\"fa fa-spinner fa-spin\"></i> Updating...';\n    resultDiv.classList.add('d-none');\n    \n    const data = new FormData();\n    data.append('action', 'update_registry');\n    data.append('type', type);\n    \n    fetch(window.location.pathname, {\n      method: 'POST',\n      body: data\n    })\n    .then(response => response.json())\n    .then(json => {\n      if (json.success) {\n        // Show success message\n        resultDiv.innerHTML = '<div class=\"alert alert-success\">' +\n          '<i class=\"fa fa-check-circle\"></i> ' + typeLabel + ' registry updated successfully!' +\n          '</div>';\n        resultDiv.classList.remove('d-none');\n        \n        btn.innerHTML = '<i class=\"fa fa-check\"></i> Updated!';\n        \n        // Update the last updated timestamp\n        const now = new Date();\n        const timestamp = now.getFullYear() + '-' + \n          String(now.getMonth() + 1).padStart(2, '0') + '-' + \n          String(now.getDate()).padStart(2, '0') + ' ' +\n          String(now.getHours()).padStart(2, '0') + ':' +\n          String(now.getMinutes()).padStart(2, '0') + ':' +\n          String(now.getSeconds()).padStart(2, '0');\n        \n        const timestampEl = document.querySelector('#' + type + 'Result').previousElementSibling;\n        if (timestampEl && timestampEl.textContent.includes('Last updated')) {\n          timestampEl.innerHTML = '<i class=\"fa fa-clock-o\"></i> Last updated: <strong>' + timestamp + '</strong>';\n        }\n        \n        setTimeout(() => {\n          btn.disabled = false;\n          btn.textContent = originalText;\n        }, 2000);\n      } else {\n        resultDiv.innerHTML = '<div class=\"alert alert-danger\">' +\n          '<i class=\"fa fa-exclamation-triangle\"></i> Error: '",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "asynchronous",
                        "ajax",
                        "event-listener",
                        "state-modifying",
                        "error-handling",
                        "validation"
                    ],
                    "usageCount": 0,
                    "usages": [],
                    "phpFilesCount": 2,
                    "phpFiles": [
                        "admin/manage_js_registry.php",
                        "admin/manage_registry.php"
                    ]
                }
            ]
        },
        {
            "name": "js/modules/manage-site-config.js",
            "count": 2,
            "functions": [
                {
                    "name": "isHexColor",
                    "line": 147,
                    "comment": "",
                    "code": "{\n            return str.startsWith('#') && /^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(str);\n        }",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "js/modules/manage-site-config.js",
                            "line": 158,
                            "context": "if (isHexColor(colorValue)) {"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_site_config.php"
                    ]
                },
                {
                    "name": "updateBadgeColor",
                    "line": 152,
                    "comment": "",
                    "code": "{\n            const seqType = input.getAttribute('data-seq-type');\n            const badgeElement = document.getElementById('badge_' + seqType);\n            if (badgeElement && input.value.trim()) {\n                const colorValue = input.value.trim();\n                \n                if (isHexColor(colorValue)) {\n                    // Hex color - use inline style\n                    badgeElement.style.backgroundColor = colorValue;\n                    badgeElement.style.color = 'white';\n                    // Remove Bootstrap bg-* classes but keep other classes\n                    badgeElement.className = badgeElement.className.replace(/bg-\\S+/g, '').trim();\n                } else {\n                    // Assume it's a Bootstrap class\n                    badgeElement.style.backgroundColor = '';\n                    badgeElement.style.color = '';\n                    // Remove all bg-* classes\n                    badgeElement.className = badgeElement.className.replace(/bg-\\S+/g, '').trim();\n                    // Add the Bootstrap class\n                    badgeElement.className += ' ' + colorValue;\n                }\n            }\n        }",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "state-modifying"
                    ],
                    "usageCount": 3,
                    "usages": [
                        {
                            "file": "js/modules/manage-site-config.js",
                            "line": 178,
                            "context": "updateBadgeColor(input);"
                        },
                        {
                            "file": "js/modules/manage-site-config.js",
                            "line": 182,
                            "context": "updateBadgeColor(this);"
                        },
                        {
                            "file": "js/modules/manage-site-config.js",
                            "line": 185,
                            "context": "updateBadgeColor(this);"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_site_config.php"
                    ]
                }
            ]
        },
        {
            "name": "js/modules/manage-taxonomy-tree.js",
            "count": 2,
            "functions": [
                {
                    "name": "renderTreeNode",
                    "line": 31,
                    "comment": "/**\n     * Render tree node hierarchy\n     */\n   ",
                    "code": "{\n        const indent = level * 20;\n        const isLeaf = !!node.organism;\n        const icon = isLeaf ? '\ud83e\uddec' : (level === 0 ? '\ud83c\udf33' : '\u251c');\n        \n        let html = `<div style=\"margin-left: ${indent}px; padding: 4px 0;\">`;\n        html += `<span style=\"font-weight: ${isLeaf ? 'normal' : 'bold'}; font-style: ${isLeaf ? 'italic' : 'normal'}\">`;\n        html += `${icon} ${node.name}`;\n        if (node.common_name) {\n            html += ` <span class=\"text-muted small\">(${node.common_name})</span>`;\n        }\n        html += `</span></div>`;\n        \n        if (node.children) {\n            node.children.forEach(child => {\n                html += renderTreeNode(child, level + 1);\n            });\n        }\n        \n        return html;\n    }",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "renderTreeNode"
                    ],
                    "category": "ui-dom",
                    "tags": [
                        "state-modifying",
                        "loops"
                    ],
                    "usageCount": 2,
                    "usages": [
                        {
                            "file": "js/modules/manage-taxonomy-tree.js",
                            "line": 46,
                            "context": "html += renderTreeNode(child, level + 1);"
                        },
                        {
                            "file": "js/modules/manage-taxonomy-tree.js",
                            "line": 59,
                            "context": "previewElement.innerHTML = renderTreeNode(treeData.tree);"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_taxonomy_tree.php"
                    ]
                },
                {
                    "name": "renderTreePreview",
                    "line": 56,
                    "comment": "/**\n     * Render the tree preview\n     */\n   ",
                    "code": "{\n        const previewElement = document.getElementById('tree-preview');\n        if (previewElement && treeData.tree) {\n            previewElement.innerHTML = renderTreeNode(treeData.tree);\n        }\n    }",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "renderTreeNode"
                    ],
                    "category": "ui-dom",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "state-modifying"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "js/modules/manage-taxonomy-tree.js",
                            "line": 24,
                            "context": "renderTreePreview(currentTree);"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_taxonomy_tree.php"
                    ]
                }
            ]
        },
        {
            "name": "js/modules/manage-users.js",
            "count": 6,
            "functions": [
                {
                    "name": "resetForm",
                    "line": 17,
                    "comment": "",
                    "code": "{\n  document.getElementById('userForm').reset();\n  document.getElementById('username').readOnly = false;\n  document.getElementById('is_create').value = '1';\n  document.getElementById('original_username').value = '';\n  document.getElementById('form-title').textContent = 'Create New User';\n  document.getElementById('submit-text').textContent = 'Create User';\n  document.getElementById('password_label').innerHTML = 'Password <span class=\"text-danger\">*</span>';\n  document.getElementById('password_help').style.display = 'none';\n  document.getElementById('stale-alert').style.display = 'none';\n  document.getElementById('stale-items').innerHTML = '';\n  isEditMode = false;\n  selectedAccess = {};\n  // Don't call renderAssemblySelector here - it will be called after DOM is ready\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "event-listener",
                        "state-modifying"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "admin/pages/manage_users.php",
                            "line": 152,
                            "context": "<button type=\"button\" class=\"btn btn-secondary\" id=\"cancel-btn\" onclick=\"resetForm()\">"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_users.php"
                    ]
                },
                {
                    "name": "renderAssemblySelector",
                    "line": 33,
                    "comment": "",
                    "code": "{\n  const container = document.getElementById('access-container');\n  \n  if (!container) {\n    return;\n  }\n  \n  container.innerHTML = '';\n  \n  Object.keys(allOrganisms).sort().forEach(organism => {\n    const orgDiv = document.createElement('div');\n    orgDiv.className = 'organism-group';\n    \n    // Header\n    const header = document.createElement('div');\n    header.className = 'organism-toggle';\n    \n    const chevron = document.createElement('i');\n    chevron.className = 'fa fa-chevron-right';\n    chevron.style.marginRight = '6px';\n    \n    header.appendChild(chevron);\n    header.appendChild(document.createTextNode(organism));\n    \n    // Assembly container (hidden by default)\n    const assemblyContainer = document.createElement('div');\n    assemblyContainer.style.display = 'none';\n    \n    // Add assemblies\n    allOrganisms[organism].forEach(assembly => {\n      const chip = document.createElement('span');\n      chip.className = 'tag-chip-selector';\n      chip.setAttribute('data-organism', organism);\n      chip.setAttribute('data-assembly', assembly);\n      chip.style.fontSize = '11px';\n      chip.style.padding = '3px 8px';\n      chip.style.margin = '2px';\n      chip.textContent = assembly;\n      \n      // Check if selected\n      if (selectedAccess[organism] && selectedAccess[organism].includes(assembly)) {\n        console.log('Marking as selected:', organism, assembly);\n        chip.classList.add('selected');\n        chip.style.opacity = '1';\n      } else {\n        chip.style.opacity = '0.5';\n      }\n      \n      // Color\n      chip.style.background = getColorForOrganism(organism);\n      chip.style.borderColor = getColorForOrganism(organism);\n      chip.style.color = 'white';\n      chip.style.border = '2px solid ' + getColorForOrganism(organism);\n      \n      chip.addEventListener('click', function() {\n        this.classList.toggle('selected');\n        if (this.classList.contains('selected')) {\n          this.style.opacity = '1';\n          if (!selectedAccess[orga",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "ui-dom",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "event-listener",
                        "state-modifying",
                        "loops",
                        "validation"
                    ],
                    "usageCount": 4,
                    "usages": [
                        {
                            "file": "js/modules/manage-users.js",
                            "line": 176,
                            "context": "renderAssemblySelector();"
                        },
                        {
                            "file": "js/modules/manage-users.js",
                            "line": 242,
                            "context": "renderAssemblySelector();"
                        },
                        {
                            "file": "js/modules/manage-users.js",
                            "line": 283,
                            "context": "renderAssemblySelector();"
                        },
                        {
                            "file": "js/modules/manage-users.js",
                            "line": 345,
                            "context": "renderAssemblySelector();"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_users.php"
                    ]
                },
                {
                    "name": "updateHiddenInputs",
                    "line": 126,
                    "comment": "",
                    "code": "{\n  const hiddenContainer = document.getElementById('selected-assemblies-hidden');\n  const previewContainer = document.getElementById('selected-preview');\n  \n  hiddenContainer.innerHTML = '';\n  previewContainer.innerHTML = '';\n  \n  let totalCount = 0;\n  \n  Object.keys(selectedAccess).sort().forEach(organism => {\n    selectedAccess[organism].forEach(assembly => {\n      totalCount++;\n      \n      // Add hidden input\n      const input = document.createElement('input');\n      input.type = 'hidden';\n      input.name = `access[${organism}][]`;\n      input.value = assembly;\n      hiddenContainer.appendChild(input);\n      \n      // Add preview badge\n      const badge = document.createElement('span');\n      badge.className = 'tag-chip';\n      badge.style.background = getColorForOrganism(organism);\n      badge.style.borderColor = getColorForOrganism(organism);\n      badge.style.color = 'white';\n      badge.style.marginRight = '5px';\n      badge.style.marginBottom = '5px';\n      badge.style.display = 'inline-block';\n      badge.textContent = `${organism}: ${assembly}`;\n      \n      // Add remove button to badge\n      const removeBtn = document.createElement('i');\n      removeBtn.className = 'fa fa-times';\n      removeBtn.style.cursor = 'pointer';\n      removeBtn.style.marginLeft = '8px';\n      removeBtn.style.fontWeight = 'bold';\n      removeBtn.style.opacity = '0.8';\n      removeBtn.addEventListener('click', function(e) {\n        e.stopPropagation();\n        // Remove from selectedAccess\n        if (selectedAccess[organism]) {\n          selectedAccess[organism] = selectedAccess[organism].filter(a => a !== assembly);\n          if (selectedAccess[organism].length === 0) {\n            delete selectedAccess[organism];\n          }\n        }\n        // Re-render both preview and selector\n        updateHiddenInputs();\n        renderAssemblySelector();\n      });\n      \n      badge.appendChild(removeBtn);\n      previewContainer.appendChild(badge);\n    });\n  });\n  \n  if (totalCount ===",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "updateHiddenInputs",
                        "renderAssemblySelector"
                    ],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "event-listener",
                        "state-modifying",
                        "loops"
                    ],
                    "usageCount": 5,
                    "usages": [
                        {
                            "file": "js/modules/manage-users.js",
                            "line": 107,
                            "context": "updateHiddenInputs();"
                        },
                        {
                            "file": "js/modules/manage-users.js",
                            "line": 175,
                            "context": "updateHiddenInputs();"
                        },
                        {
                            "file": "js/modules/manage-users.js",
                            "line": 243,
                            "context": "updateHiddenInputs();"
                        },
                        {
                            "file": "js/modules/manage-users.js",
                            "line": 282,
                            "context": "updateHiddenInputs();"
                        },
                        {
                            "file": "js/modules/manage-users.js",
                            "line": 315,
                            "context": "updateHiddenInputs();"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_users.php"
                    ]
                },
                {
                    "name": "populateForm",
                    "line": 188,
                    "comment": "",
                    "code": "{\n  console.log('populateForm called for:', username);\n  console.log('allUsers:', allUsers);\n  console.log('userData:', allUsers[username]);\n  \n  const userData = allUsers[username];\n  if (!userData) {\n    console.error('User not found:', username);\n    return;\n  }\n  \n  // Fill basic fields\n  document.getElementById('username').value = username;\n  document.getElementById('username').readOnly = true;\n  document.getElementById('email').value = userData.email || '';\n  document.getElementById('first_name').value = userData.first_name || '';\n  document.getElementById('last_name').value = userData.last_name || '';\n  document.getElementById('account_host').value = userData.account_host || '';\n  document.getElementById('password').value = '';\n  \n  // Update labels\n  document.getElementById('form-title').textContent = `Edit User: ${username}`;\n  document.getElementById('submit-text').textContent = 'Update User';\n  document.getElementById('password_label').innerHTML = 'New Password (leave blank to keep current)';\n  document.getElementById('password_help').style.display = 'block';\n  \n  // Admin status\n  const isAdmin = userData.role === 'admin';\n  document.getElementById('isAdmin').checked = isAdmin;\n  \n  // Update form mode\n  document.getElementById('is_create').value = '0';\n  document.getElementById('original_username').value = username;\n  \n  isEditMode = true;\n  \n  // Build selected assemblies from user data\n  selectedAccess = {};\n  console.log('userData.access:', userData.access);\n  if (userData.access && typeof userData.access === 'object') {\n    console.log('Building selectedAccess from user data');\n    Object.keys(userData.access).forEach(organism => {\n      console.log('Processing organism:', organism, 'assemblies:', userData.access[organism]);\n      if (Array.isArray(userData.access[organism])) {\n        selectedAccess[organism] = [...userData.access[organism]];\n      }\n    });\n  }\n  \n  console.log('selectedAccess:', selectedAccess);\n  \n  // Re-render to show selectio",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "event-listener",
                        "state-modifying",
                        "loops",
                        "error-handling",
                        "validation"
                    ],
                    "usageCount": 2,
                    "usages": [
                        {
                            "file": "js/modules/manage-users.js",
                            "line": 285,
                            "context": "populateForm(username);"
                        },
                        {
                            "file": "js/modules/manage-users.js",
                            "line": 365,
                            "context": "populateForm(username);"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_users.php"
                    ]
                },
                {
                    "name": "toggleAccessSection",
                    "line": 301,
                    "comment": "",
                    "code": "{\n  const isAdmin = document.getElementById('isAdmin').checked;\n  const accessSection = document.getElementById('access-section');\n  const previewSection = document.getElementById('preview-section');\n  const requiredBadge = document.getElementById('required-badge');\n  \n  if (isAdmin) {\n    accessSection.style.opacity = '0.5';\n    accessSection.style.pointerEvents = 'none';\n    previewSection.style.opacity = '0.5';\n    previewSection.style.pointerEvents = 'none';\n    requiredBadge.style.display = 'none';\n    selectedAccess = {}; // Clear selections for admin\n    updateHiddenInputs();\n  } else {\n    accessSection.style.opacity = '1';\n    accessSection.style.pointerEvents = 'auto';\n    previewSection.style.opacity = '1';\n    previewSection.style.pointerEvents = 'auto';\n    requiredBadge.style.display = 'inline';\n  }\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "updateHiddenInputs"
                    ],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "state-modifying",
                        "validation"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "js/modules/manage-users.js",
                            "line": 296,
                            "context": "toggleAccessSection();"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_users.php"
                    ]
                },
                {
                    "name": "validateForm",
                    "line": 324,
                    "comment": "",
                    "code": "{\n  const isAdmin = document.getElementById('isAdmin').checked;\n  const hasAssemblies = Object.keys(selectedAccess).some(org => \n    selectedAccess[org] && selectedAccess[org].length > 0\n  );\n  \n  if (!isAdmin && !hasAssemblies) {\n    alert('Please select at least one assembly (or check Admin for full access)');\n    return false;\n  }\n  \n  return true;\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "state-modifying",
                        "validation"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "js/modules/manage-users.js",
                            "line": 438,
                            "context": "if (!validateForm()) {"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_users.php"
                    ]
                }
            ]
        },
        {
            "name": "js/modules/organism-management.js",
            "count": 13,
            "functions": [
                {
                    "name": "escapeHtml",
                    "line": 9,
                    "comment": "/**\n * Escape HTML special characters (local copy - also in utilities.js, permission-manager.js, sequence-retrieval.js)\n * TODO: Refactor to load utilities.js as shared module instead of duplicating\n */",
                    "code": "{\n    const map = {\n        '&': '&amp;',\n        '<': '&lt;',\n        '>': '&gt;',\n        '\"': '&quot;',\n        \"'\": '&#039;'\n    };\n    return String(text).replace(/[&<>\"']/g, m => map[m]);\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "state-modifying"
                    ],
                    "usageCount": 13,
                    "usages": [
                        {
                            "file": "js/permission-manager.js",
                            "line": 52,
                            "context": "'<i class=\"fa fa-check-circle\"></i> ' + escapeHtml(json.message) + ' ' +"
                        },
                        {
                            "file": "js/permission-manager.js",
                            "line": 61,
                            "context": "'<i class=\"fa fa-times-circle\"></i> <strong>Failed:</strong> ' + escapeHtml(json.message) + '</div>';"
                        },
                        {
                            "file": "js/permission-manager.js",
                            "line": 69,
                            "context": "'<i class=\"fa fa-exclamation-triangle\"></i> <strong>Error:</strong> ' + escapeHtml(error.message) + '</div>';"
                        },
                        {
                            "file": "js/sequence-retrieval.js",
                            "line": 174,
                            "context": "<span style=\"background: ${bgColor}; padding: 2px 6px; border-radius: 3px; font-weight: bold;\">${escapeHtml(id)}</span>`;"
                        },
                        {
                            "file": "js/sequence-retrieval.js",
                            "line": 187,
                            "context": "<span style=\"background: ${childBgColor}; padding: 2px 6px; border-radius: 3px;\">${escapeHtml(childId)}</span>"
                        },
                        {
                            "file": "js/sequence-retrieval.js",
                            "line": 205,
                            "context": "<span style=\"background: ${bgColor}; padding: 2px 6px; border-radius: 3px;\">${escapeHtml(id)}</span>"
                        },
                        {
                            "file": "js/modules/organism-management.js",
                            "line": 50,
                            "context": "html += '<code class=\"text-break\">' + escapeHtml(data.command) + '</code><br>';"
                        },
                        {
                            "file": "js/modules/organism-management.js",
                            "line": 165,
                            "context": "html += '<li>File owner: <code>' + escapeHtml(response.error.owner) + '</code></li>';"
                        },
                        {
                            "file": "js/modules/organism-management.js",
                            "line": 167,
                            "context": "html += '<li>Web server user: <code>' + escapeHtml(response.error.web_user) + '</code></li>';"
                        },
                        {
                            "file": "js/modules/organism-management.js",
                            "line": 169,
                            "context": "html += '<li>Web server group: <code>' + escapeHtml(response.error.web_group) + '</code></li>';"
                        },
                        {
                            "file": "js/modules/organism-management.js",
                            "line": 175,
                            "context": "html += '<code class=\"text-break\">' + escapeHtml(response.error.command) + '</code>';"
                        },
                        {
                            "file": "js/modules/organism-management.js",
                            "line": 324,
                            "context": "html += '<code class=\"text-break\">' + escapeHtml(data.command) + '</code><br>';"
                        },
                        {
                            "file": "js/modules/organism-management.js",
                            "line": 393,
                            "context": "html += '<code class=\"text-break\">' + escapeHtml(data.command) + '</code><br>';"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_organisms.php"
                    ]
                },
                {
                    "name": "fixDatabasePermissions",
                    "line": 20,
                    "comment": "",
                    "code": "{\n    event.preventDefault();\n    \n    const resultDiv = document.getElementById('fixResult' + organism);\n    const button = event.target.closest('button');\n    \n    button.disabled = true;\n    button.innerHTML = '<i class=\"fa fa-spinner fa-spin\"></i> Fixing...';\n    resultDiv.classList.add('d-none');\n    \n    fetch('manage_organisms.php', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/x-www-form-urlencoded'\n        },\n        body: 'action=fix_permissions&organism=' + encodeURIComponent(organism)\n    })\n    .then(response => response.json())\n    .then(data => {\n        button.disabled = false;\n        \n        let alertClass = data.success ? 'alert-success' : 'alert-danger';\n        let html = '<div class=\"alert ' + alertClass + '\">';\n        html += '<strong>' + (data.success ? '\u2713 Success!' : '\u2717 Failed!') + '</strong><br>';\n        html += '<p>' + data.message + '</p>';\n        \n        if (data.command) {\n            html += '<div class=\"alert alert-info mt-2 small\">';\n            html += '<strong>Run this command on the server:</strong><br>';\n            html += '<code class=\"text-break\">' + escapeHtml(data.command) + '</code><br>';\n            html += '<small class=\"mt-2 d-block text-muted\">After running the command, refresh this page to verify the fix.</small>';\n            html += '</div>';\n        }\n        \n        html += '</div>';\n        \n        if (data.success) {\n            button.innerHTML = '<i class=\"fa fa-check\"></i> Fixed!';\n            button.classList.remove('btn-warning');\n            button.classList.add('btn-success');\n        } else {\n            button.innerHTML = '<i class=\"fa fa-wrench\"></i> Try Again';\n        }\n        \n        resultDiv.innerHTML = html;\n        resultDiv.classList.remove('d-none');\n    })\n    .catch(error => {\n        button.disabled = false;\n        button.innerHTML = '<i class=\"fa fa-wrench\"></i> Fix Permissions';\n        resultDiv.innerHTML = '<div class=\"alert alert-dan",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "escapeHtml"
                    ],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "asynchronous",
                        "ajax",
                        "event-listener",
                        "state-modifying",
                        "error-handling",
                        "validation"
                    ],
                    "usageCount": 2,
                    "usages": [
                        {
                            "file": "admin/manage_organisms.php",
                            "line": 31,
                            "context": "$result = fixDatabasePermissions($db_file);"
                        },
                        {
                            "file": "admin/pages/manage_organisms.php",
                            "line": 618,
                            "context": "<button class=\"btn btn-warning btn-sm\" onclick=\"fixDatabasePermissions(event, '<?= $org_safe ?>')\">"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_organisms.php"
                    ]
                },
                {
                    "name": "saveMetadata",
                    "line": 75,
                    "comment": "",
                    "code": "{\n    event.preventDefault();\n    \n    const form = document.getElementById('metadataForm' + organism);\n    const resultDiv = document.getElementById('saveResult' + organism);\n    const button = event.target;\n    \n    if (!form.checkValidity()) {\n        form.reportValidity();\n        return;\n    }\n    \n    // Collect images data\n    const imagesContainer = document.getElementById('images-container-' + organism);\n    const images = [];\n    imagesContainer.querySelectorAll('.image-item').forEach(item => {\n        const file = item.querySelector('.image-file').value;\n        const caption = item.querySelector('.image-caption').value;\n        if (file || caption) {\n            images.push({\n                file: file,\n                caption: caption\n            });\n        }\n    });\n    \n    // Collect paragraphs data\n    const paragraphsContainer = document.getElementById('paragraphs-container-' + organism);\n    const paragraphs = [];\n    paragraphsContainer.querySelectorAll('.paragraph-item').forEach(item => {\n        const text = item.querySelector('.para-text').value;\n        const style = item.querySelector('.para-style').value;\n        const cssClass = item.querySelector('.para-class').value;\n        if (text || style || cssClass) {\n            paragraphs.push({\n                text: text,\n                style: style,\n                class: cssClass\n            });\n        }\n    });\n    \n    // Collect feature types data\n    const parentFeatures = [];\n    const childFeatures = [];\n    document.querySelectorAll('#parents-' + organism + ' .feature-tag').forEach(tag => {\n        parentFeatures.push(tag.getAttribute('data-feature'));\n    });\n    document.querySelectorAll('#children-' + organism + ' .feature-tag').forEach(tag => {\n        childFeatures.push(tag.getAttribute('data-feature'));\n    });\n    \n    // Prepare form data\n    const formData = new FormData(form);\n    const data = new URLSearchParams();\n    data.append('action', 'save_metadata');\n    data.appen",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "event-listener",
                        "state-modifying",
                        "loops",
                        "validation"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "admin/pages/manage_organisms.php",
                            "line": 891,
                            "context": "<button type=\"button\" class=\"btn btn-success\" onclick=\"saveMetadata(event, '<?= $org_safe ?>')\">"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_organisms.php"
                    ]
                },
                {
                    "name": "addMetadataImage",
                    "line": 203,
                    "comment": "",
                    "code": "{\n    const container = document.getElementById('images-container-' + organism);\n    const newIndex = container.children.length;\n    \n    const html = `\n      <div class=\"image-item\" data-index=\"${newIndex}\" style=\"border: 1px solid #dee2e6; padding: 15px; margin-bottom: 10px; border-radius: 5px; background: #f8f9fa;\">\n        <button type=\"button\" class=\"btn btn-sm btn-danger remove-btn\" onclick=\"removeMetadataImage('${organism}', ${newIndex})\" style=\"float: right;\">Remove</button>\n        <div class=\"form-group mb-3\">\n          <label>Image File</label>\n          <input type=\"text\" class=\"form-control image-file\" value=\"\" placeholder=\"e.g., organism_image.jpg\">\n          <small class=\"text-muted\">Place images in /moop/images/ directory</small>\n        </div>\n        <div class=\"form-group\">\n          <label>Caption (HTML allowed)</label>\n          <textarea class=\"form-control image-caption\" rows=\"2\"></textarea>\n        </div>\n      </div>\n    `;\n    \n    container.insertAdjacentHTML('beforeend', html);\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "event-listener",
                        "state-modifying"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "admin/pages/manage_organisms.php",
                            "line": 851,
                            "context": "<button type=\"button\" class=\"btn btn-sm btn-primary mb-4\" onclick=\"addMetadataImage('<?= $org_safe ?>')\">"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_organisms.php"
                    ]
                },
                {
                    "name": "removeMetadataImage",
                    "line": 225,
                    "comment": "",
                    "code": "{\n    const container = document.getElementById('images-container-' + organism);\n    const items = container.querySelectorAll('.image-item');\n    if (items.length > 1) {\n        items[index].remove();\n    } else {\n        alert('At least one image entry must remain (it can be empty).');\n    }\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "event-listener",
                        "state-modifying"
                    ],
                    "usageCount": 2,
                    "usages": [
                        {
                            "file": "js/modules/organism-management.js",
                            "line": 210,
                            "context": "<button type=\"button\" class=\"btn btn-sm btn-danger remove-btn\" onclick=\"removeMetadataImage('${organism}', ${newIndex})\" style=\"float: right;\">Remove</button>"
                        },
                        {
                            "file": "admin/pages/manage_organisms.php",
                            "line": 838,
                            "context": "<button type=\"button\" class=\"btn btn-sm btn-danger remove-btn\" onclick=\"removeMetadataImage('<?= $org_safe ?>', <?= $idx ?>)\" style=\"float: right;\">Remove</button>"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_organisms.php"
                    ]
                },
                {
                    "name": "addMetadataParagraph",
                    "line": 235,
                    "comment": "",
                    "code": "{\n    const container = document.getElementById('paragraphs-container-' + organism);\n    const newIndex = container.children.length;\n    \n    const html = `\n      <div class=\"paragraph-item\" data-index=\"${newIndex}\" style=\"border: 1px solid #dee2e6; padding: 15px; margin-bottom: 10px; border-radius: 5px; background: #f8f9fa;\">\n        <button type=\"button\" class=\"btn btn-sm btn-danger remove-btn\" onclick=\"removeMetadataParagraph('${organism}', ${newIndex})\" style=\"float: right;\">Remove</button>\n        <div class=\"form-group mb-3\">\n          <label>Text (HTML allowed)</label>\n          <textarea class=\"form-control para-text\" rows=\"4\"></textarea>\n        </div>\n        <div class=\"row\">\n          <div class=\"col-md-6\">\n            <div class=\"form-group\">\n              <label>CSS Style</label>\n              <input type=\"text\" class=\"form-control para-style\" value=\"\" placeholder=\"e.g., color: red;\">\n            </div>\n          </div>\n          <div class=\"col-md-6\">\n            <div class=\"form-group\">\n              <label>CSS Class</label>\n              <input type=\"text\" class=\"form-control para-class\" value=\"\" placeholder=\"e.g., lead\">\n            </div>\n          </div>\n        </div>\n      </div>\n    `;\n    \n    container.insertAdjacentHTML('beforeend', html);\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "event-listener",
                        "state-modifying"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "admin/pages/manage_organisms.php",
                            "line": 885,
                            "context": "<button type=\"button\" class=\"btn btn-sm btn-primary mb-4\" onclick=\"addMetadataParagraph('<?= $org_safe ?>')\">"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_organisms.php"
                    ]
                },
                {
                    "name": "removeMetadataParagraph",
                    "line": 266,
                    "comment": "",
                    "code": "{\n    const container = document.getElementById('paragraphs-container-' + organism);\n    const items = container.querySelectorAll('.paragraph-item');\n    if (items.length > 1) {\n        items[index].remove();\n    } else {\n        alert('At least one paragraph entry must remain (it can be empty).');\n    }\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "event-listener",
                        "state-modifying"
                    ],
                    "usageCount": 2,
                    "usages": [
                        {
                            "file": "js/modules/organism-management.js",
                            "line": 242,
                            "context": "<button type=\"button\" class=\"btn btn-sm btn-danger remove-btn\" onclick=\"removeMetadataParagraph('${organism}', ${newIndex})\" style=\"float: right;\">Remove</button>"
                        },
                        {
                            "file": "admin/pages/manage_organisms.php",
                            "line": 863,
                            "context": "<button type=\"button\" class=\"btn btn-sm btn-danger remove-btn\" onclick=\"removeMetadataParagraph('<?= $org_safe ?>', <?= $idx ?>)\" style=\"float: right;\">Remove</button>"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_organisms.php"
                    ]
                },
                {
                    "name": "renameAssemblyDirectory",
                    "line": 276,
                    "comment": "",
                    "code": "{\n    event.preventDefault();\n    \n    const elementId = safeAsmId || organism;\n    \n    const oldDir = document.getElementById('oldDirName' + elementId).value;\n    const newDir = document.getElementById('newDirName' + elementId).value;\n    const resultDiv = document.getElementById('renameResult' + elementId);\n    const button = event.target;\n    \n    if (!oldDir || !newDir) {\n        resultDiv.innerHTML = '<div class=\"alert alert-warning\">Please select both current and new directory names</div>';\n        resultDiv.classList.remove('d-none');\n        return;\n    }\n    \n    if (oldDir === newDir) {\n        resultDiv.innerHTML = '<div class=\"alert alert-warning\">Current and new names are the same</div>';\n        resultDiv.classList.remove('d-none');\n        return;\n    }\n    \n    button.disabled = true;\n    button.innerHTML = '<i class=\"fa fa-spinner fa-spin\"></i> Renaming...';\n    resultDiv.classList.add('d-none');\n    \n    fetch('manage_organisms.php', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/x-www-form-urlencoded'\n        },\n        body: 'action=rename_assembly&organism=' + encodeURIComponent(organism) + \n              '&old_name=' + encodeURIComponent(oldDir) + \n              '&new_name=' + encodeURIComponent(newDir)\n    })\n    .then(response => response.json())\n    .then(data => {\n        button.disabled = false;\n        \n        let alertClass = data.success ? 'alert-success' : 'alert-danger';\n        let html = '<div class=\"alert ' + alertClass + '\">';\n        html += '<strong>' + (data.success ? '\u2713 Success!' : '\u2717 Failed!') + '</strong><br>';\n        html += '<p>' + data.message + '</p>';\n        \n        if (data.command) {\n            html += '<div class=\"alert alert-info mt-2 small\">';\n            html += '<strong>Run this command on the server:</strong><br>';\n            html += '<code class=\"text-break\">' + escapeHtml(data.command) + '</code><br>';\n            html += '<small class=\"mt-2 d-block text-muted\"",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "escapeHtml"
                    ],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "asynchronous",
                        "ajax",
                        "event-listener",
                        "state-modifying"
                    ],
                    "usageCount": 2,
                    "usages": [
                        {
                            "file": "admin/manage_organisms.php",
                            "line": 51,
                            "context": "$result = renameAssemblyDirectory($organism_dir, $old_name, $new_name);"
                        },
                        {
                            "file": "admin/pages/manage_organisms.php",
                            "line": 1059,
                            "context": "<button class=\"btn btn-info btn-sm w-100\" onclick=\"renameAssemblyDirectory(event, '<?= htmlspecialchars($organism) ?>', '<?= htmlspecialchars($safe_asm_id) ?>')\">"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_organisms.php"
                    ]
                },
                {
                    "name": "deleteAssemblyDirectory",
                    "line": 351,
                    "comment": "",
                    "code": "{\n    event.preventDefault();\n    \n    const dirToDelete = document.getElementById('dirToDelete' + safeAsmId).value;\n    const resultDiv = document.getElementById('deleteResult' + safeAsmId);\n    const button = event.target;\n    \n    if (!dirToDelete) {\n        resultDiv.innerHTML = '<div class=\"alert alert-warning\">Please select a directory to delete</div>';\n        resultDiv.classList.remove('d-none');\n        return;\n    }\n    \n    if (!confirm('\u26a0\ufe0f  CAUTION: You are about to permanently delete the directory \"' + dirToDelete + '\". This action CANNOT be undone!\\n\\nAre you absolutely sure you want to continue?')) {\n        return;\n    }\n    \n    button.disabled = true;\n    button.innerHTML = '<i class=\"fa fa-spinner fa-spin\"></i> Deleting...';\n    resultDiv.classList.add('d-none');\n    \n    fetch('manage_organisms.php', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/x-www-form-urlencoded'\n        },\n        body: 'action=delete_assembly&organism=' + encodeURIComponent(organism) + \n              '&dir_name=' + encodeURIComponent(dirToDelete)\n    })\n    .then(response => response.json())\n    .then(data => {\n        button.disabled = false;\n        \n        let alertClass = data.success ? 'alert-success' : 'alert-danger';\n        let html = '<div class=\"alert ' + alertClass + '\">';\n        html += '<strong>' + (data.success ? '\u2713 Deleted!' : '\u2717 Failed!') + '</strong><br>';\n        html += '<p>' + data.message + '</p>';\n        \n        if (data.command) {\n            html += '<div class=\"alert alert-info mt-2 small\">';\n            html += '<strong>Web server lacks permissions. Run this command on the server:</strong><br>';\n            html += '<code class=\"text-break\">' + escapeHtml(data.command) + '</code><br>';\n            html += '<small class=\"mt-2 d-block text-muted\">After running the command, refresh this page to verify the deletion.</small>';\n            html += '</div>';\n        }\n        \n        html += '</div>';",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "escapeHtml"
                    ],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "asynchronous",
                        "ajax",
                        "event-listener",
                        "state-modifying",
                        "validation"
                    ],
                    "usageCount": 2,
                    "usages": [
                        {
                            "file": "admin/manage_organisms.php",
                            "line": 70,
                            "context": "$result = deleteAssemblyDirectory($organism_dir, $dir_name);"
                        },
                        {
                            "file": "admin/pages/manage_organisms.php",
                            "line": 1092,
                            "context": "<button class=\"btn btn-danger btn-sm w-100\" onclick=\"deleteAssemblyDirectory(event, '<?= htmlspecialchars($organism) ?>', '<?= htmlspecialchars($safe_asm_id) ?>')\">"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_organisms.php"
                    ]
                },
                {
                    "name": "deleteCurrentAssemblyDirectory",
                    "line": 419,
                    "comment": "",
                    "code": "{\n    event.preventDefault();\n    \n    // Get the current assembly name from the modal title or data attribute\n    const modalElement = document.getElementById('asmModal' + safeAsmId);\n    const assemblyName = modalElement ? modalElement.getAttribute('data-assembly-name') : null;\n    \n    if (!assemblyName) {\n        alert('Unable to determine assembly directory name');\n        return;\n    }\n    \n    if (!confirm('\u26a0\ufe0f  CAUTION: You are about to permanently delete the assembly directory \"' + assemblyName + '\" for organism \"' + organism + '\".\\n\\nThis action CANNOT be undone!\\n\\nAre you absolutely sure you want to continue?')) {\n        return;\n    }\n    \n    const button = event.target.closest('button');\n    button.disabled = true;\n    button.innerHTML = '<i class=\"fa fa-spinner fa-spin\"></i> Deleting...';\n    \n    fetch('manage_organisms.php', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/x-www-form-urlencoded'\n        },\n        body: 'action=delete_assembly&organism=' + encodeURIComponent(organism) + \n              '&dir_name=' + encodeURIComponent(assemblyName)\n    })\n    .then(response => response.json())\n    .then(data => {\n        if (data.success) {\n            alert('Assembly directory deleted successfully! The modal will close.');\n            const modal = bootstrap.Modal.getInstance(modalElement);\n            if (modal) {\n                modal.hide();\n            }\n            // Refresh the page after a short delay to show updated list\n            setTimeout(() => location.reload(), 500);\n        } else {\n            button.disabled = false;\n            button.innerHTML = '<i class=\"fa fa-trash-alt\"></i> Delete Assembly Directory';\n            \n            let message = data.message || 'Unknown error';\n            if (data.command) {\n                message += '\\n\\nWeb server lacks permissions. Run this command on the server:\\n' + data.command;\n            }\n            alert('\u274c Deletion failed!\\n\\n' + message);",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "asynchronous",
                        "ajax",
                        "event-listener",
                        "state-modifying",
                        "error-handling"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "admin/pages/manage_organisms.php",
                            "line": 1201,
                            "context": "<button type=\"button\" class=\"btn btn-danger\" onclick=\"deleteCurrentAssemblyDirectory(event, '<?= htmlspecialchars($organism) ?>', '<?= htmlspecialchars($safe_asm_id) ?>')\">"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_organisms.php"
                    ]
                },
                {
                    "name": "addFeatureTag",
                    "line": 475,
                    "comment": "",
                    "code": "{\n    const inputId = type + '-feature-input-' + organism;\n    const containerId = type + '-features-' + organism;\n    const input = document.getElementById(inputId);\n    const container = document.getElementById(containerId);\n    \n    const feature = input.value.trim();\n    if (!feature) {\n        alert('Please enter a feature type');\n        return;\n    }\n    \n    // Check if already exists\n    const existing = Array.from(container.querySelectorAll('.feature-tag')).map(t => t.getAttribute('data-feature'));\n    if (existing.includes(feature)) {\n        alert('This feature type is already added');\n        return;\n    }\n    \n    const badge = document.createElement('span');\n    badge.className = 'badge me-2 mb-2 feature-tag';\n    badge.className += type === 'parent' ? ' bg-primary' : ' bg-info';\n    badge.setAttribute('data-feature', feature);\n    badge.innerHTML = `${feature} <i class=\"fa fa-times\" style=\"cursor: pointer;\" onclick=\"removeFeatureTag(this, '${organism}')\"></i>`;\n    \n    container.appendChild(badge);\n    input.value = '';\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "event-listener",
                        "state-modifying",
                        "validation"
                    ],
                    "usageCount": 2,
                    "usages": [
                        {
                            "file": "admin/pages/manage_organisms.php",
                            "line": 798,
                            "context": "<button type=\"button\" class=\"btn btn-sm btn-outline-primary mt-2\" onclick=\"addFeatureTag('<?= $org_safe ?>', 'parent')\">"
                        },
                        {
                            "file": "admin/pages/manage_organisms.php",
                            "line": 815,
                            "context": "<button type=\"button\" class=\"btn btn-sm btn-outline-info mt-2\" onclick=\"addFeatureTag('<?= $org_safe ?>', 'child')\">"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_organisms.php"
                    ]
                },
                {
                    "name": "removeFeatureTag",
                    "line": 504,
                    "comment": "",
                    "code": "{\n    element.closest('.feature-tag').remove();\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [],
                    "usageCount": 3,
                    "usages": [
                        {
                            "file": "js/modules/organism-management.js",
                            "line": 499,
                            "context": "badge.innerHTML = `${feature} <i class=\"fa fa-times\" style=\"cursor: pointer;\" onclick=\"removeFeatureTag(this, '${organism}')\"></i>`;"
                        },
                        {
                            "file": "admin/pages/manage_organisms.php",
                            "line": 793,
                            "context": "<?= htmlspecialchars($feature) ?> <i class=\"fa fa-times\" style=\"cursor: pointer;\" onclick=\"removeFeatureTag(this, '<?= $org_safe ?>')\"></i>"
                        },
                        {
                            "file": "admin/pages/manage_organisms.php",
                            "line": 810,
                            "context": "<?= htmlspecialchars($feature) ?> <i class=\"fa fa-times\" style=\"cursor: pointer;\" onclick=\"removeFeatureTag(this, '<?= $org_safe ?>')\"></i>"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_organisms.php"
                    ]
                },
                {
                    "name": "togglePath",
                    "line": 577,
                    "comment": "/**\n * Toggle Path Display\n * Shows/hides the organism directory path\n */",
                    "code": "{\n    const pathId = 'path-' + organism.replace(/[^a-zA-Z0-9]/g, '_');\n    let pathDiv = document.getElementById(pathId);\n    \n    if (pathDiv) {\n        // Already exists, toggle visibility\n        if (pathDiv.style.display === 'none') {\n            pathDiv.style.display = 'block';\n            button.innerHTML = '<i class=\"fa fa-folder-open\"></i> Hide Path';\n        } else {\n            pathDiv.style.display = 'none';\n            button.innerHTML = '<i class=\"fa fa-folder\"></i> View Path';\n        }\n    } else {\n        // Create the path display\n        pathDiv = document.createElement('div');\n        pathDiv.id = pathId;\n        pathDiv.className = 'mt-2';\n        pathDiv.innerHTML = '<small class=\"font-monospace text-muted\" style=\"user-select: all; cursor: text;\">' + organism_path + '</small>';\n        button.parentNode.insertBefore(pathDiv, button.nextSibling);\n        button.innerHTML = '<i class=\"fa fa-folder-open\"></i> Hide Path';\n    }\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "state-modifying"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "admin/pages/manage_organisms.php",
                            "line": 226,
                            "context": "<br><button class=\"btn btn-sm btn-outline-secondary\" type=\"button\" onclick=\"togglePath(this, '<?= htmlspecialchars($data['path']) ?>', '<?= htmlspecialchars($organism) ?>')\">"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "admin/manage_organisms.php"
                    ]
                }
            ]
        },
        {
            "name": "js/modules/shared-results-table.js",
            "count": 3,
            "functions": [
                {
                    "name": "createOrganismResultsTable",
                    "line": 18,
                    "comment": "/**\n * Creates an organism results table HTML structure\n * \n * @param {string} organism - The organism identifier\n * @param {Array} results - Array of result objects\n * @param {string} sitePath - The site base path\n * @param {string} linkBasePath - Base path for feature links (e.g., 'tools/parent.php' or 'tools/parent.php')\n * @param {string} imageUrl - Optional URL to organism image thumbnail\n * @returns {string} HTML string for the table\n */",
                    "code": "{\n    const tableId = '#resultsTable_' + organism.replace(/[^a-zA-Z0-9]/g, '_');\n    const selectId = organism.replace(/[^a-zA-Z0-9]/g, '_');\n    const genus = results[0]?.genus || '';\n    const species = results[0]?.species || '';\n    const commonName = results[0]?.common_name || '';\n    \n    const organismDisplay = `<em>${genus} ${species}</em>`;\n    const commonNameDisplay = commonName ? ` (${commonName})` : '';\n    \n    const fallbackId = 'icon-' + organism.replace(/[^a-zA-Z0-9]/g, '_');\n    \n    // Helper function to highlight search terms in text\n    const highlightSearchTerms = (text, keywords) => {\n        if (!keywords || !text) return text;\n        \n        // Split keywords into individual terms (min 3 chars)\n        const terms = keywords.trim().split(/\\s+/).filter(t => t.length >= 3);\n        if (terms.length === 0) return text;\n        \n        // Create regex to match any term (case insensitive, including partial matches like HDAC in HDAC6)\n        let highlighted = text;\n        terms.forEach(term => {\n            const regex = new RegExp(`${term}`, 'gi');\n            highlighted = highlighted.replace(regex, `<strong style=\"background-color: #fff3cd; font-weight: bold;\">$&</strong>`);\n        });\n        return highlighted;\n    };\n    \n    let imageHtml = '';\n    if (imageUrl) {\n        imageHtml = `<img src=\"${imageUrl}\" class=\"organism-thumbnail\" style=\"height: 24px; width: 24px; margin-right: 8px; border-radius: 3px;\" onerror=\"this.style.display='none'; document.getElementById('${fallbackId}').style.display='inline';\" onload=\"document.getElementById('${fallbackId}').style.display='none';\">\n                     <i class=\"fa fa-dna\" id=\"${fallbackId}\" style=\"margin-right: 8px; display: none;\"></i>`;\n    } else {\n        imageHtml = `<i class=\"fa fa-dna\" style=\"margin-right: 8px;\"></i>`;\n    }\n    \n    const anchorId = 'results-' + organism.replace(/[^a-zA-Z0-9]/g, '_');\n    \n    // Check if this is a uniquename search (no annotation columns)\n    //",
                    "parameters": [
                        {
                            "name": "organism",
                            "type": "string",
                            "description": "The organism identifier"
                        },
                        {
                            "name": "results",
                            "type": "Array",
                            "description": "Array of result objects"
                        },
                        {
                            "name": "sitePath",
                            "type": "string",
                            "description": "The site base path"
                        },
                        {
                            "name": "linkBasePath",
                            "type": "string",
                            "description": "Base path for feature links (e.g., 'tools/parent.php' or 'tools/parent.php')"
                        },
                        {
                            "name": "imageUrl",
                            "type": "string",
                            "description": "Optional URL to organism image thumbnail"
                        }
                    ],
                    "returnType": "string",
                    "returnDescription": "HTML string for the table",
                    "internalCalls": [],
                    "category": "datatable",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "event-listener",
                        "state-modifying",
                        "loops",
                        "error-handling",
                        "validation"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "js/modules/annotation-search.js",
                            "line": 292,
                            "context": "let tableHtml = createOrganismResultsTable(organism, results, this.config.sitePath, 'tools/parent.php', imageUrl, this.currentKeywords);"
                        }
                    ],
                    "phpFilesCount": 0,
                    "phpFiles": []
                },
                {
                    "name": "initializeResultsTable",
                    "line": 165,
                    "comment": "/**\n * Initializes a DataTable with export functionality and column filtering\n * \n * @param {string} tableId - jQuery selector for the table (e.g., '#resultsTable_organism')\n * @param {string} selectId - Unique identifier for the select all button\n * @param {boolean} isUniquenameSearch - Whether this is a uniquename-only search (no annotation columns)\n */",
                    "code": "{\n    // Populate filter containers with filter inputs and Select All button\n    $(tableId + ' .column-filter-container').each(function(i) {\n        const columnIndex = $(this).data('column-index');\n        if (columnIndex === 0) {\n            // Select All button for first column\n            $(this).html('<button style=\"width:110px; border-radius: 4px; white-space: nowrap; border: solid 1px #808080; padding: 0;\" class=\"btn btn_select_all\" id=\"toggle-select-btn' + selectId + '\"><span>Select All</span></button>');\n        } else {\n            $(this).html('<input style=\"text-align:left; border: solid 1px #808080; border-radius: 4px; width: 100%;\" type=\"text\" placeholder=\"Filter...\" class=\"column-search\">');\n        }\n    });\n    \n    // Initialize DataTable\n    const table = $(tableId).DataTable({\n        dom: 'Brtlpi',\n        pageLength: 25,\n        stateSave: false,\n        orderCellsTop: false,\n        buttons: DataTableExportConfig.getSearchResultsButtons(),\n        scrollX: false,\n        scrollCollapse: false,\n        autoWidth: false,\n        fixedHeader: false,\n        columnDefs: isUniquenameSearch ? [\n            { targets: 0, orderable: false, className: \"export-exclude\" },  // Select - not sortable, exclude from export\n            { targets: 1, visible: false, className: \"export-only\" }, // Species - hidden but included in exports\n            { targets: 2 },  // Type\n            { targets: 3 }, // Feature ID\n            { targets: 4 }, // Name\n            { targets: 5, className: \"wrap-text\" }  // Description (with wrapping)\n        ] : [\n            { targets: 0, orderable: false, className: \"export-exclude\" },  // Select - not sortable, exclude from export\n            { targets: 1, visible: false, className: \"export-only\" }, // Species - hidden but included in exports\n            { targets: 2 },  // Type\n            { targets: 3 }, // Feature ID\n            { targets: 4 }, // Name\n            { targets: 5, className: \"wrap-text\" }, // Description (with",
                    "parameters": [
                        {
                            "name": "tableId",
                            "type": "string",
                            "description": "jQuery selector for the table (e.g., '#resultsTable_organism')"
                        },
                        {
                            "name": "selectId",
                            "type": "string",
                            "description": "Unique identifier for the select all button"
                        },
                        {
                            "name": "isUniquenameSearch",
                            "type": "boolean",
                            "description": "Whether this is a uniquename-only search (no annotation columns)"
                        }
                    ],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "datatable",
                    "tags": [
                        "ajax",
                        "state-modifying"
                    ],
                    "usageCount": 2,
                    "usages": [
                        {
                            "file": "js/modules/annotation-search.js",
                            "line": 308,
                            "context": "initializeResultsTable(tableId, selectId, true);"
                        },
                        {
                            "file": "js/modules/shared-results-table.js",
                            "line": 154,
                            "context": "setTimeout(() => initializeResultsTable(tableId, selectId, isUniquenameSearch), 100);"
                        }
                    ],
                    "phpFilesCount": 0,
                    "phpFiles": []
                },
                {
                    "name": "highlightSearchTerms",
                    "line": 32,
                    "comment": "",
                    "code": "{\n        if (!keywords || !text) return text;\n        \n        // Split keywords into individual terms (min 3 chars)\n        const terms = keywords.trim().split(/\\s+/).filter(t => t.length >= 3);\n        if (terms.length === 0) return text;\n        \n        // Create regex to match any term (case insensitive, including partial matches like HDAC in HDAC6)\n        let highlighted = text;\n        terms.forEach(term => {\n            const regex = new RegExp(`${term}`, 'gi');\n            highlighted = highlighted.replace(regex, `<strong style=\"background-color: #fff3cd; font-weight: bold;\">$&</strong>`);\n        });\n        return highlighted;\n    }",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "data-processing",
                    "tags": [
                        "state-modifying",
                        "loops"
                    ],
                    "usageCount": 3,
                    "usages": [
                        {
                            "file": "js/modules/shared-results-table.js",
                            "line": 133,
                            "context": "<td>${highlightSearchTerms(result.feature_name, searchKeywords)}</td>"
                        },
                        {
                            "file": "js/modules/shared-results-table.js",
                            "line": 134,
                            "context": "<td>${highlightSearchTerms(result.feature_description, searchKeywords)}</td>`;"
                        },
                        {
                            "file": "js/modules/shared-results-table.js",
                            "line": 140,
                            "context": "<td>${highlightSearchTerms(result.annotation_description, searchKeywords)}</td>`;"
                        }
                    ],
                    "phpFilesCount": 0,
                    "phpFiles": []
                }
            ]
        },
        {
            "name": "js/modules/source-list-manager.js",
            "count": 11,
            "functions": [
                {
                    "name": "isSourceVisible",
                    "line": 13,
                    "comment": "/**\n * Check if an element is visible (not hidden by display: none or hidden class)\n * \n * @param {HTMLElement} element - Element to check\n * @returns {boolean} True if element is visible\n */",
                    "code": "{\n    if (!element) return false;\n    if (element.classList.contains('hidden')) return false;\n    if (element.style.display === 'none') return false;\n    return true;\n}",
                    "parameters": [
                        {
                            "name": "element",
                            "type": "HTMLElement",
                            "description": "Element to check"
                        }
                    ],
                    "returnType": "boolean",
                    "returnDescription": "True if element is visible",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "state-modifying"
                    ],
                    "usageCount": 9,
                    "usages": [
                        {
                            "file": "js/modules/source-list-manager.js",
                            "line": 63,
                            "context": "if (line && isSourceVisible(line)) {"
                        },
                        {
                            "file": "js/modules/source-list-manager.js",
                            "line": 114,
                            "context": "if (checked && isSourceVisible(checked.closest('.' + sourceListClass))) {"
                        },
                        {
                            "file": "js/modules/source-list-manager.js",
                            "line": 204,
                            "context": "const isHidden = (showHiddenWarning && line && !isSourceVisible(line)) ? ' \u26a0\ufe0f (HIDDEN - FILTERED OUT)' : '';"
                        },
                        {
                            "file": "js/modules/source-list-manager.js",
                            "line": 318,
                            "context": "if (line && !isSourceVisible(line)) {"
                        },
                        {
                            "file": "js/modules/source-list-manager.js",
                            "line": 345,
                            "context": "if (line && isSourceVisible(line)) {"
                        },
                        {
                            "file": "js/modules/source-list-manager.js",
                            "line": 359,
                            "context": "if (firstRadio && isSourceVisible(firstRadio.closest('.' + sourceListClass))) {"
                        },
                        {
                            "file": "js/modules/source-list-manager.js",
                            "line": 374,
                            "context": "if (line && isSourceVisible(line)) {"
                        },
                        {
                            "file": "js/modules/source-list-manager.js",
                            "line": 388,
                            "context": "if (line && isSourceVisible(line)) {"
                        },
                        {
                            "file": "js/modules/source-list-manager.js",
                            "line": 398,
                            "context": "if (line && !isSourceVisible(line)) {"
                        }
                    ],
                    "phpFilesCount": 2,
                    "phpFiles": [
                        "tools/blast.php",
                        "tools/retrieve_sequences.php"
                    ]
                },
                {
                    "name": "applySourceFilter",
                    "line": 27,
                    "comment": "/**\n * Apply filter to source list based on search input\n * Shows/hides source items based on matching search text\n * \n * @param {string} filterId - ID of the filter input element (default: 'sourceFilter')\n * @param {string} sourceListClass - CSS class of source line items (default: 'fasta-source-line')\n */",
                    "code": "{\n    const filterInput = document.getElementById(filterId);\n    const sourceLines = document.querySelectorAll('.' + sourceListClass);\n    \n    if (!filterInput) {\n        console.warn('Filter input not found:', filterId);\n        return;\n    }\n    \n    const filterText = (filterInput.value || '').toLowerCase();\n    \n    sourceLines.forEach(line => {\n        const searchText = line.dataset.search || '';\n        if (filterText === '' || searchText.includes(filterText)) {\n            line.classList.remove('hidden');\n        } else {\n            line.classList.add('hidden');\n        }\n    });\n}",
                    "parameters": [
                        {
                            "name": "filterId",
                            "type": "string",
                            "description": "ID of the filter input element (default: 'sourceFilter')"
                        },
                        {
                            "name": "sourceListClass",
                            "type": "string",
                            "description": "CSS class of source line items (default: 'fasta-source-line')"
                        }
                    ],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "data-processing",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "state-modifying",
                        "loops"
                    ],
                    "usageCount": 2,
                    "usages": [
                        {
                            "file": "js/modules/source-list-manager.js",
                            "line": 243,
                            "context": "applySourceFilter(filterId, sourceListClass);"
                        },
                        {
                            "file": "js/modules/source-list-manager.js",
                            "line": 257,
                            "context": "applySourceFilter(filterId, sourceListClass);"
                        }
                    ],
                    "phpFilesCount": 2,
                    "phpFiles": [
                        "tools/blast.php",
                        "tools/retrieve_sequences.php"
                    ]
                },
                {
                    "name": "autoSelectFirstVisibleSource",
                    "line": 56,
                    "comment": "/**\n * Auto-select the first visible source radio button\n * Useful after filtering to ensure a valid selection is always visible\n * \n * @param {string} radioName - Name attribute of radio buttons (default: 'selected_source')\n * @param {string} sourceListClass - CSS class of source line items (default: 'fasta-source-line')\n * @param {string} scrollContainerSelector - Selector for scrollable container (optional, e.g., '.fasta-source-list')\n */",
                    "code": "{\n    const allRadios = document.querySelectorAll(`input[name=\"${radioName}\"]`);\n    let firstVisibleRadio = null;\n    \n    allRadios.forEach(radio => {\n        const line = radio.closest('.' + sourceListClass);\n        if (line && isSourceVisible(line)) {\n            if (!firstVisibleRadio) {\n                firstVisibleRadio = radio;\n            }\n        }\n    });\n    \n    if (firstVisibleRadio) {\n        // Uncheck any currently checked radios\n        allRadios.forEach(radio => radio.checked = false);\n        // Check the first visible one\n        firstVisibleRadio.checked = true;\n        // Trigger change event to allow dependent updates\n        firstVisibleRadio.dispatchEvent(new Event('change', { bubbles: true }));\n        // Scroll into view if container is specified\n        if (scrollContainerSelector) {\n            scrollSourceIntoView(firstVisibleRadio, sourceListClass, scrollContainerSelector);\n        }\n        return firstVisibleRadio;\n    }\n    \n    return null;\n}",
                    "parameters": [
                        {
                            "name": "radioName",
                            "type": "string",
                            "description": "Name attribute of radio buttons (default: 'selected_source')"
                        },
                        {
                            "name": "sourceListClass",
                            "type": "string",
                            "description": "CSS class of source line items (default: 'fasta-source-line')"
                        },
                        {
                            "name": "scrollContainerSelector",
                            "type": "string",
                            "description": "Selector for scrollable container (optional, e.g., '.fasta-source-list')"
                        }
                    ],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "isSourceVisible",
                        "scrollSourceIntoView"
                    ],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "state-modifying",
                        "loops",
                        "validation"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "js/modules/source-list-manager.js",
                            "line": 164,
                            "context": "selectedRadio = autoSelectFirstVisibleSource(radioName, sourceListClass, '.fasta-source-list');"
                        }
                    ],
                    "phpFilesCount": 2,
                    "phpFiles": [
                        "tools/blast.php",
                        "tools/retrieve_sequences.php"
                    ]
                },
                {
                    "name": "scrollSourceIntoView",
                    "line": 93,
                    "comment": "/**\n * Scroll the selected source line into view within its container\n * \n * @param {HTMLElement} radio - The radio button element\n * @param {string} sourceListClass - CSS class of source line items (default: 'fasta-source-line')\n * @param {string} scrollContainerSelector - CSS selector for the scrollable container\n */",
                    "code": "{\n    const line = radio.closest('.' + sourceListClass);\n    const container = document.querySelector(scrollContainerSelector);\n    \n    if (line && container) {\n        line.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\n    }\n}",
                    "parameters": [
                        {
                            "name": "radio",
                            "type": "HTMLElement",
                            "description": "The radio button element"
                        },
                        {
                            "name": "sourceListClass",
                            "type": "string",
                            "description": "CSS class of source line items (default: 'fasta-source-line')"
                        },
                        {
                            "name": "scrollContainerSelector",
                            "type": "string",
                            "description": "CSS selector for the scrollable container"
                        }
                    ],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "event-listener",
                        "state-modifying"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "js/modules/source-list-manager.js",
                            "line": 79,
                            "context": "scrollSourceIntoView(firstVisibleRadio, sourceListClass, scrollContainerSelector);"
                        }
                    ],
                    "phpFilesCount": 2,
                    "phpFiles": [
                        "tools/blast.php",
                        "tools/retrieve_sequences.php"
                    ]
                },
                {
                    "name": "restoreSourceSelection",
                    "line": 111,
                    "comment": "/**\n * Restore previously selected source from a checked radio button\n * \n * @param {string} radioName - Name attribute of radio buttons (default: 'selected_source')\n * @param {string} sourceListClass - CSS class of source line items (default: 'fasta-source-line')\n * @returns {HTMLElement|null} The checked radio button, or null if none found\n */",
                    "code": "{\n    const checked = document.querySelector(`input[name=\"${radioName}\"]:checked`);\n    if (checked && isSourceVisible(checked.closest('.' + sourceListClass))) {\n        return checked;\n    }\n    return null;\n}",
                    "parameters": [
                        {
                            "name": "radioName",
                            "type": "string",
                            "description": "Name attribute of radio buttons (default: 'selected_source')"
                        },
                        {
                            "name": "sourceListClass",
                            "type": "string",
                            "description": "CSS class of source line items (default: 'fasta-source-line')"
                        }
                    ],
                    "returnType": "HTMLElement|null",
                    "returnDescription": "The checked radio button, or null if none found",
                    "internalCalls": [
                        "isSourceVisible"
                    ],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "state-modifying",
                        "validation"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "js/modules/source-list-manager.js",
                            "line": 160,
                            "context": "let selectedRadio = restoreSourceSelection(radioName, sourceListClass);"
                        }
                    ],
                    "phpFilesCount": 2,
                    "phpFiles": [
                        "tools/blast.php",
                        "tools/retrieve_sequences.php"
                    ]
                },
                {
                    "name": "clearSourceFilters",
                    "line": 130,
                    "comment": "/**\n * Clear all source filters and show all items\n * Maintains the previously selected source if it becomes visible\n * Updates form hidden fields to reflect the selected assembly\n * \n * @param {string} filterId - ID of the filter input element (default: 'sourceFilter')\n * @param {string} radioName - Name attribute of radio buttons (default: 'selected_source')\n * @param {string} sourceListClass - CSS class of source line items (default: 'fasta-source-line')\n * @param {string} filterMessageId - ID of the filter message element to hide (optional)\n * @param {string} formId - ID of the form to update (default: 'downloadForm')\n */",
                    "code": "{\n    const filterInput = document.getElementById(filterId);\n    const sourceLines = document.querySelectorAll('.' + sourceListClass);\n    const filterMessage = filterMessageId ? document.getElementById(filterMessageId) : null;\n    const form = document.getElementById(formId);\n    \n    // Clear filter input\n    if (filterInput) {\n        filterInput.value = '';\n    }\n    \n    // Show all source lines (remove inline display: none)\n    sourceLines.forEach(line => {\n        line.style.display = '';\n        line.classList.remove('hidden');\n    });\n    \n    // Re-enable all radio buttons that are now visible\n    const allRadios = document.querySelectorAll(`input[name=\"${radioName}\"]`);\n    allRadios.forEach(radio => {\n        radio.disabled = false;\n    });\n    \n    // Hide the filter message if it exists\n    if (filterMessage) {\n        filterMessage.style.display = 'none';\n    }\n    \n    // Try to restore previously selected source, or select first visible\n    let selectedRadio = restoreSourceSelection(radioName, sourceListClass);\n    \n    // If restore failed (saved selection not visible), select first visible\n    if (!selectedRadio) {\n        selectedRadio = autoSelectFirstVisibleSource(radioName, sourceListClass, '.fasta-source-list');\n    }\n    \n    // Update form hidden fields if we have a selected radio\n    if (selectedRadio && form) {\n        form.querySelector('input[name=\"organism\"]').value = selectedRadio.dataset.organism;\n        form.querySelector('input[name=\"assembly\"]').value = selectedRadio.dataset.assembly;\n    }\n    \n    // Focus back on filter input\n    if (filterInput) {\n        filterInput.focus();\n    }\n    \n    return selectedRadio;\n}",
                    "parameters": [
                        {
                            "name": "filterId",
                            "type": "string",
                            "description": "ID of the filter input element (default: 'sourceFilter')"
                        },
                        {
                            "name": "radioName",
                            "type": "string",
                            "description": "Name attribute of radio buttons (default: 'selected_source')"
                        },
                        {
                            "name": "sourceListClass",
                            "type": "string",
                            "description": "CSS class of source line items (default: 'fasta-source-line')"
                        },
                        {
                            "name": "filterMessageId",
                            "type": "string",
                            "description": "ID of the filter message element to hide (optional)"
                        },
                        {
                            "name": "formId",
                            "type": "string",
                            "description": "ID of the form to update (default: 'downloadForm')"
                        }
                    ],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "restoreSourceSelection",
                        "autoSelectFirstVisibleSource"
                    ],
                    "category": "data-processing",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "state-modifying",
                        "loops"
                    ],
                    "usageCount": 2,
                    "usages": [
                        {
                            "file": "js/blast-manager.js",
                            "line": 54,
                            "context": "window.clearSourceFilters('sourceFilter', 'selected_source', 'fasta-source-line', null, 'blastForm');"
                        },
                        {
                            "file": "js/sequence-retrieval.js",
                            "line": 8,
                            "context": "clearSourceFilters('sourceFilter', 'selected_source', 'fasta-source-line', null, 'downloadForm');"
                        }
                    ],
                    "phpFilesCount": 2,
                    "phpFiles": [
                        "tools/blast.php",
                        "tools/retrieve_sequences.php"
                    ]
                },
                {
                    "name": "updateCurrentSelectionDisplay",
                    "line": 188,
                    "comment": "/**\n * Update the display of currently selected source (organism > assembly)\n * Shows which source is selected and highlights if it's hidden due to filtering\n * \n * @param {string} selectionDivId - ID of the div to display selection (default: 'currentSelection')\n * @param {string} sourceListClass - CSS class of source line items (default: 'fasta-source-line')\n * @param {boolean} showHiddenWarning - Show warning if selected item is filtered out (default: true)\n */",
                    "code": "{\n    const checked = document.querySelector('input[name=\"selected_source\"]:checked');\n    const selectionDiv = document.getElementById(selectionDivId);\n    \n    if (!selectionDiv) {\n        console.warn('Selection display div not found:', selectionDivId);\n        return;\n    }\n    \n    if (checked) {\n        const line = checked.closest('.' + sourceListClass);\n        const groupBadge = line ? line.querySelector('.badge') : null;\n        const group = groupBadge ? groupBadge.textContent.trim() : 'Unknown';\n        const organism = checked.dataset.organism || 'Unknown';\n        const assembly = checked.dataset.assembly || 'Unknown';\n        const isHidden = (showHiddenWarning && line && !isSourceVisible(line)) ? ' \u26a0\ufe0f (HIDDEN - FILTERED OUT)' : '';\n        \n        selectionDiv.innerHTML = `\n            <div style=\"color: #28a745; font-weight: bold;\">\n                ${group} > ${organism} > ${assembly}${isHidden}\n            </div>\n        `;\n    } else {\n        selectionDiv.innerHTML = '';\n    }\n}",
                    "parameters": [
                        {
                            "name": "selectionDivId",
                            "type": "string",
                            "description": "ID of the div to display selection (default: 'currentSelection')"
                        },
                        {
                            "name": "sourceListClass",
                            "type": "string",
                            "description": "CSS class of source line items (default: 'fasta-source-line')"
                        },
                        {
                            "name": "showHiddenWarning",
                            "type": "boolean",
                            "description": "Show warning if selected item is filtered out (default: true)"
                        }
                    ],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "ui-dom",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "event-listener",
                        "state-modifying",
                        "validation"
                    ],
                    "usageCount": 8,
                    "usages": [
                        {
                            "file": "js/blast-manager.js",
                            "line": 61,
                            "context": "window.updateCurrentSelectionDisplay();"
                        },
                        {
                            "file": "js/blast-manager.js",
                            "line": 77,
                            "context": "updateCurrentSelectionDisplay();"
                        },
                        {
                            "file": "js/blast-manager.js",
                            "line": 80,
                            "context": "updateCurrentSelectionDisplay();"
                        },
                        {
                            "file": "js/blast-manager.js",
                            "line": 86,
                            "context": "updateCurrentSelectionDisplay();"
                        },
                        {
                            "file": "js/sequence-retrieval.js",
                            "line": 25,
                            "context": "window.updateCurrentSelectionDisplay('currentSelection', 'fasta-source-line', true);"
                        },
                        {
                            "file": "js/sequence-retrieval.js",
                            "line": 47,
                            "context": "updateCurrentSelectionDisplay();"
                        },
                        {
                            "file": "js/sequence-retrieval.js",
                            "line": 50,
                            "context": "updateCurrentSelectionDisplay();"
                        },
                        {
                            "file": "js/sequence-retrieval.js",
                            "line": 55,
                            "context": "updateCurrentSelectionDisplay();"
                        }
                    ],
                    "phpFilesCount": 2,
                    "phpFiles": [
                        "tools/blast.php",
                        "tools/retrieve_sequences.php"
                    ]
                },
                {
                    "name": "initializeSourceListManager",
                    "line": 226,
                    "comment": "/**\n * Initialize source list filtering on page load\n * Sets up filter input listeners and applies initial filtering\n * \n * @param {Object} options - Configuration options\n * @param {string} options.filterId - ID of filter input (default: 'sourceFilter')\n * @param {string} options.radioName - Name of radio buttons (default: 'selected_source')\n * @param {string} options.sourceListClass - CSS class of source items (default: 'fasta-source-line')\n * @param {string} options.filterMessageId - ID of filter message element (optional)\n * @param {Function} options.onSelectionChange - Callback when selection changes (optional)\n */",
                    "code": "{}",
                    "parameters": [
                        {
                            "name": "options",
                            "type": "Object",
                            "description": "Configuration options"
                        },
                        {
                            "name": "options",
                            "type": "string",
                            "description": ".filterId - ID of filter input (default: 'sourceFilter')"
                        },
                        {
                            "name": "options",
                            "type": "string",
                            "description": ".radioName - Name of radio buttons (default: 'selected_source')"
                        },
                        {
                            "name": "options",
                            "type": "string",
                            "description": ".sourceListClass - CSS class of source items (default: 'fasta-source-line')"
                        },
                        {
                            "name": "options",
                            "type": "string",
                            "description": ".filterMessageId - ID of filter message element (optional)"
                        },
                        {
                            "name": "options",
                            "type": "Function",
                            "description": ".onSelectionChange - Callback when selection changes (optional)"
                        }
                    ],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "js/modules/source-list-manager.js",
                            "line": 303,
                            "context": "initializeSourceListManager({"
                        }
                    ],
                    "phpFilesCount": 2,
                    "phpFiles": [
                        "tools/blast.php",
                        "tools/retrieve_sequences.php"
                    ]
                },
                {
                    "name": "initializeSourceSelector",
                    "line": 277,
                    "comment": "/**\n * Initialize source selector with unified logic for all tools\n * Handles group filters, multi-organism filters, and auto-selection logic\n * \n * Cases:\n * 1. Assembly specified: show assembly name, auto-select\n * 2. Organism specified: show organism name, auto-select\n * 3. Group specified: show group name, DON'T auto-select (let user choose)\n * 4. Multiple organisms: show empty filter, restrict list, auto-select first if needed\n * \n * @param {Object} options - Configuration options\n * @param {string} options.formId - ID of form (default: 'blastForm')\n * @param {string} options.filterId - ID of filter input (default: 'sourceFilter')\n * @param {string} options.radioName - Name of radio buttons (default: 'selected_source')\n * @param {string} options.sourceListClass - CSS class of source items (default: 'fasta-source-line')\n * @param {Function} options.onSelectionChange - Callback when selection changes\n * @param {Function} options.onFilterChange - Callback when filter changes\n */",
                    "code": "{}",
                    "parameters": [
                        {
                            "name": "options",
                            "type": "Object",
                            "description": "Configuration options"
                        },
                        {
                            "name": "options",
                            "type": "string",
                            "description": ".formId - ID of form (default: 'blastForm')"
                        },
                        {
                            "name": "options",
                            "type": "string",
                            "description": ".filterId - ID of filter input (default: 'sourceFilter')"
                        },
                        {
                            "name": "options",
                            "type": "string",
                            "description": ".radioName - Name of radio buttons (default: 'selected_source')"
                        },
                        {
                            "name": "options",
                            "type": "string",
                            "description": ".sourceListClass - CSS class of source items (default: 'fasta-source-line')"
                        },
                        {
                            "name": "options",
                            "type": "Function",
                            "description": ".onSelectionChange - Callback when selection changes"
                        },
                        {
                            "name": "options",
                            "type": "Function",
                            "description": ".onFilterChange - Callback when filter changes"
                        }
                    ],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [],
                    "usageCount": 2,
                    "usages": [
                        {
                            "file": "js/blast-manager.js",
                            "line": 70,
                            "context": "initializeSourceSelector({"
                        },
                        {
                            "file": "js/sequence-retrieval.js",
                            "line": 34,
                            "context": "initializeSourceSelector({"
                        }
                    ],
                    "phpFilesCount": 2,
                    "phpFiles": [
                        "tools/blast.php",
                        "tools/retrieve_sequences.php"
                    ]
                },
                {
                    "name": "filterText",
                    "line": 37,
                    "comment": "",
                    "code": "{\n        const searchText = line.dataset.search || '';\n        if (filterText === '' || searchText.includes(filterText)) {\n            line.classList.remove('hidden');\n        } else {\n            line.classList.add('hidden');\n        }\n    }",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "data-processing",
                    "tags": [
                        "dom-manipulation",
                        "state-modifying"
                    ],
                    "usageCount": 0,
                    "usages": [],
                    "phpFilesCount": 2,
                    "phpFiles": [
                        "tools/blast.php",
                        "tools/retrieve_sequences.php"
                    ]
                },
                {
                    "name": "isHidden",
                    "line": 204,
                    "comment": "",
                    "code": "{group}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [],
                    "usageCount": 0,
                    "usages": [],
                    "phpFilesCount": 2,
                    "phpFiles": [
                        "tools/blast.php",
                        "tools/retrieve_sequences.php"
                    ]
                }
            ]
        },
        {
            "name": "js/modules/taxonomy-tree.js",
            "count": 2,
            "functions": [
                {
                    "name": "initPhyloTree",
                    "line": 168,
                    "comment": "",
                    "code": "{\n    phyloTree = new PhyloTree('taxonomy-tree-container', treeData, userAccess);\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "general",
                    "tags": [
                        "state-modifying"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "js/index.js",
                            "line": 70,
                            "context": "initPhyloTree(treeData, userAccess);"
                        }
                    ],
                    "phpFilesCount": 2,
                    "phpFiles": [
                        "admin/manage_taxonomy_tree.php",
                        "tools/pages/index.php"
                    ]
                },
                {
                    "name": "traverse",
                    "line": 22,
                    "comment": "",
                    "code": "{\n            if (n.organism && this.hasAccess(n.organism)) {\n                organisms.push(n.organism);\n            }\n            if (n.children) {\n                n.children.forEach(child => traverse(child));\n            }\n        }",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "traverse"
                    ],
                    "category": "general",
                    "tags": [
                        "state-modifying",
                        "loops"
                    ],
                    "usageCount": 2,
                    "usages": [
                        {
                            "file": "js/modules/taxonomy-tree.js",
                            "line": 27,
                            "context": "n.children.forEach(child => traverse(child));"
                        },
                        {
                            "file": "js/modules/taxonomy-tree.js",
                            "line": 30,
                            "context": "traverse(node);"
                        }
                    ],
                    "phpFilesCount": 2,
                    "phpFiles": [
                        "admin/manage_taxonomy_tree.php",
                        "tools/pages/index.php"
                    ]
                }
            ]
        },
        {
            "name": "js/modules/utilities.js",
            "count": 2,
            "functions": [
                {
                    "name": "initPhyloTree",
                    "line": 168,
                    "comment": "",
                    "code": "{\n    phyloTree = new PhyloTree('taxonomy-tree-container', treeData, userAccess);\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "general",
                    "tags": [
                        "state-modifying"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "js/index.js",
                            "line": 70,
                            "context": "initPhyloTree(treeData, userAccess);"
                        }
                    ],
                    "phpFilesCount": 2,
                    "phpFiles": [
                        "admin/manage_taxonomy_tree.php",
                        "tools/pages/index.php"
                    ]
                },
                {
                    "name": "traverse",
                    "line": 22,
                    "comment": "",
                    "code": "{\n            if (n.organism && this.hasAccess(n.organism)) {\n                organisms.push(n.organism);\n            }\n            if (n.children) {\n                n.children.forEach(child => traverse(child));\n            }\n        }",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "traverse"
                    ],
                    "category": "general",
                    "tags": [
                        "state-modifying",
                        "loops"
                    ],
                    "usageCount": 2,
                    "usages": [
                        {
                            "file": "js/modules/taxonomy-tree.js",
                            "line": 27,
                            "context": "n.children.forEach(child => traverse(child));"
                        },
                        {
                            "file": "js/modules/taxonomy-tree.js",
                            "line": 30,
                            "context": "traverse(node);"
                        }
                    ],
                    "phpFilesCount": 2,
                    "phpFiles": [
                        "admin/manage_taxonomy_tree.php",
                        "tools/pages/index.php"
                    ]
                }
            ]
        },
        {
            "name": "js/permission-manager.js",
            "count": 2,
            "functions": [
                {
                    "name": "fixFilePermissions",
                    "line": 16,
                    "comment": "/**\n * Fix file or directory permissions via AJAX\n * \n * @param {Event} event - Click event\n * @param {string} filePath - Path to file or directory\n * @param {string} fileType - 'file' or 'directory'\n * @param {string} organism - Optional organism name (for organism-specific fixes)\n * @param {string} resultId - ID of result div to show status\n */",
                    "code": "{\n  event.preventDefault();\n  \n  const resultDiv = document.getElementById(resultId);\n  const button = event.target.closest('button');\n  \n  if (!resultDiv) {\n    console.error('Result div not found: ' + resultId);\n    return;\n  }\n  \n  // Disable button and show loading\n  const originalHtml = button.innerHTML;\n  button.disabled = true;\n  button.innerHTML = '<i class=\"fa fa-spinner fa-spin\"></i> Fixing...';\n  \n  resultDiv.innerHTML = '<div class=\"alert alert-info small\">Processing...</div>';\n  \n  // Send AJAX request\n  const data = new FormData();\n  data.append('action', 'fix_file_permissions');\n  data.append('file_path', filePath);\n  data.append('file_type', fileType);\n  if (organism) {\n    data.append('organism', organism);\n  }\n  \n  fetch(window.location.pathname, {\n    method: 'POST',\n    body: data\n  })\n  .then(response => response.json())\n  .then(json => {\n    if (json.success) {\n      resultDiv.innerHTML = '<div class=\"alert alert-success small\">' +\n        '<i class=\"fa fa-check-circle\"></i> ' + escapeHtml(json.message) + ' ' +\n        '<strong>Refreshing...</strong></div>';\n      \n      // Refresh page after short delay\n      setTimeout(() => {\n        window.location.reload();\n      }, 1500);\n    } else {\n      resultDiv.innerHTML = '<div class=\"alert alert-danger small\">' +\n        '<i class=\"fa fa-times-circle\"></i> <strong>Failed:</strong> ' + escapeHtml(json.message) + '</div>';\n      \n      button.disabled = false;\n      button.innerHTML = originalHtml;\n    }\n  })\n  .catch(error => {\n    resultDiv.innerHTML = '<div class=\"alert alert-danger small\">' +\n      '<i class=\"fa fa-exclamation-triangle\"></i> <strong>Error:</strong> ' + escapeHtml(error.message) + '</div>';\n    \n    button.disabled = false;\n    button.innerHTML = originalHtml;\n  });\n}",
                    "parameters": [
                        {
                            "name": "event",
                            "type": "Event",
                            "description": "Click event"
                        },
                        {
                            "name": "filePath",
                            "type": "string",
                            "description": "Path to file or directory"
                        },
                        {
                            "name": "fileType",
                            "type": "string",
                            "description": "'file' or 'directory'"
                        },
                        {
                            "name": "organism",
                            "type": "string",
                            "description": "Optional organism name (for organism-specific fixes)"
                        },
                        {
                            "name": "resultId",
                            "type": "string",
                            "description": "ID of result div to show status"
                        }
                    ],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "escapeHtml"
                    ],
                    "category": "admin",
                    "tags": [
                        "dom-manipulation",
                        "asynchronous",
                        "ajax",
                        "event-listener",
                        "state-modifying",
                        "error-handling",
                        "validation"
                    ],
                    "usageCount": 0,
                    "usages": [],
                    "phpFilesCount": 0,
                    "phpFiles": []
                },
                {
                    "name": "md5",
                    "line": 79,
                    "comment": "/**\n * MD5 hash function for generating consistent IDs\n * Simple implementation for ID generation\n */",
                    "code": "{\n  // Simple hash function - not cryptographically secure but good for IDs\n  let hash = 0;\n  if (str.length === 0) return hash.toString();\n  \n  for (let i = 0; i < str.length; i++) {\n    const char = str.charCodeAt(i);\n    hash = ((hash << 5) - hash) + char;\n    hash = hash & hash; // Convert to 32bit integer\n  }\n  \n  return Math.abs(hash).toString(16);\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "admin",
                    "tags": [
                        "state-modifying",
                        "loops"
                    ],
                    "usageCount": 0,
                    "usages": [],
                    "phpFilesCount": 0,
                    "phpFiles": []
                }
            ]
        },
        {
            "name": "js/registry.js",
            "count": 14,
            "functions": [
                {
                    "name": "loadRegistry",
                    "line": 8,
                    "comment": "/**\n * Load and display registry on page load\n */",
                    "code": "{\n    updateStats();\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "updateStats"
                    ],
                    "category": "general",
                    "tags": [],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "js/registry.js",
                            "line": 340,
                            "context": "loadRegistry();"
                        }
                    ],
                    "phpFilesCount": 7,
                    "phpFiles": [
                        "admin/manage_js_registry.php",
                        "admin/manage_registry.php",
                        "admin/registry-template.php",
                        "admin/pages/manage_js_registry.php",
                        "admin/tools/generate_registry_json.php",
                        "tools/generate_js_registry_json.php",
                        "tools/generate_registry_json.php"
                    ]
                },
                {
                    "name": "updateStats",
                    "line": 15,
                    "comment": "/**\n * Update statistics from registry data\n */",
                    "code": "{\n    // If we have registry data available, use it directly\n    const dataElement = document.getElementById('registryData');\n    if (dataElement) {\n        try {\n            const data = JSON.parse(dataElement.textContent);\n            const unusedEl = document.getElementById('unusedCount');\n            if (unusedEl && data.unused) {\n                unusedEl.textContent = data.unused.length;\n                return; // Don't calculate from DOM if we have JSON data\n            }\n        } catch(e) {\n            console.log('Could not parse registry data');\n        }\n    }\n    \n    // Fall back to DOM-based calculation\n    const fileSections = document.querySelectorAll('.file-section');\n    const totalFiles = fileSections.length;\n    \n    let totalFunctions = 0;\n    let usedFunctions = 0;\n    let unusedFunctions = 0;\n    \n    fileSections.forEach(section => {\n        const items = section.querySelectorAll('.function-item');\n        totalFunctions += items.length;\n        \n        items.forEach(item => {\n            const usageText = item.textContent;\n            if (usageText.includes('Used in: 0 files') || usageText.includes('possibly unused') || item.querySelector('.unused-badge')) {\n                unusedFunctions++;\n            } else {\n                usedFunctions++;\n            }\n        });\n    });\n    \n    const totalEl = document.getElementById('totalCount');\n    const fileEl = document.getElementById('fileCount');\n    const usedEl = document.getElementById('usedCount');\n    const unusedEl = document.getElementById('unusedCount');\n    \n    if (totalEl) totalEl.textContent = totalFunctions || '-';\n    if (fileEl) fileEl.textContent = totalFiles || '-';\n    if (usedEl) usedEl.textContent = usedFunctions || '-';\n    if (unusedEl) unusedEl.textContent = unusedFunctions || '-';\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "general",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "event-listener",
                        "state-modifying",
                        "loops",
                        "error-handling"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "js/registry.js",
                            "line": 10,
                            "context": "updateStats();"
                        }
                    ],
                    "phpFilesCount": 7,
                    "phpFiles": [
                        "admin/manage_js_registry.php",
                        "admin/manage_registry.php",
                        "admin/registry-template.php",
                        "admin/pages/manage_js_registry.php",
                        "admin/tools/generate_registry_json.php",
                        "tools/generate_js_registry_json.php",
                        "tools/generate_registry_json.php"
                    ]
                },
                {
                    "name": "generateRegistry",
                    "line": 67,
                    "comment": "/**\n * Generate/update registry\n */",
                    "code": "{\n    const btn = document.getElementById('generateBtn');\n    const msg = document.getElementById('registryMessage');\n    \n    if (!btn) return;\n    \n    const registryType = btn.dataset.registryType || 'php';\n    \n    btn.disabled = true;\n    btn.innerHTML = '<i class=\"fa fa-spinner fa-spin\"></i> Generating...';\n    \n    fetch('/admin/api/generate_registry.php', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n            type: registryType\n        })\n    })\n    .then(response => response.json())\n    .then(data => {\n        if (msg) {\n            msg.innerHTML = `<div class=\"alert alert-${data.success ? 'success' : 'danger'}\">\n                <i class=\"fa fa-${data.success ? 'check' : 'exclamation'}\"></i> ${data.message}\n            </div>`;\n        }\n        \n        btn.disabled = false;\n        btn.innerHTML = '<i class=\"fa fa-refresh\"></i> Generate/Update Registry';\n        \n        if (data.success) {\n            setTimeout(() => location.reload(), 1500);\n        }\n    })\n    .catch(error => {\n        if (msg) {\n            msg.innerHTML = `<div class=\"alert alert-danger\">\n                <i class=\"fa fa-exclamation\"></i> Error: ${error.message}\n            </div>`;\n        }\n        btn.disabled = false;\n        btn.innerHTML = '<i class=\"fa fa-refresh\"></i> Generate/Update Registry';\n    });\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "general",
                    "tags": [
                        "dom-manipulation",
                        "asynchronous",
                        "ajax",
                        "event-listener",
                        "state-modifying",
                        "error-handling",
                        "validation"
                    ],
                    "usageCount": 4,
                    "usages": [
                        {
                            "file": "admin/pages/manage_js_registry.php",
                            "line": 58,
                            "context": "<button class=\"btn btn-primary w-100\" onclick=\"generateRegistry()\" id=\"generateBtn\" data-registry-type=\"js\">"
                        },
                        {
                            "file": "admin/pages/manage_registry.php",
                            "line": 37,
                            "context": "<button class=\"btn btn-primary w-100\" onclick=\"generateRegistry()\" id=\"generateBtn\" data-registry-type=\"php\">"
                        },
                        {
                            "file": "tools/pages/js_registry.php",
                            "line": 41,
                            "context": "<button class=\"btn btn-primary w-100\" onclick=\"generateRegistry()\" id=\"generateBtn\" data-registry-type=\"js\">"
                        },
                        {
                            "file": "tools/pages/registry.php",
                            "line": 40,
                            "context": "<button class=\"btn btn-warning btn-sm\" onclick=\"generateRegistry()\"><i class=\"fa fa-refresh\"></i> Regenerate</button>"
                        }
                    ],
                    "phpFilesCount": 7,
                    "phpFiles": [
                        "admin/manage_js_registry.php",
                        "admin/manage_registry.php",
                        "admin/registry-template.php",
                        "admin/pages/manage_js_registry.php",
                        "admin/tools/generate_registry_json.php",
                        "tools/generate_js_registry_json.php",
                        "tools/generate_registry_json.php"
                    ]
                },
                {
                    "name": "filterFunctions",
                    "line": 116,
                    "comment": "/**\n * Search/filter functions\n */",
                    "code": "{\n    const searchInput = document.getElementById('searchInput');\n    if (!searchInput) return;\n    \n    const searchTerm = searchInput.value.toLowerCase();\n    const searchMode = document.querySelector('input[name=\"searchMode\"]:checked');\n    const mode = searchMode ? searchMode.value : 'all';\n    const fileSections = document.querySelectorAll('.file-section');\n    \n    let visibleSections = 0;\n    let totalMatches = 0;\n    \n    fileSections.forEach(section => {\n        const fileHeader = section.querySelector('.file-header');\n        const fileName = fileHeader ? fileHeader.textContent.toLowerCase() : '';\n        const functionItems = section.querySelectorAll('.function-item');\n        let hasVisibleFunction = false;\n        let sectionMatches = 0;\n        \n        functionItems.forEach(item => {\n            const funcNameEl = item.querySelector('.function-name');\n            const funcName = funcNameEl ? funcNameEl.textContent.toLowerCase() : '';\n            const funcCodeEl = item.querySelector('.function-code');\n            const funcCode = funcCodeEl ? funcCodeEl.textContent.toLowerCase() : '';\n            const funcCommentEl = item.querySelector('.function-comment');\n            const funcComment = funcCommentEl ? funcCommentEl.textContent.toLowerCase() : '';\n            \n            let match = false;\n            \n            if (searchTerm === '') {\n                match = true;\n            } else {\n                if (mode === 'all') {\n                    match = funcName.includes(searchTerm) || funcCode.includes(searchTerm) || funcComment.includes(searchTerm) || fileName.includes(searchTerm);\n                } else if (mode === 'name') {\n                    match = funcName.includes(searchTerm);\n                } else if (mode === 'code') {\n                    match = funcCode.includes(searchTerm);\n                } else if (mode === 'comment') {\n                    match = funcComment.includes(searchTerm);\n                }\n            }",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "data-processing",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "event-listener",
                        "state-modifying",
                        "loops",
                        "validation"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "js/registry.js",
                            "line": 332,
                            "context": "filterFunctions();"
                        }
                    ],
                    "phpFilesCount": 7,
                    "phpFiles": [
                        "admin/manage_js_registry.php",
                        "admin/manage_registry.php",
                        "admin/registry-template.php",
                        "admin/pages/manage_js_registry.php",
                        "admin/tools/generate_registry_json.php",
                        "tools/generate_js_registry_json.php",
                        "tools/generate_registry_json.php"
                    ]
                },
                {
                    "name": "toggleFile",
                    "line": 197,
                    "comment": "/**\n * Toggle file section visibility\n */",
                    "code": "{\n    const list = header.nextElementSibling;\n    if (list && list.classList.contains('functions-list')) {\n        list.classList.toggle('open');\n        const arrow = header.querySelector('.expand-arrow');\n        if (arrow) {\n            arrow.textContent = list.classList.contains('open') ? '\u25bc' : '\u25b6';\n        }\n    }\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "general",
                    "tags": [
                        "dom-manipulation",
                        "event-listener",
                        "state-modifying"
                    ],
                    "usageCount": 2,
                    "usages": [
                        {
                            "file": "js/manage-registry.js",
                            "line": 278,
                            "context": "toggleFile(this);"
                        },
                        {
                            "file": "js/registry.js",
                            "line": 356,
                            "context": "toggleFile(this);"
                        }
                    ],
                    "phpFilesCount": 7,
                    "phpFiles": [
                        "admin/manage_js_registry.php",
                        "admin/manage_registry.php",
                        "admin/registry-template.php",
                        "admin/pages/manage_js_registry.php",
                        "admin/tools/generate_registry_json.php",
                        "tools/generate_js_registry_json.php",
                        "tools/generate_registry_json.php"
                    ]
                },
                {
                    "name": "toggleAll",
                    "line": 211,
                    "comment": "/**\n * Toggle all file sections (toggleAll and toggleAllFiles are aliases)\n */",
                    "code": "{\n    const lists = document.querySelectorAll('.functions-list');\n    const hiddenCount = document.querySelectorAll('.functions-list:not(.open)').length;\n    \n    lists.forEach(list => {\n        if (hiddenCount > 0) {\n            list.classList.add('open');\n        } else {\n            list.classList.remove('open');\n        }\n    });\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "general",
                    "tags": [
                        "dom-manipulation",
                        "state-modifying",
                        "loops"
                    ],
                    "usageCount": 2,
                    "usages": [
                        {
                            "file": "js/manage-registry.js",
                            "line": 374,
                            "context": "toggleAll();"
                        },
                        {
                            "file": "js/registry.js",
                            "line": 226,
                            "context": "toggleAll();"
                        }
                    ],
                    "phpFilesCount": 7,
                    "phpFiles": [
                        "admin/manage_js_registry.php",
                        "admin/manage_registry.php",
                        "admin/registry-template.php",
                        "admin/pages/manage_js_registry.php",
                        "admin/tools/generate_registry_json.php",
                        "tools/generate_js_registry_json.php",
                        "tools/generate_registry_json.php"
                    ]
                },
                {
                    "name": "toggleAllFiles",
                    "line": 224,
                    "comment": "",
                    "code": "{\n    toggleAll();\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "toggleAll"
                    ],
                    "category": "general",
                    "tags": [],
                    "usageCount": 0,
                    "usages": [],
                    "phpFilesCount": 7,
                    "phpFiles": [
                        "admin/manage_js_registry.php",
                        "admin/manage_registry.php",
                        "admin/registry-template.php",
                        "admin/pages/manage_js_registry.php",
                        "admin/tools/generate_registry_json.php",
                        "tools/generate_js_registry_json.php",
                        "tools/generate_registry_json.php"
                    ]
                },
                {
                    "name": "expandAllFiles",
                    "line": 231,
                    "comment": "/**\n * Expand all file sections\n */",
                    "code": "{\n    document.querySelectorAll('.functions-list').forEach(list => {\n        list.classList.add('open');\n    });\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "general",
                    "tags": [
                        "dom-manipulation",
                        "state-modifying",
                        "loops"
                    ],
                    "usageCount": 2,
                    "usages": [
                        {
                            "file": "tools/pages/js_registry.php",
                            "line": 96,
                            "context": "<button class=\"btn btn-sm btn-secondary\" onclick=\"expandAllFiles()\">"
                        },
                        {
                            "file": "tools/pages/registry.php",
                            "line": 36,
                            "context": "<button class=\"btn btn-primary btn-sm\" onclick=\"expandAllFiles()\"><i class=\"fa fa-expand\"></i> Expand All</button>"
                        }
                    ],
                    "phpFilesCount": 7,
                    "phpFiles": [
                        "admin/manage_js_registry.php",
                        "admin/manage_registry.php",
                        "admin/registry-template.php",
                        "admin/pages/manage_js_registry.php",
                        "admin/tools/generate_registry_json.php",
                        "tools/generate_js_registry_json.php",
                        "tools/generate_registry_json.php"
                    ]
                },
                {
                    "name": "collapseAllFiles",
                    "line": 240,
                    "comment": "/**\n * Collapse all file sections\n */",
                    "code": "{\n    document.querySelectorAll('.functions-list').forEach(list => {\n        list.classList.remove('open');\n    });\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "general",
                    "tags": [
                        "dom-manipulation",
                        "state-modifying",
                        "loops"
                    ],
                    "usageCount": 2,
                    "usages": [
                        {
                            "file": "tools/pages/js_registry.php",
                            "line": 99,
                            "context": "<button class=\"btn btn-sm btn-secondary\" onclick=\"collapseAllFiles()\">"
                        },
                        {
                            "file": "tools/pages/registry.php",
                            "line": 37,
                            "context": "<button class=\"btn btn-primary btn-sm\" onclick=\"collapseAllFiles()\"><i class=\"fa fa-compress\"></i> Collapse All</button>"
                        }
                    ],
                    "phpFilesCount": 7,
                    "phpFiles": [
                        "admin/manage_js_registry.php",
                        "admin/manage_registry.php",
                        "admin/registry-template.php",
                        "admin/pages/manage_js_registry.php",
                        "admin/tools/generate_registry_json.php",
                        "tools/generate_js_registry_json.php",
                        "tools/generate_registry_json.php"
                    ]
                },
                {
                    "name": "toggleCode",
                    "line": 249,
                    "comment": "/**\n * Toggle function code visibility (toggleCode and toggleFunctionCode are aliases)\n */",
                    "code": "{\n    const item = header.closest('.function-item');\n    if (!item) return;\n    \n    const codeBlock = item.querySelector('.function-code');\n    if (codeBlock) {\n        codeBlock.classList.toggle('open');\n        const arrow = header.querySelector('.expand-arrow');\n        if (arrow) {\n            arrow.textContent = codeBlock.classList.contains('open') ? '\u25bc' : '\u25b6';\n        }\n    }\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "general",
                    "tags": [
                        "dom-manipulation",
                        "event-listener",
                        "state-modifying"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "js/registry.js",
                            "line": 265,
                            "context": "toggleCode(header);"
                        }
                    ],
                    "phpFilesCount": 7,
                    "phpFiles": [
                        "admin/manage_js_registry.php",
                        "admin/manage_registry.php",
                        "admin/registry-template.php",
                        "admin/pages/manage_js_registry.php",
                        "admin/tools/generate_registry_json.php",
                        "tools/generate_js_registry_json.php",
                        "tools/generate_registry_json.php"
                    ]
                },
                {
                    "name": "toggleFunctionCode",
                    "line": 263,
                    "comment": "",
                    "code": "{\n    toggleCode(header);\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "toggleCode"
                    ],
                    "category": "general",
                    "tags": [],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "js/manage-registry.js",
                            "line": 75,
                            "context": "funcHeader.onclick = function() { toggleFunctionCode(this); };"
                        }
                    ],
                    "phpFilesCount": 7,
                    "phpFiles": [
                        "admin/manage_js_registry.php",
                        "admin/manage_registry.php",
                        "admin/registry-template.php",
                        "admin/pages/manage_js_registry.php",
                        "admin/tools/generate_registry_json.php",
                        "tools/generate_js_registry_json.php",
                        "tools/generate_registry_json.php"
                    ]
                },
                {
                    "name": "downloadRegistry",
                    "line": 270,
                    "comment": "/**\n * Download registry as JSON\n */",
                    "code": "{\n    const registryType = document.body.dataset.registryType || 'php';\n    const fileSections = document.querySelectorAll('.file-section');\n    const registry = {};\n    \n    fileSections.forEach(section => {\n        const fileHeader = section.querySelector('.file-header-title');\n        const fileName = fileHeader ? fileHeader.textContent.trim() : 'unknown';\n        registry[fileName] = [];\n        \n        section.querySelectorAll('.function-item').forEach(item => {\n            const funcNameEl = item.querySelector('.function-name');\n            const funcName = funcNameEl ? funcNameEl.textContent.trim() : '';\n            const funcCodeEl = item.querySelector('.function-code');\n            const funcCode = funcCodeEl ? funcCodeEl.textContent.trim() : '';\n            const funcCommentEl = item.querySelector('.function-comment');\n            const funcComment = funcCommentEl ? funcCommentEl.textContent.trim() : '';\n            const metaEl = item.querySelector('.function-meta');\n            const meta = metaEl ? metaEl.textContent.trim() : '';\n            \n            registry[fileName].push({\n                name: funcName,\n                code: funcCode,\n                comment: funcComment,\n                meta: meta\n            });\n        });\n    });\n    \n    // Create download\n    const dataStr = JSON.stringify(registry, null, 2);\n    const dataBlob = new Blob([dataStr], {type: 'application/json'});\n    const url = URL.createObjectURL(dataBlob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = registryType + '_function_registry_' + new Date().toISOString().slice(0,10) + '.json';\n    link.click();\n    URL.revokeObjectURL(url);\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "export",
                    "tags": [
                        "dom-manipulation",
                        "event-listener",
                        "state-modifying",
                        "loops"
                    ],
                    "usageCount": 4,
                    "usages": [
                        {
                            "file": "admin/pages/manage_js_registry.php",
                            "line": 63,
                            "context": "<button class=\"btn btn-info w-100\" onclick=\"downloadRegistry()\" title=\"Download as JSON\">"
                        },
                        {
                            "file": "admin/pages/manage_registry.php",
                            "line": 42,
                            "context": "<button class=\"btn btn-info w-100\" onclick=\"downloadRegistry()\" title=\"Download as JSON\">"
                        },
                        {
                            "file": "tools/pages/js_registry.php",
                            "line": 46,
                            "context": "<button class=\"btn btn-info w-100\" onclick=\"downloadRegistry()\" title=\"Download as JSON\">"
                        },
                        {
                            "file": "tools/pages/registry.php",
                            "line": 39,
                            "context": "<button class=\"btn btn-info btn-sm\" onclick=\"downloadRegistry()\"><i class=\"fa fa-download\"></i> Download JSON</button>"
                        }
                    ],
                    "phpFilesCount": 7,
                    "phpFiles": [
                        "admin/manage_js_registry.php",
                        "admin/manage_registry.php",
                        "admin/registry-template.php",
                        "admin/pages/manage_js_registry.php",
                        "admin/tools/generate_registry_json.php",
                        "tools/generate_js_registry_json.php",
                        "tools/generate_registry_json.php"
                    ]
                },
                {
                    "name": "toggleUnused",
                    "line": 313,
                    "comment": "/**\n * Toggle unused functions section visibility\n */",
                    "code": "{\n    const content = header.nextElementSibling;\n    if (content && content.classList.contains('unused-content')) {\n        content.classList.toggle('hidden');\n        const arrow = header.querySelector('.unusedArrow');\n        if (arrow) {\n            arrow.textContent = content.classList.contains('hidden') ? '\u25b6' : '\u25bc';\n        }\n    }\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "general",
                    "tags": [
                        "dom-manipulation",
                        "event-listener",
                        "state-modifying"
                    ],
                    "usageCount": 0,
                    "usages": [],
                    "phpFilesCount": 7,
                    "phpFiles": [
                        "admin/manage_js_registry.php",
                        "admin/manage_registry.php",
                        "admin/registry-template.php",
                        "admin/pages/manage_js_registry.php",
                        "admin/tools/generate_registry_json.php",
                        "tools/generate_js_registry_json.php",
                        "tools/generate_registry_json.php"
                    ]
                },
                {
                    "name": "clearSearch",
                    "line": 327,
                    "comment": "/**\n * Clear search\n */",
                    "code": "{\n    const input = document.getElementById('searchInput');\n    if (input) {\n        input.value = '';\n        filterFunctions();\n    }\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "filterFunctions"
                    ],
                    "category": "data-processing",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "state-modifying"
                    ],
                    "usageCount": 4,
                    "usages": [
                        {
                            "file": "admin/pages/manage_js_registry.php",
                            "line": 193,
                            "context": "<button class=\"btn btn-sm btn-secondary\" onclick=\"clearSearch()\">"
                        },
                        {
                            "file": "admin/pages/manage_registry.php",
                            "line": 179,
                            "context": "<button class=\"btn btn-sm btn-secondary\" onclick=\"clearSearch()\">"
                        },
                        {
                            "file": "tools/pages/js_registry.php",
                            "line": 102,
                            "context": "<button class=\"btn btn-sm btn-secondary\" onclick=\"clearSearch()\">"
                        },
                        {
                            "file": "tools/pages/registry.php",
                            "line": 38,
                            "context": "<button class=\"btn btn-secondary btn-sm\" onclick=\"clearSearch()\"><i class=\"fa fa-times\"></i> Clear</button>"
                        }
                    ],
                    "phpFilesCount": 7,
                    "phpFiles": [
                        "admin/manage_js_registry.php",
                        "admin/manage_registry.php",
                        "admin/registry-template.php",
                        "admin/pages/manage_js_registry.php",
                        "admin/tools/generate_registry_json.php",
                        "tools/generate_js_registry_json.php",
                        "tools/generate_registry_json.php"
                    ]
                }
            ]
        },
        {
            "name": "js/sequence-retrieval.js",
            "count": 8,
            "functions": [
                {
                    "name": "clearSourceFilter",
                    "line": 6,
                    "comment": "/**\n * Retrieve Sequences Tool Manager\n * Handles UI logic for sequence retrieval form including source selection,\n * filtering, copy-to-clipboard functionality, and search ID display\n */\n",
                    "code": "{\n    clearSourceFilters('sourceFilter', 'selected_source', 'fasta-source-line', null, 'downloadForm');\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "clearSourceFilters"
                    ],
                    "category": "data-processing",
                    "tags": [],
                    "usageCount": 0,
                    "usages": [],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "tools/retrieve_sequences.php"
                    ]
                },
                {
                    "name": "initializeSequenceRetrieval",
                    "line": 10,
                    "comment": "",
                    "code": "{}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "general",
                    "tags": [],
                    "usageCount": 2,
                    "usages": [
                        {
                            "file": "js/sequence-retrieval.js",
                            "line": 327,
                            "context": "initializeSequenceRetrieval({ shouldScroll: shouldScroll });"
                        },
                        {
                            "file": "js/sequence-retrieval.js",
                            "line": 335,
                            "context": "initializeSequenceRetrieval({ shouldScroll: shouldScroll });"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "tools/retrieve_sequences.php"
                    ]
                },
                {
                    "name": "updateCurrentSelectionDisplay",
                    "line": 24,
                    "comment": "",
                    "code": "{\n        window.updateCurrentSelectionDisplay('currentSelection', 'fasta-source-line', true);\n        const selectionDiv = document.getElementById('currentSelection');\n        const checked = document.querySelector('input[name=\"selected_source\"]:checked');\n        if (!checked) {\n            selectionDiv.innerHTML = '<span style=\"color: #999;\">None selected</span>';\n        }\n    }",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "updateCurrentSelectionDisplay"
                    ],
                    "category": "ui-dom",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "event-listener",
                        "state-modifying",
                        "validation"
                    ],
                    "usageCount": 8,
                    "usages": [
                        {
                            "file": "js/blast-manager.js",
                            "line": 61,
                            "context": "window.updateCurrentSelectionDisplay();"
                        },
                        {
                            "file": "js/blast-manager.js",
                            "line": 77,
                            "context": "updateCurrentSelectionDisplay();"
                        },
                        {
                            "file": "js/blast-manager.js",
                            "line": 80,
                            "context": "updateCurrentSelectionDisplay();"
                        },
                        {
                            "file": "js/blast-manager.js",
                            "line": 86,
                            "context": "updateCurrentSelectionDisplay();"
                        },
                        {
                            "file": "js/sequence-retrieval.js",
                            "line": 25,
                            "context": "window.updateCurrentSelectionDisplay('currentSelection', 'fasta-source-line', true);"
                        },
                        {
                            "file": "js/sequence-retrieval.js",
                            "line": 47,
                            "context": "updateCurrentSelectionDisplay();"
                        },
                        {
                            "file": "js/sequence-retrieval.js",
                            "line": 50,
                            "context": "updateCurrentSelectionDisplay();"
                        },
                        {
                            "file": "js/sequence-retrieval.js",
                            "line": 55,
                            "context": "updateCurrentSelectionDisplay();"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "tools/retrieve_sequences.php"
                    ]
                },
                {
                    "name": "updateSearchIdsDisplay",
                    "line": 88,
                    "comment": "",
                    "code": "{\n        if (!featureIdsTextarea) return;\n        \n        // Check if searchIdsDisplay element exists before trying to update it\n        const searchIdsDisplay = document.getElementById('searchIdsDisplay');\n        if (!searchIdsDisplay) {\n            return; // Element doesn't exist on this page, skip\n        }\n        \n        \n        // Get user input IDs\n        const rawIds = featureIdsTextarea.value.trim();\n        const userInputIds = rawIds\n            .split(/[\\n,]+/)\n            .map(id => id.trim())\n            .filter(id => id.length > 0);\n        \n        \n        // Get found IDs from server (IDs that were actually returned by blastdbcmd)\n        let foundIds = [];\n        if (foundIdsField && foundIdsField.value) {\n            try {\n                foundIds = JSON.parse(foundIdsField.value);\n            } catch (e) {\n                // If field has JSON, try to use it\n                foundIds = [];\n            }\n        }\n        // Also check window.foundIds as fallback\n        if (!Array.isArray(foundIds) || foundIds.length === 0) {\n            foundIds = (window.foundIds && Array.isArray(window.foundIds)) ? window.foundIds : [];\n        }\n        \n        // If still empty, try to extract from displayed FASTA sequences on the page\n        if (foundIds.length === 0) {\n            // Look for FASTA headers (lines starting with >) in the sequence display areas\n            const fastaRegex = />([^\\s]+)/g;\n            const displayContent = document.body.textContent;\n            let match;\n            while ((match = fastaRegex.exec(displayContent)) !== null) {\n                foundIds.push(match[1]);\n            }\n            foundIds = [...new Set(foundIds)]; // Remove duplicates\n        }\n        \n        // First check if server sent expanded uniquenames (after form submission)\n        let idsToDisplay = [];\n        if (expandedUniqueamesField && expandedUniqueamesField.value) {\n            try {\n                const expanded = JSON.parse(expand",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "ui-dom",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "event-listener",
                        "state-modifying",
                        "loops",
                        "error-handling",
                        "validation"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "js/sequence-retrieval.js",
                            "line": 220,
                            "context": "updateSearchIdsDisplay();"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "tools/retrieve_sequences.php"
                    ]
                },
                {
                    "name": "initializeCopyTooltips",
                    "line": 240,
                    "comment": "",
                    "code": "{\n    const copyables = document.querySelectorAll(\".copyable\");\n    copyables.forEach(el => {\n        // Custom simple tooltip that follows cursor\n        el.addEventListener(\"mouseenter\", function() {\n            // Remove any existing tooltip\n            const existing = document.getElementById(\"custom-copy-tooltip\");\n            if (existing) existing.remove();\n            \n            // Create simple tooltip\n            const tooltip = document.createElement(\"div\");\n            tooltip.id = \"custom-copy-tooltip\";\n            tooltip.textContent = \"Click to copy\";\n            tooltip.style.cssText = `\n                position: fixed;\n                background-color: #000;\n                color: #fff;\n                padding: 5px 10px;\n                border-radius: 4px;\n                font-size: 12px;\n                white-space: nowrap;\n                pointer-events: none;\n                z-index: 9999;\n            `;\n            document.body.appendChild(tooltip);\n            \n            // Update position on mousemove\n            const updatePosition = (e) => {\n                tooltip.style.left = (e.clientX + 10) + \"px\";\n                tooltip.style.top = (e.clientY - 30) + \"px\";\n            };\n            \n            el.addEventListener(\"mousemove\", updatePosition);\n            \n            // Initial position\n            updatePosition(event);\n            \n            el.addEventListener(\"mouseleave\", function() {\n                const existing = document.getElementById(\"custom-copy-tooltip\");\n                if (existing) existing.remove();\n                el.removeEventListener(\"mousemove\", updatePosition);\n            }, { once: true });\n        });\n    });\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [
                        "updatePosition"
                    ],
                    "category": "general",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "event-listener",
                        "state-modifying",
                        "loops"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "js/modules/copy-to-clipboard.js",
                            "line": 26,
                            "context": "initializeCopyTooltips();"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "tools/retrieve_sequences.php"
                    ]
                },
                {
                    "name": "clearFeatureIds",
                    "line": 288,
                    "comment": "",
                    "code": "{\n    const featureIds = document.getElementById('featureIds');\n    \n    if (!featureIds) {\n        console.error('featureIds field not found');\n        return;\n    }\n    \n    featureIds.value = '';\n    featureIds.focus();\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "general",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "state-modifying",
                        "error-handling"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "tools/pages/retrieve_sequences.php",
                            "line": 103,
                            "context": "<button type=\"button\" class=\"btn btn-sm btn-outline-secondary\" onclick=\"clearFeatureIds()\">"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "tools/retrieve_sequences.php"
                    ]
                },
                {
                    "name": "loadSampleIds",
                    "line": 303,
                    "comment": "",
                    "code": "{\n    const sampleIds = typeof window.sampleFeatureIds !== 'undefined' ? window.sampleFeatureIds : [];\n    const featureIds = document.getElementById('featureIds');\n    \n    if (!featureIds) {\n        console.error('featureIds field not found');\n        return;\n    }\n    \n    if (sampleIds.length === 0) {\n        console.error('No sample IDs configured');\n        return;\n    }\n    \n    // Load samples one per line\n    featureIds.value = sampleIds.join('\\n');\n    featureIds.focus();\n}",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "general",
                    "tags": [
                        "dom-manipulation",
                        "ajax",
                        "state-modifying",
                        "error-handling"
                    ],
                    "usageCount": 1,
                    "usages": [
                        {
                            "file": "tools/pages/retrieve_sequences.php",
                            "line": 100,
                            "context": "<button type=\"button\" class=\"btn btn-sm btn-outline-secondary\" onclick=\"loadSampleIds()\">"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "tools/retrieve_sequences.php"
                    ]
                },
                {
                    "name": "updatePosition",
                    "line": 268,
                    "comment": "",
                    "code": "{\n                tooltip.style.left = (e.clientX + 10) + \"px\";\n                tooltip.style.top = (e.clientY - 30) + \"px\";\n            }",
                    "parameters": [],
                    "returnType": "void",
                    "returnDescription": "",
                    "internalCalls": [],
                    "category": "general",
                    "tags": [
                        "state-modifying"
                    ],
                    "usageCount": 2,
                    "usages": [
                        {
                            "file": "js/sequence-retrieval.js",
                            "line": 276,
                            "context": "updatePosition(event);"
                        },
                        {
                            "file": "js/modules/copy-to-clipboard.js",
                            "line": 65,
                            "context": "updatePosition(event);"
                        }
                    ],
                    "phpFilesCount": 1,
                    "phpFiles": [
                        "tools/retrieve_sequences.php"
                    ]
                }
            ]
        }
    ],
    "unused": [
        {
            "name": "downloadResultsHTML",
            "file": "js/blast-manager.js",
            "line": 9
        },
        {
            "name": "clearResults",
            "file": "js/blast-manager.js",
            "line": 44
        },
        {
            "name": "clearBlastSourceFilters",
            "file": "js/blast-manager.js",
            "line": 52
        },
        {
            "name": "handleToolClick",
            "file": "js/index.js",
            "line": 2
        },
        {
            "name": "toggleAllFiles",
            "file": "js/manage-registry.js",
            "line": 372
        },
        {
            "name": "fixFilePermissions",
            "file": "js/permission-manager.js",
            "line": 16
        },
        {
            "name": "md5",
            "file": "js/permission-manager.js",
            "line": 79
        },
        {
            "name": "toggleAllFiles",
            "file": "js/registry.js",
            "line": 224
        },
        {
            "name": "toggleUnused",
            "file": "js/registry.js",
            "line": 313
        },
        {
            "name": "clearSourceFilter",
            "file": "js/sequence-retrieval.js",
            "line": 6
        },
        {
            "name": "draw_blast_graph",
            "file": "js/modules/blast-canvas-graph.js",
            "line": 2
        },
        {
            "name": "move_bg_rect",
            "file": "js/modules/blast-canvas-graph.js",
            "line": 437
        },
        {
            "name": "track_height",
            "file": "js/modules/blast-canvas-graph.js",
            "line": 413
        },
        {
            "name": "updateRegistry",
            "file": "js/modules/manage-registry.js",
            "line": 9
        },
        {
            "name": "filterText",
            "file": "js/modules/source-list-manager.js",
            "line": 37
        },
        {
            "name": "isHidden",
            "file": "js/modules/source-list-manager.js",
            "line": 204
        }
    ]
}