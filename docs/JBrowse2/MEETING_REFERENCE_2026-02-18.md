# JBrowse2 Track Management - CURRENT STATE (Feb 2026)

**For meeting reference - Accurate as of February 18, 2026**

---

## Current Track Management System

### Main Method: Google Sheets + PHP Script

**The ONLY active track loading method:**

```bash
php tools/jbrowse/generate_tracks_from_sheet.php SHEET_ID \
    --gid GID \
    --organism Organism_name \
    --assembly Assembly_ID
```

**What it does:**
- Reads track definitions from Google Sheets
- Generates JSON metadata files in `metadata/jbrowse2-configs/tracks/`
- Supports all track types: BigWig, BAM, CRAM, VCF, GFF, GTF, BED, PAF
- Handles multi-BigWig combo tracks
- Handles synteny tracks (PIF/PAF format)

**Google Sheet Format:**
```
track_id | name | category | TRACK_PATH | ACCESS_LEVEL
rnaseq   | RNA-seq | Expression | /data/tracks/sample.bw | public
```

**For Synteny Tracks:**
```
track_id | name | category | ASSEMBLY1 | ASSEMBLY2 | TRACK_PATH | ACCESS_LEVEL
synteny  | Genome Alignment | Synteny | Nvec200 | Nvec100 | /data/synteny/align.pif.gz | public
```

---

## Track Types Currently Supported

### Working âœ…
- **BigWig** (`.bw`) - Coverage/signal data
- **BAM** (`.bam` + `.bai`) - Alignments
- **CRAM** (`.cram` + `.crai`) - Compressed alignments
- **VCF** (`.vcf.gz` + `.tbi`) - Variants
- **GFF3** (`.gff.gz` + `.tbi`) - Gene annotations
- **GTF** (`.gtf`) - Gene annotations
- **BED** (`.bed.gz` + `.tbi`) - Features
- **PAF/PIF** (`.pif.gz` + `.tbi`) - Whole genome synteny
- **Multi-BigWig** - Combo tracks with multiple BigWig files

### In Progress âš ï¸
- **MAF** (`.maf.gz` + `.gzi`) - Cactus multiple alignments
  * Backend ready
  * Needs `samples` array in metadata
  * Needs testing with real data
  
- **MCScan Anchors** (`.anchors` + 2 `.bed` files) - Ortholog pairs
  * Script exists
  * Not fully tested
  * Not in Google Sheets workflow yet

---

## File Locations

### Track Data
```
/data/moop/data/tracks/
â”œâ”€â”€ Organism/
â”‚   â””â”€â”€ Assembly/
â”‚       â”œâ”€â”€ bigwig/*.bw
â”‚       â”œâ”€â”€ bam/*.bam
â”‚       â”œâ”€â”€ vcf/*.vcf.gz
â”‚       â””â”€â”€ ...
â””â”€â”€ synteny/
    â””â”€â”€ Org1__Org2/
        â””â”€â”€ alignment.pif.gz
```

### Track Metadata (Generated by script)
```
/data/moop/metadata/jbrowse2-configs/tracks/
â”œâ”€â”€ Organism/
â”‚   â””â”€â”€ Assembly/
â”‚       â”œâ”€â”€ bigwig/
â”‚       â”‚   â””â”€â”€ track1.json
â”‚       â””â”€â”€ ...
â””â”€â”€ synteny/
    â””â”€â”€ Org1__Org2/
        â””â”€â”€ synteny_track.json
```

---

## Scripts Status

### Active Scripts (PHP)
- âœ… `generate_tracks_from_sheet.php` - Main track loader
- âœ… `generate_synteny_tracks_from_sheet.php` - Synteny tracks
- âœ… `remove_tracks.php` - Remove tracks
- ğŸ”§ `create_maf_test_files.php` - MAF testing utility

### Archived Scripts (Shell)
All in `tools/jbrowse/archived_shell_scripts/`:
- âŒ `add_bigwig_track.sh` (replaced by PHP script)
- âŒ `add_bam_track.sh` (replaced by PHP script)
- âŒ `add_*_track.sh` (all replaced)
- âŒ `setup_jbrowse_assembly.sh` (still functional but not documented)
- âŒ `add_assembly_to_jbrowse.sh` (still functional but not documented)

**Note:** Shell scripts are archived but may still work. Not actively maintained.

---

## Access Control

Tracks have access levels in Google Sheet:
- `public` - Everyone can see (including anonymous)
- `collaborator` - Logged-in users only
- `admin` - Administrators only

**Example:**
```
track_id,name,TRACK_PATH,ACCESS_LEVEL
public_data,Public RNA-seq,/data/tracks/public.bw,public
private_data,Unpublished Data,/data/tracks/private.bw,collaborator
```

---

## Combo Tracks (Multi-BigWig)

Group multiple BigWig files into one track with color-coded samples.

**Google Sheet Format:**
```
# Track Title
## blues: Sample Group 1
sample1,Sample 1,/data/tracks/s1.bw
sample2,Sample 2,/data/tracks/s2.bw
## reds: Sample Group 2
sample3,Sample 3,/data/tracks/s3.bw
### end
```

**Available Colors:**
blues, reds, greens, purples, oranges, cyans, pinks, browns, grays, etc.

---

## Known Issues / TODO

### MAF Tracks
- âš ï¸ Needs `samples` array specification
- âš ï¸ Not tested with real Cactus output
- âš ï¸ Documentation exists but implementation needs validation

**Sample Format Needed:**
```
samples: hg38,Human;panTro6,Chimp;gorGor6,Gorilla
```

### MCScan Anchor Tracks
- âš ï¸ Backend script exists
- âš ï¸ Not integrated into Google Sheets workflow
- âš ï¸ Needs testing

### Dual-Assembly Frontend
- âœ… Backend API works (config.php supports assembly1/assembly2)
- â³ No UI yet - need frontend page to select two assemblies
- â³ LinearSyntenyView not exposed to users

---

## For Your Meeting

**Key Points:**
1. Current system: Google Sheets â†’ PHP script â†’ JSON metadata
2. All standard formats working (BigWig, BAM, VCF, GFF, etc.)
3. Synteny tracks (PIF/PAF) working
4. MAF and MCScan need completion
5. Shell scripts are archived - use PHP script instead

**Demo Command:**
```bash
cd /data/moop
php tools/jbrowse/generate_tracks_from_sheet.php "SHEET_ID" \
    --gid 0 \
    --organism Nematostella_vectensis \
    --assembly GCA_033964005.1
```

**Live Docs:**
- Main: `docs/JBrowse2/README.md`
- Admin: `docs/JBrowse2/ADMIN_GUIDE.md`
- Track Formats: `docs/JBrowse2/reference/TRACK_FORMATS_REFERENCE.md`
- Google Sheets: `docs/JBrowse2/workflows/GOOGLE_SHEETS_WORKFLOW.md`
- Synteny: `docs/JBrowse2/SYNTENY_AND_COMPARATIVE.md`

---

**Last Updated:** February 18, 2026
